import{d as p,j as e}from"./index-CiRwLPeh-1769119750716.js";import{r as n}from"./charts-C6jPuoY4-1769119750716.js";import{o as N,d as b,q as W,w as C,c as P,g as Y,u as S,a as $,b as I}from"./firebase-Dp89RMPZ-1769119750716.js";const U={en:{orders:"Orders",team:"Team",clients:"Clients",services:"Services",metrics:"Metrics",payroll:"Payroll",settings:"Settings",profile:"Profile",financials:"Financials",daily_sales:"Daily Sales",active_washers:"Active Washers",pending_orders:"Pending Orders",total_revenue:"Total Revenue",washer_pay:"Washer Pay",total_clients:"Total Clients",avg_rating:"Avg Rating",available_jobs:"Available Jobs",my_jobs:"My Jobs",earnings:"Earnings",on_my_way:"I'm on my way",arrived:"I've arrived",start_service:"Start Service",complete_service:"Complete Service",active_jobs:"Active Jobs",completed_jobs:"Completed Jobs",this_week:"This Week",online:"Online",offline:"Offline",hello:"Hello",book_now:"Book Now",my_bookings:"My Bookings",garage:"Garage",select_vehicle:"Select Vehicle",select_service:"Select Service",confirm_order:"Confirm Order",save:"Save",cancel:"Cancel",edit:"Edit",delete:"Delete",language:"Language",back:"Back",next:"Next",loading:"Loading...",success:"Success",error:"Error",logout:"Logout",profile_settings:"Profile Settings",password:"Password",preferences:"Preferences",close:"Close",search:"Search",filter:"Filter",all:"All",status:"Status",date:"Date",time:"Time",my_jobs_desc:"Manage your assigned car wash jobs",assigned:"Assigned",en_route:"En Route",in_progress:"In Progress",completed:"Completed",total_paid:"Total Client Paid",app_fees:"App Fees",tip_is_yours:"Tip (100% yours)",your_payout:"Your Payout",ready_withdrawal:"Ready for withdrawal",chat_with:"Chat with",arrival_eta:"Estimated Arrival Time",wait_auth:"Waiting for Authorization",wait_auth_desc:"The client must authorize the start of the service",start_auth_press:'Waiting for client to press "Authorize Start"...',service_authorized:"Service Authorized!",can_start_service:"You can now start the service",take_before_photos:"Take Before Photos (6 Req.)",waiting_auth:"Waiting for Authorization...",client_no_show:"Client No Show",finish_job:"Finish Job",cancel_order_warn:"Cancel order? Your rating will decrease and this cannot be undone.",password_min_length:"Your password must be at least 6 characters long",photo_updated:"Photo updated successfully!",photo_updated_es:"Â¡Foto actualizada correctamente!",photo_upload_failed:"Failed to upload photo",profile_updated:"Profile updated successfully!",profile_update_failed:"Failed to update profile",passwords_dont_match:"Passwords do not match",password_changed:"Password changed successfully!",logout_confirm:"Are you sure you want to logout?",availability_on:"You are now available for jobs",availability_off:"You are now unavailable for jobs",notifications_enabled:"Notifications enabled",notifications_disabled:"Notifications disabled",full_name:"Full Name",phone_number:"Phone Number",email_address:"Email Address",save_changes:"Save Changes",current_password:"Current Password",new_password:"New Password",confirm_new_password:"Confirm New Password",update_password:"Update Password",receive_alerts:"Receive alerts for new jobs",work_availability:"Work Availability",switch_on_alerts:"Switch on to receive new job alerts",need_help:"Need help? Contact support",change_photo:"Change Photo",uploading:"Uploading...",email_warn:"Email cannot be changed",your_stats:"Your Statistics",jobs_completed:"Jobs Completed",total_earned:"Total Earned",contact_support:"Contact Support",change_password:"Change Password",availability_status:"Availability Status",avail_on_desc:"You are currently available to receive job assignments",avail_off_desc:"You are currently unavailable and will not receive new jobs",push_notifications:"Push Notifications",push_desc:"Receive notifications for new jobs, messages, and updates",notifications_title:"Notifications (Last 24h)",no_notifications:"No new notifications",live_orders:"Live Orders",search_orders_placeholder:"Order #, Client ID or Name...",unassigned:"Unassigned",hours_ago:"h ago",schedule:"Schedule",working_days:"Working Days",opening:"Opening",closing:"Closing",add_slot:"Add Slot",schedule_updated:"Schedule updated successfully",sunday:"Sunday",monday:"Monday",tuesday:"Tuesday",wednesday:"Wednesday",thursday:"Thursday",friday:"Friday",saturday:"Saturday",excellent_work:"Excellent Work!",service_completed_success:"Service completed successfully.",time_left_rating:"Time Remaining for Rating",min:"MIN",sec:"SEC",wait_client_confirm:"Waiting for client to confirm.",time_expires_continue:"If time expires, you can continue.",total_net_earnings:"Total Net Earnings",gross_value:"Total Value (Gross)",app_commission_deductions:"App Commission / Deductions",tips_100_yours:"Tips (100% yours)",your_net_payout:"Your Net Payout",this_month:"This Month",this_year:"This Year",jobs:"jobs",view_all:"View All",no_active_jobs:"No Active Jobs",no_assigned_jobs:"You have no jobs assigned at this moment.",ganancias:"Earnings",edit_profile:"Edit Profile",my_garage:"My Garage",payment_methods:"Payment Methods",my_addresses:"My Addresses",loyalty_program:"Loyalty Program",loyalty_desc:"Earn points and rewards",join_team:"Join Our Team",click_camera:"Click the camera to change photo",choose_language:"Choose your preferred language",schedule_desc:"Set the days and hours you will be available to receive orders.",loyalty_current_level:"Current Level",loyalty_completed_washes:"Completed Washes",loyalty_next_goal:"Next Goal",loyalty_more_washes:"more washes",loyalty_rewards:"Loyalty Rewards",loyalty_required_washes:"washes required",loyalty_claim_coupon:"CLAIM COUPON",loyalty_generating:"Generating...",loyalty_reclaimed:"RECLAIMED",loyalty_locked:"LOCKED",loyalty_my_coupons:"My Claimed Coupons",loyalty_used:"Used",loyalty_available:"Available",loyalty_how_works:"How it works?",loyalty_step1_title:"Wash your car",loyalty_step1_desc:"Every wash adds 1 point to your account.",loyalty_step2_title:"Earn Rewards",loyalty_step2_desc:"Unlock coupons at 5, 10, and 15 washes.",loyalty_step3_title:"Redeem anytime",loyalty_step3_desc:"Generate your exclusive coupon and use it on your next order.",loyalty_footer:'"Loyalty has its rewards. Thank you for trusting us."',tier_bronze:"Bronze",tier_silver:"Silver",tier_gold:"Gold",tier_diamond:"Diamond",benefit_bronze_1:"Accumulate washes for discounts",benefit_bronze_2:"Benefit at 5th wash",benefit_silver_1:"5% discount at 5 washes",benefit_silver_2:"Next goal: 10 washes",benefit_gold_1:"10% discount at 10 washes",benefit_gold_2:"Next goal: 15 washes",benefit_diamond_1:"15% discount at 15 washes",benefit_diamond_2:"Maximum benefit reached",discount_off:"OFF"}};class q{constructor(){this.currentLang="en",this.currentLang="en",localStorage.setItem("app_language","en")}get language(){return this.currentLang}setLanguage(a){this.currentLang="en",localStorage.setItem("app_language","en")}subscribe(a){return a(this.currentLang),()=>{}}t(a){return U.en[a]||a}}const t=new q,V=()=>{const[r]=n.useState("en");return{language:r,t:a=>t.t(a),setLanguage:a=>{}}},c=[{name:t.t("tier_bronze"),minPoints:0,discount:0,color:"#CD7F32",benefits:[t.t("benefit_bronze_1"),t.t("benefit_bronze_2")]},{name:t.t("tier_silver"),minPoints:5,discount:5,color:"#C0C0C0",benefits:[t.t("benefit_silver_1"),t.t("benefit_silver_2")]},{name:t.t("tier_gold"),minPoints:10,discount:10,color:"#FFD700",benefits:[t.t("benefit_gold_1"),t.t("benefit_gold_2")]},{name:t.t("tier_diamond"),minPoints:15,discount:15,color:"#E5E4E2",benefits:[t.t("benefit_diamond_1"),t.t("benefit_diamond_2")]}],H=({userId:r})=>{const[a,m]=n.useState(0),[y,g]=n.useState([]),[o,k]=n.useState(c[0]),[u,T]=n.useState(c[1]),[E,L]=n.useState(!0),[x,f]=n.useState(!1),[w,A]=n.useState([]);n.useEffect(()=>{const s=N(b(p,"users",r),d=>{const l=d.data(),h=(l==null?void 0:l.loyaltyPoints)||0,F=(l==null?void 0:l.claimedMilestones)||[];m(h),g(F);const v=[...c].reverse().find(z=>h>=z.minPoints)||c[0];k(v);const j=c.indexOf(v);T(j<c.length-1?c[j+1]:null),L(!1)}),_=W(P(p,"discounts"),C("clientId","==",r),C("active","==",!0)),i=N(_,d=>{const l=d.docs.map(h=>({id:h.id,...h.data()}));A(l)});return()=>{s(),i()}},[r]);const M=async(s,_)=>{if(!(x||y.includes(s))){f(!0);try{const i=Math.random().toString(36).substring(2,6).toUpperCase(),d=`VALE-${_}-${i}`;await $(P(p,"discounts"),{code:d,type:"percentage",value:_,description:`Loyalty Reward - ${s} Washes`,active:!0,usageLimit:1,usageCount:0,applicableTo:"total",clientId:r,createdBy:"system",createdDate:new Date().toISOString()});const l=b(p,"users",r);await S(l,{claimedMilestones:I(s)}),alert(`Congratulations! Your code is: ${d}

Copy it to use it on your next order.`)}catch(i){console.error("Error claiming reward:",i),alert("Error claiming reward. Please try again.")}finally{f(!1)}}},R=s=>{navigator.clipboard.writeText(s),alert("Code copied to clipboard!")},O=u?(a-o.minPoints)/(u.minPoints-o.minPoints)*100:100,D=u?u.minPoints-a:0;return E?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"spinner"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-2xl p-8 relative overflow-hidden",style:{background:`linear-gradient(135deg, ${o.color}20 0%, ${o.color}05 100%)`,borderColor:`${o.color}40`,borderWidth:"2px"},children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-400 mb-1",children:t.t("loyalty_current_level")}),e.jsx("h2",{className:"text-4xl font-bold",style:{color:o.color},children:o.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-400 mb-1",children:t.t("loyalty_completed_washes")}),e.jsx("p",{className:"text-4xl font-bold",children:a})]})]}),u&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{className:"text-slate-400",children:[t.t("loyalty_next_goal"),": ",u.name]}),e.jsxs("span",{className:"font-semibold",children:[D," ",t.t("loyalty_more_washes")]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${Math.min(O,100)}%`,background:`linear-gradient(90deg, ${o.color}, ${u.color})`}})})]})]}),e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 rounded-full opacity-10",style:{background:o.color,transform:"translate(30%, -30%)"}})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 text-primary",children:t.t("loyalty_rewards")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:c.map(s=>{const _=a>=s.minPoints,i=y.includes(s.minPoints),d=s.minPoints>0&&_&&!i;return e.jsxs("div",{className:`rounded-xl p-4 border-2 transition-all ${s.name===o.name?"scale-105 shadow-lg":"opacity-60 hover:opacity-100"}`,style:{borderColor:s.name===o.name?s.color:"#ffffff20",background:`${s.color}10`},children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-bold text-lg",style:{color:s.color},children:s.name}),i&&e.jsx("span",{className:"material-symbols-outlined text-green-400 text-sm",children:"verified"})]}),e.jsxs("p",{className:"text-xs text-slate-400 mb-3",children:[s.minPoints," ",t.t("loyalty_required_washes")]}),s.discount>0&&e.jsxs("p",{className:"text-xl font-bold mb-3",children:[s.discount,"% ",t.t("discount_off")]}),d?e.jsx("button",{onClick:()=>M(s.minPoints,s.discount),disabled:x,className:"w-full py-2 bg-primary text-black rounded-lg text-xs font-bold hover:bg-primary-dark transition-colors",children:x?t.t("loyalty_generating"):t.t("loyalty_claim_coupon")}):i?e.jsx("div",{className:"py-2 text-center text-green-400 text-xs font-bold border border-green-500/20 rounded-lg",children:t.t("loyalty_reclaimed")}):s.minPoints>0&&e.jsx("div",{className:"py-2 text-center text-slate-500 text-xs font-bold border border-white/10 rounded-lg",children:t.t("loyalty_locked")})]},s.name)})})]}),w.length>0&&e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 text-primary",children:t.t("loyalty_my_coupons")}),e.jsx("div",{className:"space-y-3",children:w.map(s=>e.jsxs("button",{onClick:()=>R(s.code),disabled:s.usageCount>0,className:`w-full flex items-center justify-between bg-black/20 p-4 rounded-xl border border-white/5 transition-all text-left group
                                    ${s.usageCount===0?"hover:bg-white/5 hover:border-primary/30 active:scale-[0.98]":"opacity-50 grayscale cursor-not-allowed"}
                                `,children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-bold text-lg tracking-wider text-primary group-hover:text-white transition-colors",children:s.code}),e.jsx("span",{className:"material-symbols-outlined text-xs text-slate-500",children:"content_copy"})]}),e.jsx("p",{className:"text-xs text-slate-400",children:s.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-black text-xl text-green-400",children:[s.value,"% OFF"]}),s.usageCount>0?e.jsx("span",{className:"text-[10px] text-slate-500 uppercase px-2 py-0.5 bg-white/5 rounded",children:t.t("loyalty_used")}):e.jsx("span",{className:"text-[10px] text-green-400 uppercase px-2 py-0.5 bg-green-500/10 rounded",children:t.t("loyalty_available")})]})]},s.id))})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:t.t("loyalty_how_works")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-primary text-3xl",children:"local_car_wash"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-1",children:t.t("loyalty_step1_title")}),e.jsx("p",{className:"text-sm text-slate-400",children:t.t("loyalty_step1_desc")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-primary text-3xl",children:"stars"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-1",children:t.t("loyalty_step2_title")}),e.jsx("p",{className:"text-sm text-slate-400",children:t.t("loyalty_step2_desc")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-primary text-3xl",children:"confirmation_number"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-1",children:t.t("loyalty_step3_title")}),e.jsx("p",{className:"text-sm text-slate-400",children:t.t("loyalty_step3_desc")})]})]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-primary/20 to-purple-500/20 border border-primary/30 rounded-xl p-6 text-center",children:e.jsx("p",{className:"text-sm text-slate-400 italic",children:t.t("loyalty_footer")})})]})},K=async r=>{var a;try{const m=b(p,"users",r),y=await Y(m),g=y.exists()&&((a=y.data())==null?void 0:a.loyaltyPoints)||0;return await S(m,{loyaltyPoints:g+1}),1}catch(m){return console.error("Error adding loyalty points:",m),0}};export{H as L,K as a,c as b,t as i,V as u};
