const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-1bqWgyMR-1769119750716.js","assets/index-CiRwLPeh-1769119750716.js","assets/charts-C6jPuoY4-1769119750716.js","assets/vendor-COd4auuD-1769119750716.js","assets/firebase-Dp89RMPZ-1769119750716.js","assets/index-CKY0K6o4-1769119750716.css","assets/location-C_GypjLJ-1769119750716.js"])))=>i.map(i=>d[i]);
import{j as e,_ as Ne,e as Ve,d as ue,L as Rt,S as p,u as Lt,a as $s,s as Fs,c as Gs,g as zs}from"./index-CiRwLPeh-1769119750716.js";import{r as i,R as Se}from"./charts-C6jPuoY4-1769119750716.js";import{i as se,L as Pt}from"./LoyaltyProgram-C9XIFcjK-1769119750716.js";import{o as ms,c as we,q as Hs,u as rs,d as ns,w as Us,l as Dt,e as Vt,s as $e,a as is}from"./firebase-Dp89RMPZ-1769119750716.js";import{O as Bs,s as os,t as Be}from"./native-B9ZlNmpp-1769119750716.js";import{i as $t}from"./location-C_GypjLJ-1769119750716.js";import"./vendor-COd4auuD-1769119750716.js";class Ft{constructor(){this.baseUrl="https://vpic.nhtsa.dot.gov/api/vehicles",this.fallbackModels={Acura:["ILX","Integra","MDX","NSX","RDX","RLX","TLX","ZDX"],"Alfa Romeo":["4C","Giulia","Stelvio","Tonale"],"Aston Martin":["DB11","DB12","DBS","DBX","Vantage","Vanquish","Valhalla"],Audi:["A3","A4","A5","A6","A7","A8","e-tron","e-tron GT","Q3","Q4 e-tron","Q5","Q7","Q8","R8","RS e-tron GT","RS3","RS5","RS6","RS7","S3","S4","S5","S6","S7","S8","SQ5","SQ7","SQ8","TT"],Bentley:["Bentayga","Continental GT","Flying Spur","Mulsanne"],BMW:["2 Series","3 Series","4 Series","5 Series","7 Series","8 Series","i3","i4","i7","iX","M2","M3","M4","M5","M8","X1","X2","X3","X4","X5","X6","X7","XM","Z4"],Bugatti:["Chiron","Veyron","Divo","Mistral"],Buick:["Enclave","Encore","Encore GX","Envision","Envista","LaCrosse","Regal"],Cadillac:["CT4","CT5","CTS","Escalade","Escalade ESV","Lyriq","XT4","XT5","XT6","XTS"],Chevrolet:["Blazer","Bolt EV","Bolt EUV","Camaro","Colorado","Corvette","Cruze","Equinox","Express","Impala","Malibu","Silverado 1500","Silverado 2500 HD","Silverado 3500 HD","Spark","Suburban","Tahoe","Trailblazer","Traverse","Trax","Volt"],Chrysler:["300","Pacifica","Voyager"],Dodge:["Challenger","Charger","Durango","Grand Caravan","Hornet","Journey"],Ferrari:["296","458","488","812","California","F12","F8","GTC4Lusso","LaFerrari","Portofino","Purosangue","Roma","SF90","Stradale"],Fiat:["124 Spider","500","500e","500L","500X"],Ford:["Bronco","Bronco Sport","EcoSport","Edge","Escape","Expedition","Expedition Max","Explorer","F-150","F-150 Lightning","F-250 Super Duty","F-350 Super Duty","F-450 Super Duty","Fiesta","Flex","Focus","Fusion","Maverick","Mustang","Mustang Mach-E","Ranger","Taurus","Transit","Transit Connect"],Genesis:["G70","G80","G90","GV60","GV70","GV80"],GMC:["Acadia","Canyon","Hummer EV","Savana","Sierra 1500","Sierra 2500 HD","Sierra 3500 HD","Terrain","Yukon","Yukon XL"],Honda:["Accord","Civic","Clarity","CR-V","Fit","HR-V","Insight","Odyssey","Passport","Pilot","Prologue","Ridgeline"],Hummer:["H1","H2","H3"],Hyundai:["Accent","Elantra","Ioniq 5","Ioniq 6","Kona","Palisade","Santa Cruz","Santa Fe","Sonata","Tucson","Veloster","Venue"],Infiniti:["Q50","Q60","Q70","QX30","QX50","QX55","QX60","QX80"],Jaguar:["E-PACE","F-PACE","F-TYPE","I-PACE","XE","XF","XJ"],Jeep:["Cherokee","Compass","Gladiator","Grand Cherokee","Grand Cherokee L","Grand Wagoneer","Renegade","Wagoneer","Wrangler"],Kia:["Carnival","EV6","EV9","Forte","K5","Niro","Rio","Seltos","Sorento","Soul","Sportage","Stinger","Telluride"],Lamborghini:["Aventador","Huracan","Revuelto","Urus"],"Land Rover":["Defender","Discovery","Discovery Sport","Range Rover","Range Rover Evoque","Range Rover Sport","Range Rover Velar"],Lexus:["ES","GX","IS","LC","LS","LX","NX","RC","RX","RZ","TX","UX"],Lincoln:["Aviator","Corsair","MKC","MKS","MKT","MKX","MKZ","Nautilus","Navigator"],Lotus:["Elise","Emira","Evora","Exige"],Lucid:["Air","Gravity"],Maserati:["Ghibli","GranTurismo","Grecale","Levante","MC20","Quattroporte"],Mazda:["CX-3","CX-30","CX-5","CX-50","CX-70","CX-9","CX-90","Mazda3","Mazda6","MX-5 Miata"],McLaren:["570S","600LT","720S","750S","765LT","Artura","GT","P1"],"Mercedes-Benz":["A-Class","C-Class","CLA","CLS","E-Class","EQB","EQE","EQS","G-Class","GLA","GLB","GLC","GLE","GLS","Metris","S-Class","SL","Sprinter"],Mercury:["Grand Marquis","Mariner","Milan","Mountaineer"],Mini:["Clubman","Cooper","Cooper Countryman","Countryman","Hardtop"],Mitsubishi:["Eclipse Cross","Mirage","Mirage G4","Outlander","Outlander Sport"],Nissan:["Altima","Ariya","Armada","Frontier","GT-R","Kicks","Leaf","Maxima","Murano","Pathfinder","Rogue","Sentra","Titan","Versa","Z"],Oldsmobile:["Alero","Aurora","Bravada","Intrigue","Silhouette"],Polestar:["1","2","3"],Pontiac:["G6","Grand Prix","Solstice","Vibe"],Porsche:["718 Boxster","718 Cayman","911","Cayenne","Macan","Panamera","Taycan"],Ram:["1500","2500","3500","ProMaster","ProMaster City"],Rivian:["R1S","R1T"],"Rolls-Royce":["Cullinan","Dawn","Ghost","Phantom","Spectre","Wraith"],Saab:["9-3","9-5"],Saturn:["Aura","Outlook","Sky","Vue"],Scion:["FR-S","iA","iM","tC","xB","xD"],Smart:["EQ fortwo","fortwo"],Subaru:["Ascent","BRZ","Crosstrek","Forester","Impreza","Legacy","Outback","Solterra","WRX"],Suzuki:["Grand Vitara","Kizashi","SX4"],Tesla:["Cybertruck","Model 3","Model S","Model X","Model Y"],Toyota:["4Runner","Avalon","bZ4X","Camry","Corolla","Corolla Cross","Crown","GR86","Grand Highlander","Highlander","Land Cruiser","Mirai","Prius","RAV4","Sequoia","Sienna","Supra","Tacoma","Tundra","Venza"],Volkswagen:["Arteon","Atlas","Atlas Cross Sport","Golf","Golf GTI","Golf R","ID.4","ID.Buzz","Jetta","Passat","Taos","Tiguan"],Volvo:["C40 Recharge","S60","S90","V60","V90","XC40","XC60","XC90"]}}async getMakes(){return["Acura","Alfa Romeo","Aston Martin","Audi","Bentley","BMW","Bugatti","Buick","Cadillac","Chevrolet","Chrysler","Dodge","Ferrari","Fiat","Ford","Genesis","GMC","Honda","Hummer","Hyundai","Infiniti","Jaguar","Jeep","Kia","Lamborghini","Land Rover","Lexus","Lincoln","Lotus","Lucid","Maserati","Mazda","McLaren","Mercedes-Benz","Mercury","Mini","Mitsubishi","Nissan","Oldsmobile","Polestar","Pontiac","Porsche","Ram","Rivian","Rolls-Royce","Saab","Saturn","Scion","Smart","Subaru","Suzuki","Tesla","Toyota","Volkswagen","Volvo"]}async getModels(n){const d=`${this.baseUrl}/GetModelsForMake/${n}?format=json`;let s=[],x=!1;try{const b=new AbortController,k=setTimeout(()=>b.abort(),3e3),M=await fetch(d,{signal:b.signal});clearTimeout(k),M.ok&&(s=(await M.json()).Results.map(H=>H.Model_Name),x=!0)}catch{}if(!x)try{const b=`https://corsproxy.io/?${encodeURIComponent(d)}`,k=new AbortController,M=setTimeout(()=>k.abort(),3e3),R=await fetch(b,{signal:k.signal});clearTimeout(M),R.ok&&(s=(await R.json()).Results.map(U=>U.Model_Name),x=!0)}catch{}const m=this.fallbackModels[n]||[];return x&&s.length>0?Array.from(new Set([...s,...m])).sort():m.length>0?m.sort():["Other","Model Unknown"]}suggestCategory(n,d){const s=d.toLowerCase();return s.includes("f-150")||s.includes("silverado 1500")||s.includes("ram 1500")||s.includes("tundra")||s.includes("titan")||s.includes("rivian r1t")||s.includes("cybertruck")||s.includes("hummer ev pickup")?"fullsize_truck":s.includes("f-250")||s.includes("f-350")||s.includes("silverado 2500")||s.includes("silverado 3500")||s.includes("ram 2500")||s.includes("ram 3500")?"heavy_duty_truck":s.includes("tacoma")||s.includes("colorado")||s.includes("ranger")||s.includes("canyon")||s.includes("frontier")||s.includes("maverick")||s.includes("ridgeline")||s.includes("santa cruz")?"compact_truck":s.includes("odyssey")||s.includes("sienna")||s.includes("pacifica")||s.includes("carnival")||s.includes("caravan")||s.includes("voyager")||s.includes("quest")?"minivan":s.includes("sprinter")||s.includes("transit")||s.includes("promaster")||s.includes("express")||s.includes("savana")||s.includes("metris")?"cargo_van":s.includes("tahoe")||s.includes("suburban")||s.includes("expedition")||s.includes("sequoia")||s.includes("yukon")||s.includes("armada")||s.includes("escalade")||s.includes("navigator")||s.includes("gls")||s.includes("x7")||s.includes("wagoneer")||s.includes("land cruiser")||s.includes("lx")||s.includes("qx80")||s.includes("telluride")||s.includes("palisade")||s.includes("atlas")||s.includes("traverse")||s.includes("q7")||s.includes("xc90")||s.includes("aviator")||s.includes("cullinan")||s.includes("bentayga")||s.includes("urus")||s.includes("dbx")||s.includes("cayenne")||s.includes("range rover")||s.includes("g-class")||s.includes("rivian r1s")?"large_suv":s.includes("cr-v")||s.includes("rav4")||s.includes("rogue")||s.includes("escape")||s.includes("equinox")||s.includes("cx-5")||s.includes("tucson")||s.includes("sportage")||s.includes("forester")||s.includes("outback")||s.includes("grand cherokee")||s.includes("explorer")||s.includes("highlander")||s.includes("pilot")||s.includes("mdx")||s.includes("rx")||s.includes("gle")||s.includes("x5")||s.includes("q5")||s.includes("macan")||s.includes("stelvio")||s.includes("f-pace")||s.includes("gv70")||s.includes("xc60")||s.includes("model y")||s.includes("id.4")||s.includes("mach-e")||s.includes("ioniq 5")||s.includes("bronco")||s.includes("wrangler")||s.includes("blazer")||s.includes("murano")||s.includes("crosstrek")||s.includes("hr-v")?"suv":s.includes("civic")||s.includes("corolla")||s.includes("mazda3")||s.includes("sentra")||s.includes("elantra")||s.includes("forte")||s.includes("focus")||s.includes("cruze")||s.includes("golf")||s.includes("impreza")||s.includes("a3")||s.includes("2 series")||s.includes("cla")||s.includes("a-class")||s.includes("mini")||s.includes("spark")||s.includes("mirage")||s.includes("rio")||s.includes("versa")?"compact_car":"midsize_sedan"}}const ds=new Ft,Gt=({isOpen:a,onClose:n,onSave:d,onDelete:s,vehicleTypes:x,initialVehicle:m})=>{const[b,k]=i.useState({make:"",model:"",year:"",color:"",plate:"",type:""}),[M,R]=i.useState(null);i.useRef(null);const[H,U]=i.useState([]),[g,o]=i.useState([]),[f,u]=i.useState(""),[C,E]=i.useState(""),[S,P]=i.useState(!1),D=new Date().getFullYear(),j=Array.from({length:D-1989},(r,A)=>(D+1-A).toString());i.useEffect(()=>{var r;a&&(N(),m?(k({make:m.make,model:m.model,year:m.year,color:m.color,plate:m.plate||"",type:m.type}),u(m.make),E(m.model),R(m.image||null),y(m.make,!0)):(k({make:"",model:"",year:"",color:"",plate:"",type:((r=x==null?void 0:x[0])==null?void 0:r.id)||""}),R(null),u(""),E("")))},[a,m]);const N=async()=>{const r=await ds.getMakes();U(r)},y=async(r,A=!1)=>{u(r),P(!0);const v=await ds.getModels(r);o(v),P(!1),A||(E(""),k(B=>({...B,make:r,model:""})))},W=r=>{E(r);const A=ds.suggestCategory(f,r),v=x.find(B=>B.id===A);k(B=>{var T;return{...B,model:r,type:v?v.id:((T=x==null?void 0:x[0])==null?void 0:T.id)||"sedan"}})},[h,I]=i.useState(!1),G=async()=>{try{I(!0);const{Camera:r,CameraResultType:A,CameraSource:v}=await Ne(async()=>{const{Camera:T,CameraResultType:V,CameraSource:L}=await import("./index-1bqWgyMR-1769119750716.js");return{Camera:T,CameraResultType:V,CameraSource:L}},__vite__mapDeps([0,1,2,3,4,5])),B=await r.getPhoto({quality:60,allowEditing:!1,resultType:A.DataUrl,source:v.Photos,width:1024});B.dataUrl&&R(B.dataUrl)}catch(r){console.error("Error processing image",r),r.message}finally{I(!1)}},K=()=>{if(!b.model||!b.color||!b.year||!b.make)return;const r={make:String(b.make),model:String(b.model),year:String(b.year),color:String(b.color),plate:b.plate?String(b.plate):"",type:String(b.type)};d(r,M),n()},J=()=>{s&&confirm("Are you sure you want to delete this vehicle?")&&(s(),n())};return a?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-surface-dark w-full sm:max-w-lg rounded-t-3xl sm:rounded-3xl border border-white/10 shadow-2xl flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-4 border-b border-white/10 flex items-center justify-between",children:[e.jsx("h2",{className:"font-bold text-xl",children:m?"Edit Vehicle":"Add New Vehicle"}),e.jsx("button",{onClick:n,className:"p-2 bg-white/5 rounded-full hover:bg-white/10",children:e.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsx("div",{className:"w-full h-32 rounded-xl bg-white/5 border border-dashed border-white/20 flex flex-col items-center justify-center cursor-pointer hover:bg-white/10 transition-colors",onClick:G,children:M?e.jsx("img",{src:M,className:"w-full h-full object-cover rounded-xl",alt:"Vehicle"}):h?e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-400",children:[e.jsx("span",{className:"material-symbols-outlined animate-spin mb-2",children:"progress_activity"}),e.jsx("span",{className:"text-xs",children:"Processing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-400 mb-2",children:"add_a_photo"}),e.jsxs("span",{className:"text-xs text-slate-400",children:["Tap to ",m?"change":"add"," photo"]})]})}),e.jsxs("div",{className:"space-y-4 animate-fadeIn",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1 uppercase",children:"Make"}),e.jsxs("select",{className:"w-full h-12 bg-slate-900 border border-white/10 rounded-xl px-4 text-white outline-none focus:border-primary transition-colors appearance-none",value:f,onChange:r=>y(r.target.value),children:[e.jsx("option",{value:"",className:"bg-slate-900 text-white",children:"Select Make"}),H.map(r=>e.jsx("option",{value:r,className:"bg-slate-900 text-white",children:r},r))]})]}),f&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1 uppercase",children:"Model"}),e.jsx("div",{className:"relative",children:e.jsxs("select",{className:"w-full h-12 bg-slate-900 border border-white/10 rounded-xl px-4 text-white outline-none focus:border-primary transition-colors appearance-none",value:C,onChange:r=>W(r.target.value),disabled:S,children:[e.jsx("option",{value:"",className:"bg-slate-900 text-white",children:S?"Loading...":"Select Model"}),g.map(r=>e.jsx("option",{value:r,className:"bg-slate-900 text-white",children:r},r))]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1 uppercase",children:"Year"}),e.jsxs("select",{className:"w-full h-12 bg-slate-900 border border-white/10 rounded-xl px-4 text-white outline-none focus:border-primary transition-colors appearance-none",value:b.year,onChange:r=>k({...b,year:r.target.value}),children:[e.jsx("option",{value:"",className:"bg-slate-900 text-white",children:"Select Year"}),j.map(r=>e.jsx("option",{value:r,className:"bg-slate-900 text-white",children:r},r))]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1 uppercase",children:"Color"}),e.jsx("input",{type:"text",placeholder:"e.g. Black",value:b.color,onChange:r=>k({...b,color:r.target.value}),className:"w-full h-12 bg-white/5 border border-white/10 rounded-xl px-4 text-white placeholder:text-slate-500"})]})})]})]}),e.jsxs("div",{className:"p-4 border-t border-white/10 bg-surface-dark pb-8 sm:pb-4 rounded-b-3xl flex gap-3",children:[m&&s&&e.jsx("button",{onClick:J,className:"h-14 w-14 bg-red-500/10 text-red-500 rounded-xl flex items-center justify-center hover:bg-red-500/20 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined",children:"delete"})}),e.jsxs("button",{onClick:K,disabled:!b.model||!b.year||!b.color,className:"flex-1 h-14 bg-primary text-white rounded-xl font-bold hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-blue",children:[e.jsx("span",{className:"material-symbols-outlined",children:"check"}),m?"Update Vehicle":"Save Vehicle"]})]})]})]}):null},zt=({onClick:a,unreadCount:n=0,label:d="Message"})=>e.jsxs("button",{onClick:a,className:"fixed bottom-24 right-4 z-50 flex items-center gap-3 bg-white/10 backdrop-blur-md border border-white/20 text-white pl-4 pr-5 py-3 rounded-full shadow-2xl hover:bg-white/20 transition-all active:scale-95 group",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary text-black flex items-center justify-center font-bold shadow-lg shadow-primary/20 group-hover:scale-110 transition-transform",children:e.jsx("span",{className:"material-symbols-outlined text-xl",children:"chat_bubble"})}),n>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full border-2 border-[#101822] flex items-center justify-center",children:e.jsx("span",{className:"text-[10px] font-bold text-white",children:n>9?"9+":n})})]}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"text-xs text-slate-400 font-bold uppercase tracking-wider",children:"Support"}),e.jsx("span",{className:"font-bold text-sm",children:d})]})]});function Ye(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ye=function(n){return typeof n}:Ye=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ye(a)}var Os="clover",Ht=function(n){return n===3?"v3":n},Xs="https://js.stripe.com",Ut="".concat(Xs,"/").concat(Os,"/stripe.js"),Wt=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Bt=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var Ot=function(n){return Wt.test(n)||Bt.test(n)},Xt=function(){for(var n=document.querySelectorAll('script[src^="'.concat(Xs,'"]')),d=0;d<n.length;d++){var s=n[d];if(Ot(s.src))return s}return null},Ws=function(n){var d="",s=document.createElement("script");s.src="".concat(Ut).concat(d);var x=document.head||document.body;if(!x)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return x.appendChild(s),s},Yt=function(n,d){!n||!n._registerWrapper||n._registerWrapper({name:"stripe-js",version:"8.6.3",startTime:d})},Fe=null,Oe=null,Xe=null,qt=function(n){return function(d){n(new Error("Failed to load Stripe.js",{cause:d}))}},Qt=function(n,d){return function(){window.Stripe?n(window.Stripe):d(new Error("Stripe.js not available"))}},Kt=function(n){return Fe!==null?Fe:(Fe=new Promise(function(d,s){if(typeof window>"u"||typeof document>"u"){d(null);return}if(window.Stripe){d(window.Stripe);return}try{var x=Xt();if(!(x&&n)){if(!x)x=Ws(n);else if(x&&Xe!==null&&Oe!==null){var m;x.removeEventListener("load",Xe),x.removeEventListener("error",Oe),(m=x.parentNode)===null||m===void 0||m.removeChild(x),x=Ws(n)}}Xe=Qt(d,s),Oe=qt(s),x.addEventListener("load",Xe),x.addEventListener("error",Oe)}catch(b){s(b);return}}),Fe.catch(function(d){return Fe=null,Promise.reject(d)}))},Jt=function(n,d,s){if(n===null)return null;var x=d[0];if(typeof x!="string")throw new Error("Expected publishable key to be of type string, got type ".concat(Ye(x)," instead."));var m=x.match(/^pk_test/),b=Ht(n.version),k=Os;m&&b!==k&&console.warn("Stripe.js@".concat(b," was loaded on the page, but @stripe/stripe-js@").concat("8.6.3"," expected Stripe.js@").concat(k,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var M=n.apply(void 0,d);return Yt(M,s),M},Ge,Ys=!1,qs=function(){return Ge||(Ge=Kt(null).catch(function(n){return Ge=null,Promise.reject(n)}),Ge)};Promise.resolve().then(function(){return qs()}).catch(function(a){Ys||console.warn(a)});var Zt=function(){for(var n=arguments.length,d=new Array(n),s=0;s<n;s++)d[s]=arguments[s];Ys=!0;var x=Date.now();return qs().then(function(m){return Jt(m,d,x)})};const ea=Zt("pk_live_51Sb7Q9PCM2SvaE3Bs5ZODcpJ1j1XnSX90gavAQpAd9iMMTB1Su6zqbT89Q1mgCg7m6YDUdZe069KvpYn3XbWIxpA00ihDBxG6v"),sa=({amount:a,orderId:n,onSuccess:d,onClose:s})=>{const[x,m]=i.useState(null),[b,k]=i.useState(null),[M,R]=i.useState(null),[H,U]=i.useState(null),[g,o]=i.useState(!1),[f,u]=i.useState([]),[C,E]=i.useState(null),[S,P]=i.useState(!1),[D,j]=i.useState(!1),N=i.useRef(null);i.useEffect(()=>{ea.then(h=>{h&&m(h)})},[]),i.useEffect(()=>{if(!Ve.currentUser)return;const h=ms(we(ue,"users",Ve.currentUser.uid,"paymentMethods"),I=>{const G=[];I.forEach(K=>{G.push(K.data())}),u(G),G.length>0&&!C&&E(G[0].cardId)});return()=>h()},[]),i.useEffect(()=>{if(!x||!N.current||!S&&f.length>0)return;const h=x.elements(),I=h.create("card",{style:{base:{fontSize:"16px",color:"#1e293b","::placeholder":{color:"#94a3b8"}},invalid:{color:"#ef4444"}}});return I.mount(N.current),k(h),R(I),()=>{I.unmount()}},[x,S,f.length]);const y=async h=>{if(h.preventDefault(),!x){U("Stripe not loaded");return}o(!0),U(null);try{const I=Ve.currentUser;if(!I)throw new Error("User not authenticated");const G=await I.getIdToken();if(!M)throw new Error("Card element not initialized");const{error:K,paymentMethod:J}=await x.createPaymentMethod({type:"card",card:M});if(K)throw new Error(K.message);console.log("âœ… Stripe payment method created:",J==null?void 0:J.id);const r=await fetch("/api/saveStripeCard",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${G}`},body:JSON.stringify({paymentMethodId:J==null?void 0:J.id,saveCard:!0})}),A=await r.json();if(!r.ok)throw new Error(A.message||"Failed to save card");console.log("âœ… Card saved successfully:",A),d(A.cardId),s()}catch(I){console.error("âŒ Save card error:",I),U(I.message||"An error occurred")}finally{o(!1)}},W=async h=>{if(Ve.currentUser)try{const I=await Ve.currentUser.getIdToken();if(!(await fetch("/api/deleteStripeCard",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${I}`},body:JSON.stringify({cardId:h})})).ok)throw new Error("Failed to delete card");console.log("âœ… Card deleted successfully")}catch(I){console.error("âŒ Delete error:",I),U(I.message)}};return e.jsxs("div",{className:"space-y-6",children:[a>0&&e.jsxs("div",{className:"p-4 rounded-xl bg-primary/10 border border-primary/20 text-center",children:[e.jsx("p",{className:"text-xs text-slate-400 uppercase font-bold tracking-widest mb-1",children:"Total to Authorize"}),e.jsxs("p",{className:"text-3xl font-black text-white",children:["$",a.toFixed(2)]})]}),f.length>0&&!S&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:"Saved Payment Methods"}),e.jsx("div",{className:"space-y-3",children:f.map(h=>e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-2xl border transition-all cursor-pointer ${C===h.cardId?"border-primary bg-primary/10 shadow-[0_0_15px_rgba(59,130,246,0.2)]":"border-white/10 bg-white/5 hover:bg-white/10"}`,onClick:()=>E(h.cardId),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${C===h.cardId?"bg-primary text-white":"bg-white/10 text-slate-400"}`,children:e.jsx("span",{className:"material-symbols-outlined",children:"credit_card"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-white capitalize",children:[h.brand," â€¢â€¢â€¢â€¢ ",h.last4]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Expires ",h.expMonth,"/",h.expYear]})]})]}),e.jsx("button",{onClick:I=>{I.stopPropagation(),W(h.cardId)},className:"w-10 h-10 rounded-lg hover:bg-red-500/10 text-slate-500 hover:text-red-400 transition-all flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-xl",children:"delete"})})]},h.cardId))}),C&&e.jsx("button",{onClick:()=>{d(C),s()},className:"w-full h-14 bg-primary text-white font-bold rounded-2xl hover:brightness-110 active:scale-[0.98] transition-all shadow-lg shadow-primary/25",children:"Use Selected Card"}),e.jsx("button",{onClick:()=>P(!0),className:"w-full py-4 rounded-2xl border-2 border-dashed border-white/10 text-slate-400 hover:border-primary/50 hover:text-primary transition-all font-bold text-sm",children:"+ Add New Payment Method"})]}),(S||f.length===0)&&e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-400 uppercase tracking-widest px-1",children:"Card Details"}),e.jsx("div",{ref:N,className:"p-4 bg-white rounded-xl shadow-inner"}),e.jsx("p",{className:"text-[10px] text-slate-500 px-1 italic",children:"Your card details are securely processed by Stripe. We never store your full card number."})]}),H&&e.jsxs("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400 text-sm flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined",children:"error"}),H]}),e.jsxs("div",{className:"flex gap-3",children:[f.length>0&&e.jsx("button",{type:"button",onClick:()=>P(!1),className:"h-14 px-6 rounded-2xl bg-white/5 border border-white/10 text-slate-300 font-bold hover:bg-white/10 transition-all",children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"})}),e.jsx("button",{type:"submit",disabled:!x||g,className:"flex-1 h-14 bg-primary text-white font-bold rounded-2xl hover:brightness-110 active:scale-[0.98] disabled:opacity-50 disabled:grayscale disabled:cursor-not-allowed transition-all shadow-lg shadow-primary/25",children:g?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Processing..."})]}):"Save & Use Card"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 pt-4 border-t border-white/5",children:[e.jsx("span",{className:"material-symbols-outlined text-slate-500 text-sm",children:"lock"}),e.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:"Stripe Secure Infrastructure"})]})]})},cs=a=>a.isOpen?e.jsxs("div",{className:"fixed inset-0 z-50 bg-black/95 flex items-center justify-center p-4 backdrop-blur-md",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-primary/10 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-cyan-500/10 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}})]}),e.jsxs("div",{className:"relative bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white w-full max-w-md rounded-3xl overflow-hidden shadow-2xl animate-in fade-in zoom-in-95 duration-300 border border-white/10",children:[e.jsxs("div",{className:"relative p-6 border-b border-white/10 bg-gradient-to-r from-slate-800/50 to-slate-900/50",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/5 to-cyan-500/5"}),e.jsxs("div",{className:"relative flex justify-between items-center",children:[e.jsxs("h3",{className:"font-black text-xl flex items-center gap-3",children:[e.jsx("img",{src:"/logo.png",alt:"Logo",className:"w-10 h-10 rounded-xl shadow-lg shadow-primary/30",onError:n=>{n.currentTarget.style.display="none";const d=n.currentTarget.nextElementSibling;d&&d.classList.remove("hidden")}}),e.jsx("div",{className:"hidden w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-cyan-600 flex items-center justify-center shadow-lg shadow-primary/30",children:e.jsx("span",{className:"material-symbols-outlined text-black text-xl",children:"credit_card"})}),e.jsx("span",{className:"bg-gradient-to-r from-primary to-cyan-400 bg-clip-text text-transparent",children:"Secure Checkout"})]}),e.jsx("button",{onClick:a.onClose,className:"w-10 h-10 rounded-xl bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white transition-all flex items-center justify-center group",children:e.jsx("span",{className:"material-symbols-outlined group-hover:rotate-90 transition-transform",children:"close"})})]})]}),e.jsx("div",{className:"p-8 relative",children:e.jsx(sa,{amount:a.amount,orderId:a.orderId,onSuccess:n=>a.onSuccess(n),onClose:a.onClose})}),e.jsxs("div",{className:"px-8 pb-6 flex items-center justify-center gap-2 text-xs text-slate-400",children:[e.jsx("span",{className:"material-symbols-outlined text-primary text-sm",children:"verified_user"}),e.jsx("span",{className:"font-semibold",children:"256-bit SSL Encrypted"})]})]})]}):null,ta=[{elementType:"geometry",stylers:[{color:"#1a1a2e"}]},{elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#6b7280"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#2c2c54"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#474787"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#0f1419"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#9ca3af"},{visibility:"on"}]},{featureType:"administrative.locality",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]}],aa=`
<svg width="50" height="50" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
    <circle cx="50" cy="50" r="45" fill="#3b82f6" fill-opacity="0.2" stroke="#3b82f6" stroke-width="2"/>
    <rect x="30" y="25" width="40" height="50" rx="8" fill="#3b82f6" />
    <rect x="35" y="35" width="30" height="12" rx="2" fill="white" fill-opacity="0.8" />
    <circle cx="35" cy="75" r="8" fill="#111827" />
    <circle cx="65" cy="75" r="8" fill="#111827" />
</svg>
`,la=({washerLocation:a,clientLocation:n,status:d,washerName:s="Washer",eta:x,orderId:m})=>{const b=i.useRef(null),[k,M]=i.useState(null),[R,H]=i.useState(null),[U,g]=i.useState(null),[o]=i.useState(()=>new google.maps.DirectionsService),f=i.useRef(0);return i.useEffect(()=>{if(!b.current||!n)return;const u=new google.maps.Map(b.current,{center:n,zoom:15,styles:ta,disableDefaultUI:!0});M(u),new google.maps.Marker({position:n,map:u,icon:{path:google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#10b981",fillOpacity:1,strokeColor:"#ffffff",strokeWeight:2},title:"Customer"})},[n]),i.useEffect(()=>{if(console.log("ðŸ—ºï¸ [TrackingMap] useEffect(route) fired",{hasMap:!!k,washerLocation:a,clientLocation:n}),!k||!a||!n)return;if(a.lat===0&&a.lng===0){console.log("ðŸ—ºï¸ [TrackingMap] Skipping route: washerLocation is (0,0)");return}if(n.lat===0&&n.lng===0)return;const u=()=>{const E=Date.now();if(E-f.current<6e4&&f.current!==0){console.log("â­ï¸ [TrackingMap] Skipping route calculation (< 60s since last)");return}console.log("ðŸ—ºï¸ [TrackingMap] Calculating route (API call)..."),f.current=E,o.route({origin:a,destination:n,travelMode:google.maps.TravelMode.DRIVING},(S,P)=>{var D;if(P===google.maps.DirectionsStatus.OK&&S){const j=S.routes[0].overview_path,N=((D=S.routes[0].legs[0].duration)==null?void 0:D.value)||0,y=Math.ceil(N/60);if(console.log(`â±ï¸ [TrackingMap] Google ETA: ${y} minutes`),m&&y>0&&Ne(async()=>{const{db:h}=await import("./index-CiRwLPeh-1769119750716.js").then(I=>I.X);return{db:h}},__vite__mapDeps([1,2,3,4,5])).then(({db:h})=>{Ne(async()=>{const{doc:I,updateDoc:G}=await import("./firebase-Dp89RMPZ-1769119750716.js").then(K=>K.ac);return{doc:I,updateDoc:G}},[]).then(({doc:I,updateDoc:G})=>{G(I(h,"orders",m),{estimatedArrival:y}).then(()=>{console.log(`âœ… [TrackingMap] ETA updated in Firestore: ${y} min`)}).catch(K=>{console.error("âŒ [TrackingMap] Failed to update ETA:",K)})})}),U)U.setPath(j);else{const h=new google.maps.Polyline({path:j,strokeColor:"#3b82f6",strokeOpacity:.8,strokeWeight:8,map:k});g(h)}const W=new google.maps.LatLngBounds;j.forEach(h=>W.extend(h)),k.fitBounds(W,{top:150,bottom:200,left:50,right:50})}})};u();const C=setInterval(()=>{console.log("â° [TrackingMap] 60 seconds elapsed, recalculating route..."),u()},6e4);return()=>clearInterval(C)},[k,n,a]),i.useEffect(()=>{if(!(!k||!a||a.lat===0&&a.lng===0)){if(!R||R.getMap()!==k)if(R)console.log("ðŸ“ [TrackingMap] Re-associating washer marker with new map"),R.setMap(k);else{console.log("ðŸ“ [TrackingMap] Creating washer marker at",a);const u=new google.maps.Marker({position:a,map:k,zIndex:99999,optimized:!1,icon:{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(aa),scaledSize:new google.maps.Size(50,50),anchor:new google.maps.Point(25,25)},title:s});H(u)}else console.log("ðŸ“ [TrackingMap] Moving washer marker to",a),R.setPosition(a);if(k&&n){const u=new google.maps.LatLngBounds;u.extend(n),u.extend(a),k.fitBounds(u,{top:100,bottom:100,left:50,right:50})}}},[k,a,R,s,n]),e.jsxs("div",{className:"absolute inset-0 z-0",children:[e.jsx("div",{ref:b,className:"w-full h-full"}),e.jsxs("div",{className:"absolute bottom-32 right-4 flex flex-col items-end gap-2 z-10",children:[e.jsxs("div",{className:"bg-black/60 backdrop-blur-md px-3 py-1.5 rounded-full flex items-center gap-2 border border-white/10 shadow-lg",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsxs("span",{className:"text-[10px] font-black text-green-400 uppercase tracking-widest",children:["LIVE GPS v3.0.5 ",x&&`â€¢ ${x} MIN`]})]}),(!a||a.lat===0&&a.lng===0)&&e.jsx("div",{className:"bg-orange-500/80 backdrop-blur-md px-3 py-1.5 rounded-lg border border-orange-400/50 shadow-lg animate-bounce",children:e.jsx("span",{className:"text-[10px] font-black text-white uppercase tracking-widest",children:"Waiting for GPS Signal..."})})]})]})},ra=({activeTrackingOrder:a,user:n,setTrackingOrderId:d,setShowOrderChat:s,showOrderChat:x,messages:m,sendMessage:b,updateOrder:k,showNativeToast:M,submitOrderRating:R,navigate:H,packages:U,addons:g})=>{var I,G,K,J;const[o,f]=Se.useState(0),[u,C]=Se.useState(0),[E,S]=Se.useState(null),[P,D]=Se.useState(""),[j,N]=Se.useState(null);Se.useEffect(()=>{if(!(a!=null&&a.washerLocation)){if(a!=null&&a.washerId){const r=Rt.subscribeToWasherLocation(a.washerId,A=>{A&&(console.log("ðŸŒ [TrackingUI] Using global washer location fallback:",A),N(A))});return()=>r()}}},[a==null?void 0:a.washerLocation,a==null?void 0:a.washerId]);const y=(I=a==null?void 0:a.washerLocation)!=null&&I.lat?a.washerLocation:j,h=(()=>{const r=T=>{if(!T)return 0;let V=0;const L=T.match(/(\d+(\.\d+)?)\s*(h|hour|hours)/i),O=T.match(/(\d+)\s*(m|min|minute|minutes)/i);return L&&(V+=parseFloat(L[1])*60),O&&(V+=parseInt(O[1])),!L&&!O&&!isNaN(parseInt(T))&&(V+=parseInt(T)),V};let A=0;if(a.vehicleConfigs&&a.vehicleConfigs.length>0)a.vehicleConfigs.forEach(T=>{const V=U.find(L=>L.id===T.packageId);V!=null&&V.duration&&(A+=r(V.duration)),T.addonIds&&T.addonIds.forEach(L=>{const O=g.find(je=>je.id===L);O!=null&&O.duration&&(A+=r(O.duration))})});else{const T=U.find(V=>V.id===a.packageId);T!=null&&T.duration&&(A+=r(T.duration)),a.addons&&a.addons.forEach(V=>{const L=g.find(O=>O.name===V||O.id===V);L!=null&&L.duration&&(A+=r(L.duration))})}if(A===0)return null;const v=Math.floor(A/60),B=A%60;return v>0?`${v}h ${B>0?B+"m":""}`:`${B} min`})();return a?e.jsxs("div",{className:"fixed inset-0 z-50 bg-gradient-to-b from-black via-slate-950 to-black flex flex-col",children:[e.jsxs("div",{className:`flex items-center justify-between px-4 py-4 z-50 transition-all ${a.status==="En Route"?"bg-transparent absolute top-0 left-0 right-0":"bg-black/40 backdrop-blur-md border-b border-white/10"}`,children:[e.jsx("button",{onClick:()=>d(null),className:"text-white p-2 hover:bg-white/10 rounded-full transition-colors active:scale-90",children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back_ios_new"})}),e.jsx("h1",{className:"font-black uppercase tracking-[0.2em] text-sm",children:a.status==="En Route"?"":"Order Tracking"}),e.jsx("div",{className:"w-10 h-10 rounded-full border-2 border-[#3b82f6]/30 overflow-hidden bg-white/5 shadow-blue",children:n.avatar?e.jsx("img",{src:n.avatar,alt:n.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-[#3b82f6] to-blue-600 text-[10px] font-black text-white",children:(G=n.name)==null?void 0:G.charAt(0)})})]}),e.jsxs("div",{className:"flex-1 flex flex-col relative overflow-hidden",children:[a.status==="Pending"&&e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center animate-fade-in bg-gradient-to-b from-black via-[#3b82f6]/10 to-black relative",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_#3b82f620_0%,_transparent_70%)] pointer-events-none"}),e.jsxs("div",{className:"relative w-48 h-48 mb-8 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-primary/20 rounded-full animate-ping opacity-75"}),e.jsx("div",{className:"relative w-36 h-36 rounded-full bg-gradient-to-br from-[#3b82f6]/30 to-blue-400/30 flex items-center justify-center border-2 border-primary/50 shadow-blue-lg",children:e.jsx("span",{className:"material-symbols-outlined text-4xl text-white",children:"search"})})]}),e.jsx("h2",{className:"text-4xl font-black mb-4 text-white drop-shadow-blue tracking-tight",children:"Finding a Washer"}),e.jsx("p",{className:"text-slate-300 font-medium",children:"We are contacting nearby washers..."})]}),a.status==="Assigned"&&e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center animate-fade-in bg-gradient-to-b from-black via-slate-900 to-black w-full",children:[e.jsx("h2",{className:"text-4xl font-black mb-4 text-primary shadow-blue animate-pulse tracking-tight",children:"He's getting ready!"}),e.jsxs("p",{className:"text-slate-300 mb-10 text-lg",children:[e.jsx("span",{className:"text-primary font-black",children:a.washerName||"Washer"})," is preparing."]}),e.jsxs("button",{onClick:()=>s(!0),className:"w-full max-w-[300px] py-4 bg-[#1a1a1c] border border-white/10 rounded-2xl font-black text-white flex items-center justify-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined",children:"chat"})," Message Washer"]})]}),a.status==="En Route"&&e.jsxs("div",{className:"flex-1 relative bg-black overflow-hidden flex flex-col",children:[e.jsx(la,{washerLocation:y?{lat:y.lat||y.latitude||0,lng:y.lng||y.longitude||0}:void 0,clientLocation:a.location?{lat:a.location.lat||a.location.latitude||0,lng:a.location.lng||a.location.longitude||0}:void 0,status:a.status,serviceRadius:20,washerName:a.washerName||"Your Washer",orderId:a.id,eta:a.estimatedArrival?typeof a.estimatedArrival=="number"?a.estimatedArrival:parseInt(a.estimatedArrival.toString().replace(/\D/g,""))||10:10}),e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex flex-col justify-between p-4 pb-12",children:[e.jsx("div",{className:"bg-black/80 backdrop-blur-xl border border-[#3b82f6]/20 p-5 rounded-[2.5rem] shadow-2xl flex items-center gap-5",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-[#3b82f6] font-black text-[10px] uppercase tracking-[0.25em]",children:["Heading to you â€¢ ",(K=a.estimatedArrival)!=null&&K.toString().includes("min")?a.estimatedArrival:`${a.estimatedArrival||"10"} min`]}),e.jsxs("p",{className:"text-white text-lg font-black",children:[a.washerName," is on his way"]})]})}),e.jsx("div",{className:"pointer-events-auto",children:e.jsxs("button",{onClick:()=>s(!0),className:"w-full py-5 bg-black/80 backdrop-blur-xl border border-white/10 rounded-3xl font-black text-white flex items-center justify-center gap-3 shadow-2xl uppercase tracking-[0.25em] text-xs",children:[e.jsx("span",{className:"material-symbols-outlined text-xl text-[#3b82f6]",children:"chat_bubble"})," Message Washer"]})})]})]}),a.status==="Arrived"&&e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-start pt-0 p-6 text-center animate-fade-in bg-black w-full overflow-y-auto",children:[e.jsxs("div",{className:"relative w-32 h-32 mb-2 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-500/15 rounded-full animate-pulse"}),e.jsx("div",{className:"relative w-20 h-20 rounded-full border-4 border-blue-500/40 flex items-center justify-center shadow-[0_0_30px_rgba(59,130,246,0.4)]",children:e.jsx("span",{className:"material-symbols-outlined text-2xl text-blue-400",children:"location_on"})})]}),e.jsxs("div",{className:"w-full max-w-[320px] bg-slate-900/50 backdrop-blur-md border border-white/10 p-3 rounded-[1.5rem] flex items-center gap-3 mb-6 shadow-xl text-left",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl overflow-hidden border border-primary/30",children:a.washerAvatar?e.jsx("img",{src:a.washerAvatar,className:"w-full h-full object-cover",alt:"Washer"}):e.jsx("div",{className:"w-full h-full bg-primary/20 flex items-center justify-center text-primary font-black text-lg",children:(J=a.washerName)==null?void 0:J.charAt(0)})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-[#3b82f6] text-[8px] font-black uppercase tracking-[0.2em] mb-0.5",children:"Washer is here"}),e.jsx("h3",{className:"text-white text-base font-black truncate",children:a.washerName})]})]}),e.jsxs("div",{className:"flex flex-col items-center w-full max-w-[320px]",children:[e.jsx("h2",{className:"text-3xl font-black mb-1 text-primary drop-shadow-[0_0_15px_rgba(59,130,246,0.8)] tracking-tight",children:"Ready to Start!"}),e.jsx("p",{className:"text-white text-sm max-w-[260px] mb-6 font-medium opacity-90",children:"Your washer has arrived. Please approve to begin."}),e.jsxs("button",{onClick:async()=>{window.confirm("Authorize washer to start?")&&(await k(a.id,{clientAuthorized:!0}),M("Service authorized!"))},className:"w-full bg-primary py-4 rounded-xl font-black text-white flex items-center justify-center gap-2 uppercase tracking-[0.2em] text-sm shadow-[0_10px_40px_rgba(59,130,246,0.5)] active:scale-[0.98] transition-all",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"play_circle"})," Authorize Start"]})]})]}),a.status==="In Progress"&&e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center animate-fade-in bg-black w-full",children:[e.jsx("h2",{className:"text-4xl font-black mb-4 text-white tracking-tight",children:"Washing your Car!"}),h&&e.jsxs("div",{className:"mb-8 animate-fade-in bg-white/5 px-6 py-4 rounded-2xl border border-white/10 backdrop-blur-md",children:[e.jsx("p",{className:"text-slate-400 text-xs font-bold uppercase tracking-[0.2em] mb-1",children:"Estimated Time"}),e.jsxs("div",{className:"flex items-baseline justify-center gap-1",children:[e.jsx("span",{className:"text-3xl font-black text-white",children:h}),e.jsx("span",{className:"text-sm text-slate-500 font-bold",children:"approx"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-primary/10 px-6 py-3 rounded-full border border-primary/20 shadow-blue mb-8",children:[e.jsx("span",{className:"w-2 h-2 bg-primary rounded-full animate-pulse"}),e.jsx("p",{className:"text-primary font-bold tracking-widest text-sm uppercase",children:"In Progress"})]})]}),a.status==="Completed"&&e.jsxs("div",{className:"flex-1 flex flex-col p-6 animate-fade-in bg-black overflow-y-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("span",{className:"material-symbols-outlined text-6xl text-primary font-bold animate-bounce mb-4",children:"check_circle"}),e.jsx("h2",{className:"text-3xl font-black text-white mb-2 uppercase tracking-tighter",children:"Wash Completed!"})]}),e.jsxs("div",{className:"bg-surface-dark border border-white/10 rounded-3xl p-6 shadow-2xl mb-6",children:[e.jsx("p",{className:"text-center text-xs font-black text-slate-500 mb-6 uppercase tracking-[0.2em]",children:"Rate your experience"}),e.jsx("div",{className:"flex justify-center gap-3 mb-8",children:[1,2,3,4,5].map(r=>e.jsx("button",{onClick:()=>f(r),className:`transition-all active:scale-90 ${o>=r?"scale-110":"opacity-30 grayscale"}`,children:e.jsx("span",{className:`material-symbols-outlined text-5xl ${o>=r?'text-yellow-400 [font-variation-settings:"FILL"_1]':"text-slate-400"}`,children:"star"})},r))}),o>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-4 gap-2",children:["10%","15%","20%","25%"].map(r=>{const A=parseInt(r),v=Math.round((a.price||0)*A/100),B=E===r;return e.jsxs("button",{onClick:()=>{B?(S(null),C(0)):(S(r),C(v))},className:`py-3 rounded-xl border transition-all ${B?"bg-primary border-primary text-black":"bg-white/5 border-white/10 text-white hover:bg-white/10"}`,children:[e.jsx("div",{className:"text-xs font-bold",children:r}),e.jsxs("div",{className:"text-[9px] opacity-80",children:["$",v]})]},r)})}),e.jsx("textarea",{placeholder:"Review (Optional)...",value:P,onChange:r=>D(r.target.value),className:"w-full bg-black/50 border border-white/10 rounded-2xl p-4 text-white placeholder-slate-500 focus:outline-none focus:border-primary/50 transition-colors"})]})]}),e.jsx("button",{disabled:o===0,onClick:async()=>{try{await R(a.id,{clientRating:o,clientReview:P,tip:u,washerId:a.washerId||""}),d(null),H("CLIENT_HOME"),M("Thanks!")}catch{M("Error")}},className:"w-full bg-primary text-white py-5 rounded-2xl font-black uppercase tracking-widest text-sm",children:"Finish"})]})]}),a.washerId&&e.jsx(Bs,{orderId:a.id,currentUserId:n.id,currentUserName:n.name,otherUserId:a.washerId,otherUserName:a.washerName||"Washer",messages:m,sendMessage:b,isOpen:x,onClose:()=>s(!1)})]}):null},na=({currentUser:a,onClose:n})=>{const[d,s]=i.useState([]),[x,m]=i.useState(""),[b,k]=i.useState(null),[M,R]=i.useState(!0),H=i.useRef(null);i.useEffect(()=>{if(!a){R(!1);return}(async()=>{const f=setTimeout(()=>{M&&R(!1)},5e3);try{const u=we(ue,"supportTickets"),C=Hs(u,Us("clientId","==",a.id),Us("status","==","open"),Dt(1)),E=await Vt(C);if(E.empty)s([{id:"welcome",senderId:"system",senderName:"Technical Support",senderRole:"admin",message:"ðŸ‘‹ Hello! How can we help you today?",timestamp:{toDate:()=>new Date},read:!1}]);else{const S=E.docs[0];k(S.id),await rs(ns(ue,"supportTickets",S.id),{unreadByClient:0})}}catch(u){console.error("Error loading ticket:",u)}finally{clearTimeout(f),R(!1)}})()},[a]),i.useEffect(()=>{if(!b)return;const o=we(ue,"supportTickets",b,"messages"),f=Hs(o),u=ms(f,C=>{const E=C.docs.map(S=>({id:S.id,...S.data()}));s(E.sort((S,P)=>{var D,j,N,y;return(((j=(D=S.timestamp)==null?void 0:D.toMillis)==null?void 0:j.call(D))||0)-(((y=(N=P.timestamp)==null?void 0:N.toMillis)==null?void 0:y.call(N))||0)})),U(),C.docs.forEach(async S=>{const P=S.data();P.senderRole==="admin"&&!P.read&&await rs(ns(ue,"supportTickets",b,"messages",S.id),{read:!0})})});return()=>u()},[b]);const U=()=>{var o;(o=H.current)==null||o.scrollIntoView({behavior:"smooth"})},g=async()=>{if(!x.trim()||!a)return;const o=x.trim();m("");try{let f=b;if(!f){const u=we(ue,"supportTickets"),C={clientId:a.id,clientName:a.name||"User",clientEmail:a.email||"",status:"open",createdAt:$e(),lastMessageAt:$e(),unreadByClient:0,unreadByAdmin:1,source:"App - Client",userRole:"client"};f=(await is(u,C)).id,k(f),await is(we(ue,"supportTickets",f,"messages"),{senderId:"system",senderName:"Technical Support",senderRole:"admin",message:"ðŸ‘‹ Hello! How can we help you today?",timestamp:$e(),read:!0})}await is(we(ue,"supportTickets",f,"messages"),{senderId:a.id,senderName:a.name||"User",senderRole:"client",message:o,timestamp:$e(),read:!1}),await rs(ns(ue,"supportTickets",f),{lastMessageAt:$e(),unreadByAdmin:1,status:"open"})}catch(f){console.error("Error sending message:",f)}};return M?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-dark p-6 rounded-xl",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-white mt-4",children:"Loading support chat..."})]})}):e.jsx("div",{className:"fixed inset-0 z-50 flex flex-col bg-background-dark md:bg-black/50 md:items-center md:justify-center",children:e.jsxs("div",{className:"flex-1 w-full h-full md:w-full md:max-w-2xl md:h-[600px] flex flex-col bg-background-dark md:bg-surface-dark md:rounded-2xl md:shadow-2xl md:border md:border-white/10 relative",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary to-purple-600 p-4 md:rounded-t-2xl flex justify-between items-center shrink-0 shadow-md z-10 safe-area-top",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-white",children:"support_agent"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-white",children:"Support"}),e.jsx("p",{className:"text-xs text-white/80",children:"Online 24/7"})]})]}),e.jsx("button",{onClick:o=>{o.stopPropagation(),n()},className:"w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 active:bg-white/30 rounded-full transition-colors touch-manipulation","aria-label":"Close chat",children:e.jsx("span",{className:"material-symbols-outlined text-white text-2xl font-bold",children:"close"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-background-dark scroll-smooth overscroll-contain",children:[d.map(o=>{var C;const f=o.senderRole==="client",u=o.senderId==="system";return e.jsx("div",{className:`flex ${f?"justify-end":"justify-start"} animate-fadeIn`,children:e.jsxs("div",{className:`max-w-[85%] px-4 py-3 rounded-2xl text-sm md:text-base shadow-sm ${u?"bg-slate-700/50 text-slate-300 border border-slate-600 text-center mx-auto":f?"bg-primary text-white rounded-br-sm":"bg-surface-dark text-white border border-white/10 rounded-bl-sm"}`,children:[!f&&!u&&e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"material-symbols-outlined text-xs text-primary",children:"support_agent"}),e.jsx("p",{className:"text-xs font-bold text-primary",children:o.senderName})]}),e.jsx("p",{className:"leading-relaxed whitespace-pre-wrap break-words",children:o.message}),e.jsx("p",{className:"text-[10px] mt-1 opacity-70 text-right",children:(C=o.timestamp)!=null&&C.toDate?new Date(o.timestamp.toDate()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"..."})]})},o.id)}),e.jsx("div",{ref:H})]}),e.jsx("div",{className:"p-3 md:p-4 bg-surface-dark border-t border-white/10 shrink-0 safe-area-bottom md:rounded-b-2xl shadow-[0_-5px_15px_rgba(0,0,0,0.3)] z-10",children:e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx("textarea",{value:x,onChange:o=>m(o.target.value),onKeyPress:o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),g())},placeholder:"Type a message...",rows:1,className:"flex-1 bg-background-dark text-white px-4 py-3 rounded-2xl border border-white/10 focus:border-primary focus:outline-none placeholder-slate-500 resize-none min-h-[44px] max-h-[120px] text-base",style:{paddingBottom:"10px"}}),e.jsx("button",{onClick:g,disabled:!x.trim(),className:"bg-primary hover:bg-primary-dark disabled:bg-slate-700 disabled:cursor-not-allowed text-white w-11 h-11 rounded-full flex items-center justify-center shrink-0 transition-all shadow-lg active:scale-95",children:e.jsx("span",{className:"material-symbols-outlined text-xl",children:"send"})})]})})]})})},ia=({vehicles:a,tempSelectedVehicles:n,setTempSelectedVehicles:d,setVehicleConfigs:s,setSelectedVehicleIds:x,setCurrentVehicleIndex:m,navigate:b,setShowAddVehicleModal:k,showToast:M,onEdit:R})=>{const H=g=>{n.includes(g)?d(n.filter(o=>o!==g)):d([...n,g])},U=()=>{if(n.length===0){M("Please select at least one vehicle","error");return}const g=n.map(o=>{const f=a.find(u=>u.id===o);return{vehicleId:o,vehicleModel:(f==null?void 0:f.model)||"",vehicleType:(f==null?void 0:f.type)||"sedan",packageId:"",addonIds:[]}});s(g),x(n),m(0),b(p.CLIENT_SERVICE_SELECT)};return e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white",children:[e.jsxs("header",{className:"flex items-center px-4 py-4 border-b border-white/5",children:[e.jsx("button",{onClick:()=>b(p.CLIENT_HOME),children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back_ios_new"})}),e.jsx("h1",{className:"flex-1 text-center font-bold text-lg mr-6",children:"Select Vehicles"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-32",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-6",children:"Choose one or more vehicles to wash"}),a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("span",{className:"material-symbols-outlined text-6xl text-slate-600 mb-4",children:"directions_car"}),e.jsx("p",{className:"text-slate-400 mb-6",children:"No vehicles saved yet"}),e.jsx("button",{onClick:()=>k(!0),className:"px-6 py-3 bg-primary rounded-xl font-bold hover:bg-primary-dark transition-colors",children:"Add Your First Vehicle"})]}):e.jsxs("div",{className:"space-y-3",children:[a.map(g=>{const o=n.includes(g.id);return e.jsxs("div",{className:"relative group",children:[e.jsx("button",{onClick:()=>H(g.id),className:`w-full p-4 rounded-xl border-2 transition-all text-left pr-14 ${o?"border-primary bg-primary/10":"border-white/10 bg-surface-dark hover:border-white/20"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${o?"border-primary bg-primary":"border-slate-500"}`,children:o&&e.jsx("span",{className:"material-symbols-outlined text-sm",children:"check"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-lg",children:g.model}),e.jsxs("p",{className:"text-sm text-slate-400",children:[g.color," â€¢ ",g.plate]})]}),g.image?e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden border border-white/10",children:e.jsx("img",{src:g.image,alt:g.model,className:"w-full h-full object-cover"})}):e.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"directions_car"})]})}),R&&e.jsx("button",{onClick:f=>{f.stopPropagation(),R(g)},className:"absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 text-slate-400 hover:text-white transition-colors z-10",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})})]},g.id)}),e.jsxs("button",{onClick:()=>k(!0),className:"w-full p-4 rounded-xl border-2 border-dashed border-white/20 hover:border-primary/50 transition-colors flex items-center justify-center gap-2 text-slate-400 hover:text-primary",children:[e.jsx("span",{className:"material-symbols-outlined",children:"add"}),"Add Another Vehicle"]})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-[calc(1rem+env(safe-area-inset-bottom))] bg-gradient-to-t from-background-dark via-background-dark to-transparent z-10",children:e.jsxs("button",{onClick:U,disabled:n.length===0,style:{backgroundColor:"#3b82f6"},className:"w-full h-14 rounded-xl font-bold text-lg hover:brightness-90 transition-all text-white disabled:opacity-50 disabled:cursor-not-allowed shadow-blue",children:["Continue (",n.length," vehicle",n.length!==1?"s":"",")"]})})]})},oa=({packages:a,packagesError:n,addons:d,vehicles:s,selectedVehicleIds:x,currentVehicleIndex:m,vehicleConfigs:b,setVehicleConfigs:k,setCurrentVehicleIndex:M,navigate:R,showToast:H})=>{var j;const U=x[m],g=s.find(N=>N.id===U),o=b[m],f=(g==null?void 0:g.type)||"sedan",u=m===x.length-1;console.log("ðŸ“¦ ServiceSelectionScreen DEBUG:",{packagesCount:a.length,packages:a,addonsCount:d.length,currentVehicleType:f,vehiclesCount:s.length});const C=N=>{const y=[...b];y[m]={...y[m],packageId:N},k(y)},E=N=>{const y=[...b],W=y[m].addonIds||[];W.includes(N)?y[m].addonIds=W.filter(h=>h!==N):y[m].addonIds=[...W,N],k(y)},S=()=>{if(console.log("ðŸŽ¯ ServiceSelectionScreen handleNext called"),console.log("   currentConfig:",o),console.log("   isLastVehicle:",u),!(o!=null&&o.packageId)){console.log("âŒ No package selected"),H("Please select a package","error");return}console.log("âœ… Package selected, navigating..."),u?(console.log("ðŸ“… Navigating to CLIENT_DATE_TIME"),R(p.CLIENT_DATE_TIME)):(console.log("âž¡ï¸ Moving to next vehicle"),M(m+1))},P=()=>{m>0?M(m-1):R(p.CLIENT_VEHICLE)},D=!!(o!=null&&o.packageId);return e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white",children:[e.jsxs("header",{className:"flex items-center px-4 py-4 border-b border-white/5",children:[e.jsx("button",{onClick:P,children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back_ios_new"})}),e.jsx("h1",{className:"flex-1 text-center font-bold text-lg mr-6",children:"Select Services"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-32",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:["Vehicle ",m+1," of ",x.length]}),e.jsx("p",{className:"text-sm font-bold",children:g==null?void 0:g.model})]}),e.jsx("div",{className:"w-full h-1 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${(m+1)/x.length*100}%`}})})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("h2",{className:"text-sm text-slate-400 uppercase font-bold",children:"Select Package (Required)"}),n||a.length===0?e.jsxs("div",{className:"p-6 rounded-xl bg-red-500/10 border-2 border-red-500/30 text-center",children:[e.jsx("span",{className:"material-symbols-outlined text-5xl text-red-400 mb-3",children:"error"}),e.jsx("h3",{className:"font-bold text-lg text-red-400 mb-2",children:"No Packages Available"}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:n||"There are no service packages configured. Please contact support."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-red-500 text-white rounded-xl font-bold hover:brightness-110",children:"Retry Connection"}),e.jsxs("div",{className:"mt-4 p-2 bg-gray-900 rounded text-xs text-left overflow-hidden",children:[e.jsx("p",{className:"text-gray-400 font-bold",children:"Debug Info:"}),e.jsx("pre",{className:"whitespace-pre-wrap text-gray-500",children:JSON.stringify({pkgCount:a.length,hasError:!!n,errorMsg:n,loading:a.length===0&&!n?"Possibly":"No"},null,2)})]})]}):a.map(N=>{var h;const y=(o==null?void 0:o.packageId)===N.id,W=((h=N.price)==null?void 0:h[f])||0;return e.jsxs("button",{onClick:()=>C(N.id),className:`w-full p-4 rounded-xl border-2 transition-all text-left ${y?"border-primary bg-primary/10":"border-white/10 bg-surface-dark hover:border-white/20"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${y?"border-primary bg-primary":"border-slate-500"}`,children:y&&e.jsx("span",{className:"material-symbols-outlined text-sm",children:"check"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:N.name}),e.jsx("p",{className:"text-sm text-slate-400",children:N.description})]})]}),e.jsxs("p",{className:"text-xl font-bold text-primary",children:["$",W]})]}),N.features&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2 ml-8",children:N.features.map((I,G)=>e.jsx("span",{className:"text-xs bg-white/5 px-2 py-1 rounded-full",children:I},G))})]},N.id)})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-sm text-slate-400 uppercase font-bold",children:"Add-ons (Optional)"}),d.length===0?e.jsx("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10 text-center",children:e.jsx("p",{className:"text-slate-400 text-sm",children:"No add-ons available at this time"})}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Note: Add-ons require a package selection"}),d.map(N=>{var I;const y=(I=o==null?void 0:o.addonIds)==null?void 0:I.includes(N.id),W=N.price[f],h=!(o!=null&&o.packageId);return e.jsx("button",{onClick:()=>!h&&E(N.id),disabled:h,className:`w-full p-4 rounded-xl border-2 transition-all text-left ${h?"border-white/5 bg-white/5 opacity-50 cursor-not-allowed":y?"border-primary bg-primary/10":"border-white/10 bg-surface-dark hover:border-white/20"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center ${y?"border-primary bg-primary":"border-slate-500"}`,children:y&&e.jsx("span",{className:"material-symbols-outlined text-sm",children:"check"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:N.name}),e.jsx("p",{className:"text-sm text-slate-400",children:N.description})]})]}),e.jsxs("p",{className:"font-bold text-primary",children:["+$",W]})]})},N.id)})]})]})]}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-[calc(1rem+env(safe-area-inset-bottom))] bg-gradient-to-t from-background-dark via-background-dark to-transparent z-10",children:[e.jsx("button",{onClick:S,disabled:!D,style:D?{backgroundColor:"#3b82f6"}:{},className:`w-full h-14 rounded-xl font-bold text-lg transition-all ${D?"hover:brightness-90 text-white shadow-blue":"bg-slate-700 text-slate-500 cursor-not-allowed"}`,children:u?"Continue to Date & Time":`Next: ${((j=s.find(N=>N.id===x[m+1]))==null?void 0:j.model)||"Next Vehicle"}`}),e.jsx("div",{className:"h-[env(safe-area-inset-bottom)]"})]})]})},da=({selectedOption:a,setSelectedOption:n,selectedDate:d,setSelectedDate:s,selectedTime:x,setSelectedTime:m,orders:b,team:k,navigate:M,showToast:R})=>{const H=()=>{const u=[],C=new Date;for(let E=0;E<14;E++){const S=new Date(C);S.setDate(C.getDate()+E);const P=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],D=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],j=S.getFullYear(),N=(S.getMonth()+1).toString().padStart(2,"0"),y=S.getDate().toString().padStart(2,"0"),W=`${j}-${N}-${y}`;u.push({date:W,dayName:P[S.getDay()],dayNumber:S.getDate(),month:D[S.getMonth()],isToday:E===0})}return u},U=()=>{const u=[],C=new Date,E=C.getHours(),S=C.getMinutes(),[P,D,j]=d.split("-").map(Number);new Date(P,D-1,j).getDay();const y=[{start:"07:00",end:"17:00"}],W=r=>y.some(A=>r>=A.start&&r<=A.end);let h=7;const I=C.getFullYear(),G=(C.getMonth()+1).toString().padStart(2,"0"),K=C.getDate().toString().padStart(2,"0"),J=`${I}-${G}-${K}`;d===J&&(h=E+1,S>30&&(h+=1));for(let r=h;r<=17;r++){const A=`${r.toString().padStart(2,"0")}:00`,v=`${r.toString().padStart(2,"0")}:30`;r<=17&&W(A)&&u.push(A),r<17&&W(v)&&u.push(v)}return u},g=H(),o=U(),f=()=>{if(a==="scheduled"){if(!d){R("Please select a date","error");return}if(!x){R("Please select a time","error");return}}M(p.CLIENT_ADDRESS)};return e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white",children:[e.jsxs("header",{className:"flex items-center px-4 py-4 border-b border-white/5",children:[e.jsx("button",{onClick:()=>M(p.CLIENT_SERVICE_SELECT),children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back_ios_new"})}),e.jsx("h1",{className:"flex-1 text-center font-bold text-lg mr-6",children:"Date & Time"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-32",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-6",children:"When would you like your wash?"}),e.jsxs("div",{className:"space-y-4 animate-fadeIn",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-3",children:"Select Date"}),e.jsx("div",{className:"flex overflow-x-auto gap-3 pb-2 scrollbar-hide -mx-2 px-2 snap-x",children:g.map(u=>e.jsxs("button",{onClick:()=>{s(u.date),m("")},className:`min-w-[70px] p-3 rounded-xl border-2 transition-all flex flex-col items-center snap-start ${d===u.date?"border-primary bg-primary/20 shadow-blue":"border-white/10 bg-surface-dark hover:border-white/20"}`,children:[e.jsx("span",{className:"text-xs text-slate-400 mb-1 pointer-events-none",children:u.dayName}),e.jsx("span",{className:"text-xl font-bold pointer-events-none",children:u.dayNumber}),e.jsx("span",{className:"text-[10px] text-slate-500 uppercase pointer-events-none",children:u.month}),u.isToday&&e.jsx("span",{className:"text-[10px] text-primary font-bold mt-1",children:"TODAY"})]},u.date))})]}),d&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Select Time"}),o.length>0?e.jsx("div",{className:"max-h-[300px] overflow-y-auto pb-4 -mr-2 pr-2",children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:o.map(u=>e.jsx("button",{onClick:()=>m(u),className:`p-3 rounded-lg border-2 transition-all text-sm ${x===u?"border-primary bg-primary/10 text-primary font-bold":"border-white/10 bg-surface-dark hover:border-white/20"}`,children:u},u))})}):e.jsx("div",{className:"p-4 rounded-xl bg-amber-500/10 border border-amber-500/30 text-center",children:e.jsx("p",{className:"text-sm text-amber-400",children:"No time slots available for this date. Please select another date."})})]})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-[calc(1rem+env(safe-area-inset-bottom))] bg-gradient-to-t from-background-dark via-background-dark to-transparent z-10",children:e.jsx("button",{onClick:f,style:{backgroundColor:"#1e40af"},className:"w-full h-14 rounded-xl font-bold text-lg hover:brightness-90 transition-all text-white shadow-blue",children:"Continue to Address"})})]})},ca=({selectedAddress:a,setSelectedAddress:n,selectedLocation:d,setSelectedLocation:s,navigate:x,showToast:m,savedAddresses:b=[],userAddress:k,onSaveAddress:M,onDeleteAddress:R,serviceArea:H})=>{const[U,g]=i.useState(!1),[o,f]=i.useState({street:"",city:"",zip:"",apt:"",label:""}),[u,C]=i.useState(!1),E=j=>{if(C(!0),!window.google||!window.google.maps){C(!1),n(j),s({lat:0,lng:0}),m("Maps not loaded. Address selected blindly.","warning");return}new google.maps.Geocoder().geocode({address:j},(y,W)=>{if(C(!1),W==="OK"&&y&&y[0]&&y[0].geometry.location){const h=y[0].geometry.location;n(j),s({lat:h.lat(),lng:h.lng()}),m("Address validated successfully","success")}else n(j),m("Could not verify exact location level. Using address as provided.","warning"),s({lat:0,lng:0})})},S=async()=>{if(!o.street||!o.city||!o.zip){m("Please fill in Street, City and Zip Code.","error");return}const j=`${o.street}${o.apt?", Apt "+o.apt:""}, ${o.city}, ${o.zip}`;if(C(!0),!window.google||!window.google.maps){m("Maps service unavailable.","error"),C(!1);return}new google.maps.Geocoder().geocode({address:j},async(y,W)=>{if(C(!1),W==="OK"&&y&&y[0]&&y[0].geometry.location){const h=y[0].geometry.location;if(!$t(h.lat(),h.lng(),H)){m("Sorry, this address is outside our service area (Los Angeles).","error");return}M?await M({label:o.label||"Saved Address",address:j})&&(n(y[0].formatted_address||j),s({lat:h.lat(),lng:h.lng()}),g(!1),f({street:"",city:"",zip:"",apt:"",label:""})):(n(j),s({lat:h.lat(),lng:h.lng()}),g(!1))}else m("Could not find location. Please check the address details.","error")})},P=()=>{if(!a||!d){m("Please select or enter a valid address","error");return}x(p.CLIENT_PAYMENT_METHODS)},D=async(j,N)=>{j.stopPropagation(),R&&await R(N)};return e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white",children:[e.jsxs("header",{className:"flex items-center px-4 py-4 border-b border-white/5",children:[e.jsx("button",{onClick:()=>x(p.CLIENT_DATE_TIME),children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back_ios_new"})}),e.jsx("h1",{className:"flex-1 text-center font-bold text-lg mr-6",children:"Service Address"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-32",children:U?e.jsxs("div",{className:"animate-in slide-in-from-right-10 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"font-bold text-lg",children:"Add New Address"}),e.jsx("button",{onClick:()=>g(!1),className:"text-slate-400 hover:text-white",children:"Cancel"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Label (e.g. Home, Office)"}),e.jsx("input",{type:"text",value:o.label,onChange:j=>f({...o,label:j.target.value}),className:"w-full p-3 rounded-xl bg-white/5 border border-white/10 focus:border-primary outline-none text-white",placeholder:"My Address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Street Address"}),e.jsx("input",{type:"text",value:o.street,onChange:j=>f({...o,street:j.target.value}),className:"w-full p-3 rounded-xl bg-white/5 border border-white/10 focus:border-primary outline-none text-white",placeholder:"123 Main St"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Apt / Suite (Optional)"}),e.jsx("input",{type:"text",value:o.apt,onChange:j=>f({...o,apt:j.target.value}),className:"w-full p-3 rounded-xl bg-white/5 border border-white/10 focus:border-primary outline-none text-white",placeholder:"Apt 4B"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"City"}),e.jsx("input",{type:"text",value:o.city,onChange:j=>f({...o,city:j.target.value}),className:"w-full p-3 rounded-xl bg-white/5 border border-white/10 focus:border-primary outline-none text-white",placeholder:"Houston"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Zip Code"}),e.jsx("input",{type:"text",value:o.zip,onChange:j=>f({...o,zip:j.target.value}),className:"w-full p-3 rounded-xl bg-white/5 border border-white/10 focus:border-primary outline-none text-white",placeholder:"77002"})]})]}),e.jsx("button",{onClick:S,disabled:u,className:"w-full py-4 bg-primary text-white font-bold rounded-xl hover:brightness-110 active:scale-95 transition-all mt-4 flex items-center justify-center gap-2 shadow-blue",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-black border-t-transparent rounded-full animate-spin"}),"Validating..."]}):"Save & Use Address"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-slate-400 text-sm mb-6",children:"Where should we wash your vehicle(s)?"}),e.jsxs("div",{className:"space-y-4",children:[b.length>0?b.map((j,N)=>e.jsxs("div",{className:`relative rounded-xl border-2 transition-all ${a===j.address?"bg-[#3b82f6]/10 border-[#3b82f6] shadow-blue":"bg-surface-dark border-white/10 hover:border-white/30"}`,children:[e.jsxs("button",{onClick:()=>E(j.address),disabled:u,className:"w-full p-4 text-left flex items-center gap-3",children:[e.jsx("span",{className:`material-symbols-outlined ${a===j.address?"text-[#3b82f6]":"text-slate-400"}`,children:j.icon||"location_on"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-bold text-sm ${a===j.address?"text-[#3b82f6]":"text-white"}`,children:j.label}),e.jsx("p",{className:"text-xs text-slate-400",children:j.address})]}),a===j.address&&e.jsx("span",{className:"material-symbols-outlined text-[#3b82f6]",children:"check_circle"})]}),e.jsx("button",{onClick:y=>D(y,j.id),className:"absolute top-2 right-2 p-2 text-slate-600 hover:text-red-500 transition-colors z-10",title:"Remove Address",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]},j.id||N)):e.jsx("p",{className:"text-sm text-slate-500 italic text-center py-4",children:"No saved addresses found."}),e.jsxs("button",{onClick:()=>g(!0),className:"w-full p-4 rounded-xl border-2 border-dashed border-white/20 hover:border-primary/50 transition-colors flex items-center justify-center gap-2 text-slate-400 hover:text-primary mt-4",children:[e.jsx("span",{className:"material-symbols-outlined",children:"add"}),"Add New Address"]})]})]})}),!U&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-[calc(1rem+env(safe-area-inset-bottom))] bg-gradient-to-t from-background-dark via-background-dark to-transparent z-10",children:e.jsx("button",{onClick:P,disabled:!a||!d||u,style:a&&d?{backgroundColor:"#3b82f6"}:{},className:`w-full h-14 rounded-xl font-bold text-lg transition-all ${a&&d?"hover:brightness-90 text-white shadow-blue":"bg-slate-700 text-slate-500 cursor-not-allowed"}`,children:u?"Validating Address...":"Continuar al Resumen"})})]})},ma=({packages:a,addons:n,vehicles:d,vehicleConfigs:s,selectedDate:x,selectedTime:m,selectedAddress:b,navigate:k,onConfirmOrder:M,globalFees:R,discounts:H,showFeesToClient:U=!1,selectedCard:g=null,onAddCard:o=()=>{},userId:f})=>{const[u,C]=i.useState(""),[E,S]=i.useState(null),[P,D]=i.useState(""),[j,N]=i.useState(!1),y=()=>{let r=0;return s.forEach(A=>{var V;const v=d.find(L=>L.id===A.vehicleId),B=(v==null?void 0:v.type)||"sedan",T=a.find(L=>L.id===A.packageId);T&&(r+=T.price[B]||0),(V=A.addonIds)==null||V.forEach(L=>{const O=n.find(je=>je.id===L);O&&(r+=O.price[B]||0)})}),r},W=()=>{if(!u.trim()){D("Please enter a discount code");return}console.log("ðŸ” Checking discount:",u,"Available:",H);const r=H.find(v=>v.code.toLowerCase()===u.toLowerCase()&&v.active);if(!r){D("Invalid or expired discount code"),S(null);return}if(r.clientId&&r.clientId!==f){D("This code is exclusive to another user"),S(null);return}if(r.usageLimit&&r.usageCount>=r.usageLimit){D("This code has reached its usage limit"),S(null);return}const A=new Date;if(r.validFrom&&new Date(r.validFrom)>A){D("This code is not valid yet"),S(null);return}if(r.validUntil){const v=new Date(r.validUntil);if(v.setHours(23,59,59,999),v<A){D("This code has expired"),S(null);return}}console.log("âœ… Discount applied:",r),D(""),S(r)},h=y(),I=h;let G=0;E&&(E.type==="percentage"?G=I*E.value/100:G=E.value,E.minimumOrderAmount&&I<E.minimumOrderAmount&&(G=0));const K=I-G;R.reduce((r,A)=>r+K*A.percentage/100,0);const J=K;return e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white",children:[e.jsxs("header",{className:"flex items-center px-4 py-4 border-b border-white/5",children:[e.jsx("button",{onClick:()=>k(p.CLIENT_ADDRESS),children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back_ios_new"})}),e.jsx("h1",{className:"flex-1 text-center font-bold text-lg mr-6",children:"Confirm Order"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-32",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-6",children:"Review your order details"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-sm text-slate-400 uppercase font-bold",children:"Vehicles & Services"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>k(p.CLIENT_VEHICLE),className:"text-primary text-sm font-bold flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"add"}),"Add"]}),e.jsxs("button",{onClick:()=>k(p.CLIENT_VEHICLE),className:"text-primary text-sm font-bold flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"edit"}),"Edit"]})]})]}),s.map((r,A)=>{const v=d.find(V=>V.id===r.vehicleId),B=(v==null?void 0:v.type)||"sedan",T=a.find(V=>V.id===r.packageId);return e.jsxs("div",{className:"bg-surface-dark rounded-xl border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/5",children:[e.jsx("div",{className:"w-20 h-20 rounded-lg bg-gradient-to-br from-primary/20 to-purple-500/20 flex items-center justify-center overflow-hidden",children:v!=null&&v.image?e.jsx("img",{src:v.image,alt:v.model,className:"w-full h-full object-cover"}):e.jsx("span",{className:"material-symbols-outlined text-4xl text-primary",children:"directions_car"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg",children:v==null?void 0:v.model}),e.jsx("p",{className:"text-sm text-slate-400",children:v==null?void 0:v.color}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:B})]})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Package"}),e.jsx("p",{className:"font-bold",children:T==null?void 0:T.name}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:T==null?void 0:T.description})]}),e.jsxs("p",{className:"font-bold text-primary",children:["$",T==null?void 0:T.price[B]]})]}),r.addonIds&&r.addonIds.length>0&&e.jsxs("div",{className:"border-t border-white/5 pt-3",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Extras"}),r.addonIds.map(V=>{const L=n.find(O=>O.id===V);return e.jsxs("div",{className:"flex justify-between text-sm text-slate-300 mb-1",children:[e.jsxs("span",{children:["+ ",L==null?void 0:L.name]}),e.jsxs("span",{children:["$",L==null?void 0:L.price[B]]})]},V)})]})]})]},r.vehicleId)})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("h2",{className:"text-sm text-slate-400 uppercase font-bold",children:"Schedule"}),e.jsx("div",{className:"p-4 rounded-xl bg-surface-dark border border-white/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-primary",children:"schedule"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:x}),e.jsx("p",{className:"text-sm text-slate-400",children:m})]})]})})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("h2",{className:"text-sm text-slate-400 uppercase font-bold",children:"Location"}),e.jsx("div",{className:"p-4 rounded-xl bg-surface-dark border border-white/10",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-primary",children:"location_on"}),e.jsx("p",{className:"text-sm flex-1",children:b})]})})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("h2",{className:"text-xs text-slate-400 uppercase font-bold",children:"Discount Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:u,onChange:r=>C(r.target.value.toUpperCase()),placeholder:"Enter code",className:"flex-1 px-3 py-2 rounded-xl bg-surface-dark border border-white/10 text-white text-sm placeholder-slate-500 focus:outline-none focus:border-primary"}),e.jsx("button",{onClick:W,style:{backgroundColor:"#3b82f6"},className:"px-4 py-2 rounded-xl text-white text-sm font-bold hover:brightness-110 transition-all shadow-blue whitespace-nowrap",children:"Apply"})]}),P&&e.jsx("p",{className:"text-red-400 text-sm",children:P}),E&&e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"check_circle"}),e.jsxs("span",{children:['Discount "',E.code,'" applied!']})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-sm text-slate-400 uppercase font-bold",children:"Payment Method"}),g&&e.jsx("button",{onClick:o,className:"text-primary text-sm font-bold flex items-center gap-1",children:"Change"})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{onClick:o,className:"p-4 rounded-xl bg-surface-dark border border-white/10 flex items-center justify-between cursor-pointer hover:bg-white/5 transition-all",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-primary mt-0.5",children:"credit_card"}),e.jsx("div",{className:"flex-1",children:g?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-bold",children:[g.brand," â€¢â€¢â€¢â€¢ ",g.last4]}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Expires ",g.expiry]})]}):e.jsx("p",{className:"text-sm font-medium text-slate-400",children:"Select Payment Method"})})]}),e.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"arrow_forward_ios"})]})})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-primary/5 border border-primary/20 mb-6",children:[e.jsx("p",{className:"text-xs font-bold text-primary uppercase tracking-wider mb-3",children:"Billing Details"}),s.map((r,A)=>{const v=d.find(L=>L.id===r.vehicleId),B=(v==null?void 0:v.type)||"sedan",T=a.find(L=>L.id===r.packageId),V=(T==null?void 0:T.price[B])||0;return e.jsxs("div",{className:"mb-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("span",{className:"text-slate-300",children:[v==null?void 0:v.model," - ",T==null?void 0:T.name]}),e.jsxs("span",{className:"font-bold",children:["$",V.toFixed(2)]})]}),r.addonIds&&r.addonIds.length>0&&e.jsx("div",{className:"ml-2 space-y-1",children:r.addonIds.map(L=>{const O=n.find(ke=>ke.id===L),je=(O==null?void 0:O.price[B])||0;return e.jsxs("div",{className:"flex justify-between text-xs text-slate-400",children:[e.jsxs("span",{children:["+ ",O==null?void 0:O.name]}),e.jsxs("span",{children:["$",je.toFixed(2)]})]},L)})})]},r.vehicleId)}),e.jsxs("div",{className:"border-t border-white/10 pt-3 mt-3 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400",children:"Subtotal"}),e.jsxs("span",{className:"font-bold text-white",children:["$",h.toFixed(2)]})]}),E&&G>0&&e.jsxs("div",{className:"flex justify-between items-center text-green-400",children:[e.jsxs("span",{children:["Discount (",E.type==="percentage"?`${E.value}%`:`$${E.value}`,")"]}),e.jsxs("span",{className:"font-bold",children:["-$",G.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-background-dark border-t border-white/10 p-4 pb-[calc(1rem+env(safe-area-inset-bottom))] z-20 shadow-[0_-5px_20px_rgba(0,0,0,0.5)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 uppercase font-bold",children:"Total to Pay"}),e.jsxs("p",{className:"text-3xl font-black text-white",children:["$",J.toFixed(2)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs text-slate-400",children:[s.length," Vehicle",s.length!==1?"s":""]}),e.jsx("p",{className:"text-xs text-primary font-bold",children:"Scheduled"})]})]}),!g&&e.jsx("p",{className:"text-red-400 text-xs text-center mb-2 font-bold animate-pulse",children:"âš ï¸ Please select a payment method to continue"}),e.jsx("button",{disabled:!g,onClick:()=>M(J,E==null?void 0:E.id,g==null?void 0:g.id),style:{backgroundColor:g?"#3b82f6":"#1e293b"},className:`w-full h-14 rounded-xl font-bold text-lg text-white shadow-blue active:scale-[0.98] transition-all ${g?"hover:brightness-110":"opacity-50 grayscale cursor-not-allowed"}`,children:g?"Confirm & Place Order":"Select Payment Method"})]})]})},xa=({savedCards:a=[],selectedCardId:n,onSelectCard:d,onAddCard:s,navigate:x})=>e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white",children:[e.jsxs("header",{className:"flex items-center px-4 py-4 border-b border-white/5",children:[e.jsx("button",{onClick:()=>x(p.CLIENT_ADDRESS),children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back_ios_new"})}),e.jsx("h1",{className:"flex-1 text-center font-bold text-lg mr-6",children:"Payment Methods"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-32",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-6",children:"Select or add a payment method"}),e.jsxs("div",{className:"space-y-3",children:[a.map(m=>e.jsxs("button",{onClick:()=>{d(m.id)},className:`w-full p-4 rounded-xl border-2 transition-all flex items-center justify-between ${n===m.id?"bg-primary/10 border-primary shadow-[0_0_15px_rgba(0,212,255,0.3)]":"bg-surface-dark border-white/10 hover:bg-white/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-8 bg-white/10 rounded flex items-center justify-center text-[10px] font-bold uppercase tracking-wider",children:m.brand}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-bold",children:["â€¢â€¢â€¢â€¢ ",m.last4]}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Expires ",m.expiry]})]})]}),n===m.id&&e.jsx("span",{className:"material-symbols-outlined text-primary",children:"check_circle"})]},m.id)),e.jsxs("button",{onClick:s,className:"w-full p-4 rounded-xl border border-dashed border-white/20 bg-surface-dark/50 text-slate-400 flex items-center justify-center gap-2 hover:bg-white/5 transition-all mt-4",children:[e.jsx("span",{className:"material-symbols-outlined",children:"add_card"}),e.jsx("span",{className:"font-medium",children:"Add New Card"})]})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-[calc(1rem+env(safe-area-inset-bottom))] bg-gradient-to-t from-background-dark via-background-dark to-transparent z-10",children:e.jsx("button",{onClick:()=>{n&&x(p.CLIENT_CONFIRM)},disabled:!n,style:n?{backgroundColor:"#3b82f6"}:{},className:`w-full h-14 rounded-xl font-bold text-lg transition-all ${n?"hover:brightness-90 text-white shadow-blue":"bg-slate-700 text-slate-500 cursor-not-allowed"}`,children:"Continue to Summary"})})]}),ua=({screen:a,navigate:n,orders:d,user:s,packages:x,packagesError:m,addons:b,team:k,vehicleTypes:M,createOrder:R,updateOrder:H,cancelOrder:U,newOrderDraft:g,setNewOrderDraft:o,notifications:f,addNotification:u,messages:C,sendMessage:E,createIssue:S,updateProfile:P,logout:D,submitOrderRating:j,serviceArea:N,globalFees:y,discounts:W,targetOrderId:h})=>{var Ls,Ps,Ds,Vs;const[I,G]=i.useState(null);i.useEffect(()=>{if(h){const t=d.find(l=>l.id===h);t&&(console.log("ðŸ”— Client Deep Link: Viewing order",h),G(t))}},[h,d]),i.useEffect(()=>{if(I){const t=d.find(l=>l.id===I.id);if(!t){G(null);return}t.status==="Cancelled"&&I.status!=="Cancelled"&&os("Your order has been cancelled."),JSON.stringify(t)!==JSON.stringify(I)&&G(t)}},[d,I]);const[K,J]=i.useState("services");console.log("ðŸŽ¬ ClientScreens RENDERED - user.savedCards:",s.savedCards),i.useEffect(()=>{var t,l;console.log("ðŸ‘¤ USER DATA:",{id:s.id,name:s.name,email:s.email,savedCards:s.savedCards,savedVehicles:(t=s.savedVehicles)==null?void 0:t.length,savedAddresses:(l=s.savedAddresses)==null?void 0:l.length})},[s]);const{showToast:r}=Lt(),[A,v]=i.useState([]),[B,T]=i.useState("scheduled"),[V,L]=i.useState(""),[O,je]=i.useState(""),[ke,Qs]=i.useState(""),[qe,Ks]=i.useState(null);console.log("ðŸš— DEBUG savedVehicles:",{type:typeof s.savedVehicles,isArray:Array.isArray(s.savedVehicles),value:s.savedVehicles,length:(Ls=s.savedVehicles)==null?void 0:Ls.length});const ie=Array.isArray(s.savedVehicles)?s.savedVehicles:[],[Js,Zs]=i.useState([]);d.find(t=>t.status==="Completed"&&!t.clientRating&&!Js.includes(t.id));const[oe,et]=i.useState(null);i.useEffect(()=>{(async()=>{try{const l=await Ne(()=>import("./WeatherService-BuUgFwzk-1769119750716.js"),[]).then(c=>c.WeatherService.getCurrentWeather(0,0));et(l)}catch(l){console.error("Failed to load weather",l)}})()},[]);const[st,xs]=i.useState(null),Ee=d.find(t=>t.id===st),[le,Ie]=i.useState(null),[ze,Qe]=i.useState(null),[tt,at]=i.useState(!1),[Ke,us]=i.useState(!1),[Je,hs]=i.useState(!1),[ha,pa]=i.useState(""),[lt,ps]=i.useState(!1),[ba,Ze]=i.useState(!1),[fa,rt]=i.useState(!1),[be,bs]=i.useState(0),[He,fs]=i.useState(""),[_e,gs]=i.useState(0),[ga,nt]=i.useState(!1),[ja,it]=i.useState(""),[ot,he]=i.useState(!1),[de,Ae]=i.useState(null),[js,ys]=i.useState(null),[dt,ws]=i.useState([]),[Te,es]=i.useState([]);i.useEffect(()=>{if(Te.length>0){const t=new Set(d.map(c=>c.id)),l=Te.filter(c=>!t.has(c.id));l.length!==Te.length&&es(l)}},[d,Te]),i.useEffect(()=>{if(C.length===0)return;const t=C[C.length-1];if(t.receiverId===s.id&&!t.read&&d.some(c=>c.id===t.orderId&&["Assigned","En Route","Arrived","In Progress"].includes(c.status))&&(console.log("ðŸ“¨ New message received for active order"),!Je)){const c=`New message: ${t.content.substring(0,30)}${t.content.length>30?"...":""}`;os(c)||r(c,"info"),hs(!0),Be()}},[C,d,s.id,Je]);const Ns=t=>{Ae(t),he(!0)},ct=async(t,l)=>{try{console.log("ðŸš— Starting vehicle save process...");const c=String(t.make||""),w=String(t.model||""),_=String(t.year||""),z=String(t.color||""),X=String(t.plate||""),F=String(t.type||"sedan");let $=null;if(l)if(l.startsWith("http"))console.log("ðŸ”— Keeping existing image URL:",l.substring(0,50)+"..."),$=l;else if(l.startsWith("data:image"))try{console.log("ðŸ“¸ NEW IMAGE DETECTED (base64). Starting upload...");const q=(de==null?void 0:de.id)||`v_${Date.now()}`,Z=`vehicles/${s.id}/${q}.jpg`;console.log("ðŸ“‚ Storage Path:",Z);const Q=$s(Fs,Z);console.log("âŒ› Uploading string...");const ee=await Gs(Q,l,"data_url");console.log("ðŸ“¤ Upload complete. Metadata:",ee.metadata.fullPath),$=await zs(Q),console.log("âœ… Download URL obtained:",$)}catch(q){console.error("âŒ Error during Firebase Storage operation:",q),r("Warning: Image upload failed, saving vehicle with old/no image","warning")}else console.warn("âš ï¸ Image format not recognized (not http and not data:image). Skipping upload.");else console.log("â„¹ï¸ No image provided to save process");let xe=[];if(de)console.log("ðŸ”„ Updating existing vehicle:",de.id),xe=(s.savedVehicles||[]).map(q=>q.id===de.id?{...q,make:c,model:w,year:_,color:z,plate:X,type:F,image:$||q.image}:q);else{const q=`v_${Date.now()}`,Z=!s.savedVehicles||s.savedVehicles.length===0,Q={id:q,make:c,model:w,year:_,color:z,plate:X,type:F,isDefault:Z,image:$};console.log("ðŸ“¦ New vehicle:",Q),xe=[...s.savedVehicles||[],Q]}console.log("ðŸ“¤ Sending to Firestore (without base64):",xe.map(q=>({...q,image:q.image?"URL":null}))),console.log("ðŸ”„ Calling updateProfile with savedVehicles...");const ls=await P({savedVehicles:xe});console.log("ðŸ“¥ updateProfile returned:",ls),console.log("âœ… SUCCESS!"),r(de?"Vehicle updated successfully!":"Vehicle added successfully!","success"),he(!1),Ae(null)}catch(c){console.error("âŒ FAILED:",c),r(`Error: ${c instanceof Error?c.message:"Unknown error"}`,"error")}},vs=async t=>{try{if(!window.confirm("Are you sure you want to remove this vehicle?"))return;const l=(s.savedVehicles||[]).filter(c=>c.id!==t);await P({savedVehicles:l}),r("Vehicle removed","success")}catch(l){console.error("Error deleting vehicle:",l),r(`Failed to delete vehicle: ${l instanceof Error?l.message:"Unknown error"}`,"error")}},[Cs,Me]=i.useState(!1),[Re,ce]=i.useState(!1),[fe,Le]=i.useState(null),mt=t=>{let l=t.vehicleConfigs;if(!l||l.length===0){const c=x.find(_=>_.name===t.service),w=ie.find(_=>_.model===t.vehicle)||ie[0];if(w&&c)l=[{vehicleId:w.id,vehicleModel:w.model,vehicleType:w.type,packageId:c.id,addonIds:[]}];else{r("Cannot reorder this item automatically. Please start a new booking.","warning"),n(p.CLIENT_VEHICLE);return}}try{Ue(l),_s(l.map(c=>c.vehicleId))}catch(c){console.warn("State setters error",c)}o({...g,vehicleConfigs:l,service:t.service,price:t.price}),n(p.CLIENT_SERVICE_SELECT)};f.filter(t=>!t.read&&t.userId===s.id).length;const re=d.find(t=>["Assigned","En Route","Arrived","In Progress"].includes(t.status));re&&C.filter(t=>t.orderId===re.id);const xt=f.filter(t=>!t.read&&t.userId===s.id&&t.title==="New Message").length,Ss=i.useRef({});i.useEffect(()=>{d.filter(l=>l.status!=="Completed"&&l.status!=="Cancelled").forEach(l=>{const c=Ss.current[l.id];c&&c!==l.status&&(l.status==="Assigned"?(r(`Washer assigned! ${l.washerName||"Your washer"} is on the way.`,"success"),u(s.id,"Washer Assigned",`${l.washerName||"A washer"} has accepted your request.`,"success",p.CLIENT_HOME)):l.status==="En Route"?(r("Washer is en route!","info"),u(s.id,"Washer En Route",`${l.washerName||"Washer"} is driving to your location.`,"info",p.CLIENT_HOME)):l.status==="Arrived"?(r("Washer has arrived!","success"),u(s.id,"Washer Arrived","Please meet the washer or unlock your car.","success",p.CLIENT_HOME)):l.status==="In Progress"&&(r("Cleaning started!","info"),u(s.id,"Cleaning Started","The washer has started working on your vehicle.","info",p.CLIENT_HOME))),Ss.current[l.id]=l.status})},[d,s.id,u,r]);const ut=()=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/80 flex items-start justify-center md:justify-end md:p-4",children:e.jsxs("div",{className:"bg-surface-dark w-full h-full md:w-96 md:h-auto md:max-h-[80vh] md:rounded-2xl border-0 md:border border-white/10 shadow-2xl overflow-hidden md:mt-16 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-white/5 flex justify-between items-center bg-black/20",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Notifications"}),e.jsx("button",{onClick:()=>at(!1),className:"p-1 hover:bg-white/10 rounded-full transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"close"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:f.filter(t=>t.userId===s.id).length===0?e.jsxs("div",{className:"p-8 text-center text-slate-500",children:[e.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 opacity-50",children:"notifications_off"}),e.jsx("p",{children:"No notifications yet"})]}):f.filter(t=>t.userId===s.id).map(t=>e.jsx("div",{className:`p-4 border-b border-white/5 hover:bg-white/5 transition-colors ${t.read?"":"bg-primary/5"}`,children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${t.type==="success"?"bg-green-500/20 text-green-500":t.type==="warning"?"bg-amber-500/20 text-amber-500":t.type==="error"?"bg-red-500/20 text-red-500":"bg-blue-500/20 text-blue-500"}`,children:e.jsx("span",{className:"material-symbols-outlined text-xl",children:t.type==="success"?"check_circle":t.type==="warning"?"warning":t.type==="error"?"error":"info"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-bold text-sm mb-1 ${t.read?"text-slate-300":"text-white"}`,children:t.title}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed mb-2",children:t.message}),e.jsx("p",{className:"text-[10px] text-slate-500",children:new Date(t.timestamp).toLocaleString()})]}),!t.read&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary mt-2"})]})},t.id))})]})}),[ya,wa]=i.useState(!0),[Na,ht]=i.useState(s.avatar||"https://images.unsplash.com/photo-1633332755192-727a05c4013d?auto=format&fit=crop&q=80");i.useRef(null);const[va,Ca]=i.useState("vehicles"),[ve,Pe]=i.useState([]);i.useEffect(()=>{var t;console.log("ðŸ“ Address Effect Triggered",{hasUser:!!s,savedAddresses:s.savedAddresses,length:(t=s.savedAddresses)==null?void 0:t.length}),s.savedAddresses&&s.savedAddresses.length>0?(console.log("ðŸ“ Setting addresses from PROFILE"),Pe(s.savedAddresses)):(console.log("ðŸ“ Setting addresses to DEFAULT"),Pe([{id:"a1",label:"Home",address:"123 Main St",icon:"home"}]))},[s.savedAddresses]);const[Sa,pt]=i.useState({make:"",model:"",year:"",color:"",plate:"",type:"Sedan"}),[ka,bt]=i.useState(null);i.useRef(null);const[Ea,ft]=i.useState(!1),[Ia,_a]=i.useState({label:"",address:""}),[Aa,Ta]=i.useState(!1),[gt,ks]=i.useState(!1),[ss,Es]=i.useState(""),[ts,Is]=i.useState(null),[jt,_s]=i.useState([]),[yt,As]=i.useState(0),[ne,Ue]=i.useState([]),[wt,as]=i.useState(!1),[Nt,Ts]=i.useState(!1),[vt,Ms]=i.useState(!1),[Y,Ce]=i.useState({name:s.name||"",email:s.email||"",phone:s.phone||"",photo:s.avatar||"/default-avatar.png",address:s.address||""});i.useEffect(()=>{s&&Ce(t=>({...t,name:s.name||t.name,email:s.email||t.email,phone:s.phone||t.phone,photo:s.avatar||t.photo}))},[s]);const[me,De]=i.useState(((Ds=(Ps=s==null?void 0:s.savedCards)==null?void 0:Ps[0])==null?void 0:Ds.id)||""),[ae,Ct]=i.useState([]);i.useEffect(()=>{if(!s.id)return;console.log("ðŸ’³ Setting up real-time listener for Stripe cards...");const t=ms(we(ue,"users",s.id,"paymentMethods"),l=>{const c=[];l.forEach(w=>{const _=w.data();c.push({id:_.cardId,cardId:_.cardId,last4:_.last4,brand:_.brand||"Card",expiry:`${_.expMonth}/${String(_.expYear).slice(-2)}`,expMonth:_.expMonth,expYear:_.expYear})}),console.log(`ðŸ’³ Found ${c.length} real cards`),Ct(c),c.length>0&&!me&&De(c[0].id)});return()=>t()},[s.id,me]);const St=async()=>{try{const{Camera:t,CameraResultType:l,CameraSource:c}=await Ne(async()=>{const{Camera:_,CameraResultType:z,CameraSource:X}=await import("./index-1bqWgyMR-1769119750716.js");return{Camera:_,CameraResultType:z,CameraSource:X}},__vite__mapDeps([0,1,2,3,4,5])),w=await t.getPhoto({quality:60,allowEditing:!1,resultType:l.DataUrl,source:c.Prompt,width:1024});w.dataUrl&&Is(w.dataUrl)}catch(t){console.error("Error taking claim photo:",t)}},kt=()=>{if(!ss.trim()){r("Please describe the issue.","warning");return}S({clientId:s.id,clientName:s.name||"Client",clientEmail:s.email,subject:"Issue reported from Client App",description:ss,image:ts||void 0,orderId:re==null?void 0:re.id}),r("Report submitted! Our support team will contact you.","success"),ks(!1),Es(""),Is(null)},Et=async()=>{try{let t={};if(Y.address&&Y.address.trim())try{const l=new google.maps.Geocoder,c=await new Promise((w,_)=>{l.geocode({address:Y.address},(z,X)=>{if(X==="OK"&&z&&z[0]){const F=z[0].geometry.location;w({formatted_address:z[0].formatted_address,lat:F.lat(),lng:F.lng()})}else _(new Error("Address validation failed"))})});t={address:c.formatted_address,addressLat:c.lat,addressLng:c.lng}}catch{r("Could not validate address. Please check and try again.","error");return}await P({name:Y.name,email:Y.email,phone:Y.phone,avatar:Y.photo,...t}),r("Profile updated successfully!","success"),as(!1)}catch(t){console.error("Error updating profile:",t),r("Failed to update profile","error")}};i.useEffect(()=>{ae.length>0&&(me?ae.find(l=>l.id===me)||(console.log("ðŸ’³ Selected card not found, defaulting to first"),De(ae[0].id)):(console.log("ðŸ’³ Auto-selecting first card (init)"),De(ae[0].id)))},[ae,me]);const Rs=async t=>{var l;if(window.confirm("Are you sure you want to remove this card?"))try{r("Removing card...","info");const{getAuth:c}=await Ne(async()=>{const{getAuth:X}=await import("./location-C_GypjLJ-1769119750716.js").then(F=>F.a);return{getAuth:X}},__vite__mapDeps([6,1,2,3,4,5])),_=await((l=c().currentUser)==null?void 0:l.getIdToken()),z=await fetch("/api/deleteStripeCard",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_}`},body:JSON.stringify({cardId:t})});if(!z.ok){const X=await z.json();throw new Error(X.message||"Failed to delete card")}r("Card removed successfully","success")}catch(c){console.error("Error removing card:",c),r("Failed to remove card","error")}},[Ma,It]=i.useState(15);i.useEffect(()=>{if(Ee&&Ee.status==="In Progress"){const t=setInterval(()=>{It(l=>l>1?l-1:1)},3e3);return()=>clearInterval(t)}},[Ee]);const _t=async()=>{try{const{Camera:t,CameraResultType:l,CameraSource:c}=await Ne(async()=>{const{Camera:_,CameraResultType:z,CameraSource:X}=await import("./index-1bqWgyMR-1769119750716.js");return{Camera:_,CameraResultType:z,CameraSource:X}},__vite__mapDeps([0,1,2,3,4,5])),w=await t.getPhoto({quality:60,allowEditing:!1,resultType:l.DataUrl,source:c.Prompt,width:800});if(w.dataUrl){r("Updating profile photo...","info");const _=$s(Fs,`avatars/${s.id}/profile.jpg`);await Gs(_,w.dataUrl,"data_url");const z=await zs(_);ht(z),Ce({...Y,photo:z}),await P({avatar:z}),r("Profile photo updated successfully!","success")}}catch(t){console.error("Error updating profile photo:",t),t.message!=="User cancelled photos app"&&r("Failed to update photo","error")}},At=async t=>{if(!t.label||!t.address)return;const l={id:`a${Date.now()}`,label:t.label,address:t.address,icon:"location_on"},c=[...ve,l];Pe(c);try{return await P({savedAddresses:c}),r("Address saved successfully!","success"),!0}catch(w){return console.error("Error saving address:",w),r("Address added locally but failed to sync","warning"),!1}},Tt=async t=>{if(!window.confirm("Are you sure you want to delete this address?"))return;const l=ve.filter(c=>c.id!==t);Pe(l);try{await P({savedAddresses:l}),r("Address deleted","success")}catch(c){console.error("Error deleting address",c),r("Failed to delete address","error")}},Mt=()=>{le&&(H(le.id,{date:le.date,time:le.time,address:le.address}),Ie(null))},ye=()=>e.jsx("div",{className:"sticky bottom-0 bg-background-dark/95 backdrop-blur-xl border-t border-white/5 p-2 pb-[calc(1.5rem+env(safe-area-inset-bottom))] z-20",children:e.jsx("div",{className:"flex justify-around items-center max-w-lg mx-auto",children:[{icon:"home",label:"Home",action:()=>n(p.CLIENT_HOME),active:a===p.CLIENT_HOME},{icon:"history",label:"History",action:()=>n(p.CLIENT_BOOKINGS),active:a===p.CLIENT_BOOKINGS||a===p.CLIENT_RATING},{icon:"directions_car",label:"Garage",action:()=>n(p.CLIENT_GARAGE),active:a===p.CLIENT_GARAGE},{icon:"person",label:"Profile",action:()=>n(p.CLIENT_PROFILE),active:a===p.CLIENT_PROFILE}].map(t=>e.jsxs("button",{onClick:t.action,className:`flex flex-col items-center gap-1 p-2 rounded-xl transition-all duration-300 relative group w-16 ${t.active?"text-primary":"text-slate-500 hover:text-slate-300"}`,children:[t.active&&e.jsx("div",{className:"absolute -top-2 left-1/2 -translate-x-1/2 w-8 h-1 bg-primary rounded-b-lg shadow-lg shadow-primary/20"}),e.jsx("div",{className:`relative z-10 w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 ${t.active?"bg-primary/20":"bg-transparent group-hover:bg-white/5"}`,children:e.jsx("span",{className:`material-symbols-outlined text-2xl transition-all duration-300 ${t.active?"filled text-primary":"text-slate-500 group-hover:text-slate-300"}`,children:t.icon})}),e.jsx("span",{className:"text-[10px] font-bold relative z-10 transition-all duration-300",children:t.label})]},t.label))})}),ge=()=>e.jsxs(e.Fragment,{children:[e.jsx(Gt,{isOpen:ot,onClose:()=>he(!1),onSave:(t,l)=>ct(t,l),onDelete:()=>{de&&(vs(de.id),he(!1))},vehicleTypes:M,initialVehicle:de}),tt&&e.jsx(ut,{}),Ke&&re&&e.jsx(Bs,{orderId:re.id,currentUserId:s.id,currentUserName:s.name,otherUserId:re.washerId,otherUserName:re.washerName||"Washer",messages:C,sendMessage:E,isOpen:Ke,onClose:()=>us(!1)}),lt&&e.jsx(na,{currentUser:s,onClose:()=>ps(!1)}),le&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-surface-dark w-full max-w-md rounded-2xl border border-white/10 shadow-2xl overflow-hidden p-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Edit Order"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:le.date,onChange:t=>Ie({...le,date:t.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 h-10 text-white"}),e.jsx("input",{type:"text",value:le.time,onChange:t=>Ie({...le,time:t.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 h-10 text-white"}),e.jsx("input",{type:"text",value:le.address,onChange:t=>Ie({...le,address:t.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 h-10 text-white"})]}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>Ie(null),className:"flex-1 py-2 rounded-lg bg-white/10",children:"Cancel"}),e.jsx("button",{onClick:Mt,className:"flex-1 py-2 rounded-lg bg-primary",children:"Save"})]})]})}),Ee&&e.jsx(ra,{activeTrackingOrder:Ee,user:s,setTrackingOrderId:xs,setShowOrderChat:hs,showOrderChat:Je,messages:C,sendMessage:E,updateOrder:H,showNativeToast:os,submitOrderRating:j,navigate:n,packages:x,addons:b})]});if(a===p.CLIENT_HOME)return d.find(t=>["Pending","Assigned","En Route","Arrived","In Progress"].includes(t.status)),e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white",children:[ge(),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-24",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"Welcome back,"}),e.jsx("h1",{className:"text-2xl font-bold",children:Y.name.split(" ")[0]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{onClick:()=>n(p.CLIENT_PROFILE),className:"w-10 h-10 rounded-full bg-cover bg-center border-2 border-white/10",style:{backgroundImage:`url("${Y.photo}")`}})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-600/20 via-cyan-500/20 to-teal-500/20 rounded-2xl p-6 border border-cyan-500/30 mb-8 relative overflow-hidden shadow-2xl backdrop-blur-sm",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-cyan-400/20 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-40 h-40 bg-blue-500/20 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}}),e.jsxs("div",{className:"relative z-10 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-cyan-400 font-bold mb-1 text-sm uppercase tracking-wide flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-cyan-400 rounded-full animate-pulse"}),"Current Weather"]}),e.jsx("h2",{className:"text-5xl font-black text-white mb-1 bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent",children:oe?`${oe.tempF}Â°F`:"--Â°F"}),e.jsx("p",{className:"text-cyan-300 capitalize font-medium mb-2",children:oe?oe.description:"Loading..."}),(oe==null?void 0:oe.recommendation)&&e.jsx("p",{className:"text-white bg-white/10 px-3 py-2 rounded-xl text-sm font-medium border border-white/10 backdrop-blur-md animate-in fade-in slide-in-from-left-4 duration-500",children:oe.recommendation})]}),e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-cyan-400/30 to-blue-500/30 flex items-center justify-center border-2 border-cyan-400/40 shadow-lg shadow-cyan-500/30 backdrop-blur-sm",children:e.jsx("span",{className:"material-symbols-outlined text-5xl text-cyan-300",children:oe?oe.icon:"routine"})})]})]}),e.jsx("h2",{className:"font-bold text-lg mb-3",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[e.jsxs("button",{onClick:()=>{Be(),v([]),n(p.CLIENT_VEHICLE)},className:"bg-surface-dark border border-white/5 p-4 rounded-2xl hover:border-primary/50 transition-all text-left group shadow-lg hover:shadow-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",children:e.jsx("span",{className:"material-symbols-outlined text-primary",children:"add"})}),e.jsx("p",{className:"font-bold text-white",children:"Book a Wash"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Schedule service"})]}),e.jsxs("button",{onClick:()=>{Be(),n(p.CLIENT_GARAGE)},className:"bg-purple-500/5 border border-purple-500/20 p-4 rounded-2xl hover:border-purple-500/40 transition-all text-left group shadow-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",children:e.jsx("span",{className:"material-symbols-outlined text-purple-400",children:"directions_car"})}),e.jsx("p",{className:"font-bold text-white group-hover:text-purple-200 transition-colors",children:"My Garage"}),e.jsxs("p",{className:"text-xs text-purple-400/60 mt-1",children:[ie.length," Vehicles"]})]})]}),e.jsx("h2",{className:"font-bold text-lg mb-3",children:"Active Orders"}),e.jsxs("div",{className:"space-y-3 mb-6",children:[[...Te,...d].filter((l,c,w)=>w.findIndex(_=>_.id===l.id)===c).filter(l=>["Pending","Assigned","En Route","Arrived","In Progress"].includes(l.status)&&!dt.includes(l.id)).map(l=>e.jsxs("div",{className:"bg-surface-dark border border-white/10 rounded-xl p-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-primary"}),e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-primary bg-primary/10 px-2 py-0.5 rounded-full mb-1 inline-block",children:l.status}),e.jsx("h3",{className:"font-bold text-base",children:l.service}),e.jsx("p",{className:"text-sm text-slate-300",children:l.vehicle})]}),e.jsxs("p",{className:"font-bold",children:["$",l.price]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-400 mt-3 pt-3 border-t border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"calendar_month"}),l.date]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"schedule"}),l.time]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:()=>xs(l.id),className:"flex-1 bg-primary text-white py-2.5 rounded-xl font-bold text-sm shadow-blue hover:scale-[1.02] active:scale-[0.98] transition-all ring-1 ring-white/10",children:"Order Status"}),e.jsx("button",{disabled:js===l.id,onClick:async()=>{const c=l.status!=="Pending",w=c?"A washer has been assigned! Cancelling now will incur a $10.00 cancellation fee charged to your payment method. Do you wish to proceed?":"Are you sure you want to cancel? No fee will be charged as no washer has been assigned yet.";if(window.confirm(w)){ys(l.id);try{ws(_=>[..._,l.id]),es(_=>_.filter(z=>z.id!==l.id)),await U(l.id,c),r("Order cancelled.","success")}catch(_){console.error("Cancel failed",_),r("Could not cancel order.","error"),ys(null),ws(z=>z.filter(X=>X!==l.id))}}},className:"px-4 py-2 bg-red-500/20 text-red-400 rounded-lg font-bold text-sm hover:bg-red-500/30 transition-colors disabled:opacity-50",children:js===l.id?"Cancelling...":"Cancel"})]})]},l.id)),d.filter(t=>["Pending","Assigned","En Route","Arrived","In Progress"].includes(t.status)).length===0&&e.jsx("p",{className:"text-slate-500 text-sm text-center py-4",children:"No active orders"})]})]}),e.jsx(ye,{}),ge()]});if(a===p.CLIENT_BOOKINGS){const t=d.filter(l=>["Completed","Cancelled"].includes(l.status));return e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-24",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"History"}),e.jsx("h2",{className:"text-sm text-slate-400 uppercase font-bold mb-3",children:"Past Orders"}),e.jsx("div",{className:"space-y-3",children:t.length>0?t.map(l=>e.jsxs("div",{className:"bg-surface-dark border border-white/5 rounded-xl p-4 transition-all hover:bg-white/5",children:[e.jsxs("button",{onClick:()=>{o({}),Qe(l),n(p.CLIENT_RATING)},className:"w-full text-left",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h3",{className:"font-bold",children:l.service}),e.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded-full ${l.status==="Completed"?"bg-green-500/20 text-green-500":"bg-red-500/20 text-red-500"}`,children:l.status})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-2",children:l.vehicle}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-slate-500",children:[e.jsx("span",{children:l.date}),e.jsxs("span",{className:"font-bold text-slate-300",children:["$",l.price]})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-white/5",children:e.jsxs("button",{onClick:()=>mt(l),className:"w-full py-2 bg-primary/10 text-primary rounded-lg font-bold text-sm hover:bg-primary/20 transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"replay"}),"Order Again"]})})]},l.id)):e.jsx("p",{className:"text-slate-500 text-sm italic",children:"No past orders"})})]}),e.jsx(ye,{}),ge()]})}if(a===p.CLIENT_GARAGE)return e.jsx("div",{className:"flex flex-col h-full bg-background-dark text-white items-center",children:e.jsxs("div",{className:"w-full max-w-lg flex flex-col h-full relative",children:[e.jsxs("header",{className:"flex items-center px-4 py-4 border-b border-white/5",children:[e.jsx("button",{onClick:()=>n(p.CLIENT_HOME),children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back_ios_new"})}),e.jsx("h1",{className:"flex-1 text-center font-bold text-lg mr-6",children:"My Garage"}),e.jsx("button",{onClick:()=>{pt({make:"",model:"",year:"",color:"",plate:"",type:"Sedan"}),bt(null),he(!0)},className:"text-primary",children:e.jsx("span",{className:"material-symbols-outlined",children:"add"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-6 space-y-4 pb-24",children:[ie.map(t=>e.jsxs("div",{className:"bg-surface-dark rounded-xl overflow-hidden border border-white/5 group",children:[e.jsxs("div",{className:"h-40 bg-cover bg-center relative",style:{backgroundImage:`url("${t.image}")`},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"}),e.jsxs("div",{className:"absolute bottom-3 left-3",children:[e.jsx("h3",{className:"text-xl font-bold",children:t.model}),e.jsxs("p",{className:"text-sm text-slate-300",children:[t.plate," â€¢ ",t.color]})]}),e.jsxs("div",{className:"absolute top-3 right-3 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>Ns(t),className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 backdrop-blur-md",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),e.jsx("button",{onClick:()=>vs(t.id),className:"w-8 h-8 rounded-full bg-red-500/20 text-red-500 flex items-center justify-center hover:bg-red-500/30 backdrop-blur-md",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]})]}),e.jsxs("div",{className:"p-3 flex justify-between items-center bg-white/5",children:[e.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:t.type}),e.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:(()=>{const l=M.find(w=>w.name===t.type),c=(l==null?void 0:l.icon)||"directions_car";return c.includes("/")||c.includes(".")?e.jsx("img",{src:c,alt:t.type,className:"w-full h-full object-contain opacity-50"}):e.jsx("span",{className:"material-symbols-outlined text-slate-500",children:c})})()})]})]},t.id)),ie.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-slate-500",children:[e.jsx("span",{className:"material-symbols-outlined text-6xl mb-4 opacity-50",children:"garage"}),e.jsx("p",{children:"Your garage is empty."}),e.jsx("button",{onClick:()=>he(!0),className:"mt-4 text-primary font-bold",children:"Add a Vehicle"})]})]}),e.jsx(ye,{}),e.jsx(cs,{isOpen:Re,onClose:()=>ce(!1),amount:(fe==null?void 0:fe.price)||0,orderId:(fe==null?void 0:fe.id)||"",clientEmail:s.email,clientName:s.name,onSuccess:t=>{Be(100),fe&&(H(fe.id,{cardId:t}),r("Payment method secured! Booking confirmed.","success"),o({date:"",time:"",packageId:"",addons:[],price:0,vehicleId:""}),n(p.CLIENT_HOME),Le(null),ce(!1))}}),ge()]})});if(a===p.CLIENT_PROFILE)return e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white relative",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-24",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:se.t("profile")}),e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-cover bg-center border-2 border-primary",style:{backgroundImage:`url("${Y.photo}")`}}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-lg",children:Y.name}),e.jsx("p",{className:"text-slate-400",children:Y.email})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>as(!0),className:"w-full bg-surface-dark p-4 rounded-xl flex items-center justify-between border border-white/5 hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"person"})," ",e.jsx("span",{children:se.t("edit_profile")})]}),e.jsx("span",{className:"material-symbols-outlined text-slate-500",children:"chevron_right"})]}),e.jsxs("button",{onClick:()=>n(p.CLIENT_GARAGE),className:"w-full bg-surface-dark p-4 rounded-xl flex items-center justify-between border border-white/5 hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"garage"})," ",e.jsx("span",{children:se.t("my_garage")})]}),e.jsx("span",{className:"material-symbols-outlined text-slate-500",children:"chevron_right"})]}),e.jsxs("button",{onClick:()=>Me(!0),className:"w-full bg-surface-dark p-4 rounded-xl flex items-center justify-between border border-white/5 hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"credit_card"})," ",e.jsx("span",{children:se.t("payment_methods")})]}),e.jsx("span",{className:"material-symbols-outlined text-slate-500",children:"chevron_right"})]}),e.jsxs("button",{onClick:()=>Ts(!0),className:"w-full bg-surface-dark p-4 rounded-xl flex items-center justify-between border border-white/5 hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"location_on"})," ",e.jsx("span",{children:se.t("my_addresses")})]}),e.jsx("span",{className:"material-symbols-outlined text-slate-500",children:"chevron_right"})]}),e.jsxs("button",{onClick:()=>Ms(!0),className:"w-full bg-gradient-to-r from-amber-500/10 to-purple-500/10 p-4 rounded-xl flex items-center justify-between border border-amber-500/30 hover:border-amber-500/50 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-amber-400 group-hover:scale-110 transition-transform",children:"stars"}),e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"font-bold text-white",children:se.t("loyalty_program")}),e.jsx("p",{className:"text-xs text-slate-400",children:se.t("loyalty_desc")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"bg-amber-500/20 px-2 py-1 rounded-lg text-amber-500 text-[10px] font-black border border-amber-500/20",children:[s.loyaltyPoints||0," ",s.loyaltyPoints===1?"WASH":"WASHES"]}),e.jsx("span",{className:"material-symbols-outlined text-amber-400",children:"chevron_right"})]})]}),e.jsxs("button",{onClick:()=>ps(!0),className:"w-full bg-surface-dark p-4 rounded-xl flex items-center justify-between border border-white/5 mt-6 hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-primary",children:"support_agent"})," ",e.jsx("span",{className:"text-primary font-bold",children:se.t("contact_support")})]}),e.jsx("span",{className:"material-symbols-outlined text-primary",children:"chevron_right"})]}),e.jsxs("button",{onClick:()=>n(p.WASHER_REGISTRATION),className:"w-full bg-surface-dark p-4 rounded-xl flex items-center justify-between border border-white/5 mt-4 hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-green-400",children:"work"}),e.jsx("span",{className:"font-bold text-white",children:se.t("join_team")})]}),e.jsx("span",{className:"material-symbols-outlined text-slate-500",children:"chevron_right"})]}),e.jsx("button",{onClick:D,className:"w-full p-4 text-red-500 font-bold mt-4",children:se.t("logout")})]})]}),e.jsx(ye,{}),ge(),wt&&e.jsx("div",{className:"absolute inset-0 bg-black/90 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-surface-dark w-full max-w-md rounded-2xl border border-white/10 p-6",children:[e.jsx("h3",{className:"font-bold text-xl mb-6",children:se.t("edit_profile")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-cover bg-center border-4 border-primary",style:{backgroundImage:`url("${Y.photo}")`}}),e.jsx("button",{onClick:_t,className:"absolute bottom-0 right-0 w-8 h-8 bg-primary rounded-full flex items-center justify-center hover:bg-primary-dark",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"photo_camera"})})]}),e.jsx("p",{className:"text-xs text-slate-400 mt-2",children:se.t("click_camera")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase font-bold",children:se.t("full_name")}),e.jsx("input",{type:"text",value:Y.name,onChange:t=>Ce({...Y,name:t.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-xl p-3 mt-1 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase font-bold",children:se.t("email_address")}),e.jsx("input",{type:"email",value:Y.email,onChange:t=>Ce({...Y,email:t.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-xl p-3 mt-1 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase font-bold",children:se.t("phone_number")}),e.jsx("input",{type:"tel",value:Y.phone,onChange:t=>Ce({...Y,phone:t.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-xl p-3 mt-1 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase font-bold",children:"Home Address"}),e.jsx("textarea",{value:Y.address||"",onChange:t=>Ce({...Y,address:t.target.value}),placeholder:"Enter your full address...",rows:2,className:"w-full bg-white/5 border border-white/10 rounded-xl p-3 mt-1 text-white resize-none"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"This will be your default service address"})]}),e.jsx("button",{onClick:Et,style:{backgroundColor:"#3b82f6"},className:"w-full hover:brightness-90 h-12 rounded-xl font-bold mt-4 text-white shadow-blue transition-all",children:se.t("save_changes")}),e.jsx("button",{onClick:()=>as(!1),className:"w-full text-slate-400 py-2",children:se.t("cancel")})]})]})}),Nt&&e.jsx("div",{className:"absolute inset-0 bg-black/90 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-surface-dark w-full max-w-md rounded-2xl border border-white/10 p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-bold text-xl",children:"My Addresses"}),e.jsx("button",{onClick:()=>Ts(!1),children:e.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),e.jsx("div",{className:"space-y-3 mb-6",children:ve.map(t=>e.jsx("div",{className:"bg-white/5 p-4 rounded-xl border border-white/10",children:e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-primary",children:t.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:t.label}),e.jsx("p",{className:"text-sm text-slate-400",children:t.address})]})]}),e.jsx("button",{onClick:()=>Pe(ve.filter(l=>l.id!==t.id)),className:"text-red-400 hover:text-red-300",children:e.jsx("span",{className:"material-symbols-outlined",children:"delete"})})]})},t.id))}),e.jsxs("button",{onClick:()=>ft(!0),className:"w-full bg-primary h-12 rounded-xl font-bold flex items-center justify-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined",children:"add"})," Add New Address"]})]})}),Cs&&e.jsx("div",{className:"absolute inset-0 bg-black/90 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-surface-dark w-full max-w-md rounded-2xl border border-white/10 p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-bold text-xl",children:"Payment Methods"}),e.jsx("button",{onClick:()=>Me(!1),children:e.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),!Re&&e.jsxs("div",{className:"space-y-3 mb-6",children:[ae.map(t=>e.jsxs("div",{className:"bg-white/5 p-4 rounded-xl border border-white/10 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-6 bg-white/10 rounded flex items-center justify-center text-xs font-bold",children:t.brand}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold",children:["â€¢â€¢â€¢â€¢ ",t.last4]}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Expires ",t.expiry]})]})]}),e.jsx("button",{onClick:()=>Rs(t.id),className:"text-red-400 hover:text-red-300",children:e.jsx("span",{className:"material-symbols-outlined",children:"delete"})})]},t.id)),ae.length===0&&e.jsx("p",{className:"text-center text-slate-500 py-8",children:"No saved cards found. Add one below!"})]}),e.jsxs("button",{onClick:()=>{Le({price:0,id:"WALLET_SAVE"}),ce(!0)},className:"w-full bg-primary h-12 rounded-xl font-bold flex items-center justify-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined",children:"add"})," Add New Card"]})]})}),gt&&e.jsx("div",{className:"absolute inset-0 bg-black/90 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-surface-dark w-full max-w-md rounded-2xl border border-white/10 p-6",children:[e.jsxs("h3",{className:"font-bold text-xl mb-4 text-red-400 flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined",children:"report_problem"})," Report an Issue"]}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Please describe the issue and upload a photo if possible."}),e.jsx("textarea",{value:ss,onChange:t=>Es(t.target.value),placeholder:"Describe what happened...",className:"w-full bg-white/5 border border-white/10 rounded-xl p-3 h-32 mb-4 text-white"}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{onClick:St,className:"block w-full p-4 border-2 border-dashed border-white/10 rounded-xl text-center cursor-pointer hover:bg-white/5 transition-colors",children:ts?e.jsx("img",{src:ts,className:"h-32 mx-auto rounded-lg object-cover"}):e.jsxs("div",{className:"text-slate-400",children:[e.jsx("span",{className:"material-symbols-outlined text-3xl mb-2",children:"add_a_photo"}),e.jsx("p",{className:"text-xs",children:"Tap to take car photo"})]})})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>ks(!1),className:"flex-1 py-3 rounded-xl font-bold text-slate-400 hover:bg-white/5",children:"Cancel"}),e.jsx("button",{onClick:kt,className:"flex-1 py-3 rounded-xl font-bold bg-red-500 text-white hover:bg-red-600",children:"Submit Claim"})]})]})}),vt&&e.jsx("div",{className:"absolute inset-0 bg-black/90 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-surface-dark w-full max-w-md rounded-2xl border border-white/10 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-surface-dark border-b border-white/10 p-4 flex justify-between items-center z-10",children:[e.jsx("h3",{className:"font-bold text-xl",children:"Loyalty Program"}),e.jsx("button",{onClick:()=>Ms(!1),children:e.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),e.jsx("div",{className:"p-4",children:e.jsx(Pt,{userId:s.id})})]})}),e.jsx(cs,{isOpen:Re,onClose:()=>ce(!1),amount:0,orderId:"WALLET_SAVE",clientEmail:s.email,clientName:s.name,onSuccess:t=>{console.log("âœ… Card saved from profile:",t),r("Card saved successfully!","success"),ce(!1),Me(!1)}}),e.jsx("div",{className:"w-full absolute bottom-0",children:e.jsx(ye,{})}),re&&!Ke&&re.status!=="Pending"&&re.status!=="Assigned"&&e.jsx(zt,{onClick:()=>us(!0),unreadCount:xt,label:"Message Washer"}),ge()]});if(a===p.CLIENT_BOOKINGS){const t=d.filter(l=>["Completed","Cancelled"].includes(l.status)).sort((l,c)=>{var w,_;return(((w=c.createdAt)==null?void 0:w.seconds)||0)-(((_=l.createdAt)==null?void 0:_.seconds)||0)});return e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white",children:[e.jsxs("header",{className:"flex items-center px-4 py-4 border-b border-white/5 bg-surface-dark/50 backdrop-blur-md sticky top-0 z-30",children:[e.jsx("button",{onClick:()=>n(p.CLIENT_HOME),children:e.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"arrow_back_ios_new"})}),e.jsx("h1",{className:"flex-1 text-center font-bold text-lg mr-6",children:"Order History"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-24",children:t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh] text-center p-8 opacity-60",children:[e.jsx("span",{className:"material-symbols-outlined text-6xl text-slate-600 mb-4",children:"history_toggle_off"}),e.jsx("p",{className:"text-slate-400 font-medium",children:"No past orders found."}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Your completed and cancelled orders will appear here."})]}):e.jsx("div",{className:"space-y-4",children:t.map(l=>{var c,w;return e.jsxs("div",{onClick:()=>{Qe(l),n(p.CLIENT_RATING)},className:"bg-surface-dark border border-white/5 rounded-2xl p-4 active:scale-[0.98] transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${l.status==="Completed"?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"}`,children:e.jsx("span",{className:"material-symbols-outlined",children:l.status==="Completed"?"check_circle":"cancel"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:l.service||(l.vehicleConfigs&&l.vehicleConfigs.length>1?`${l.vehicleConfigs.length} Vehicles`:"Custom Service")}),e.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-tight",children:new Date(((c=l.createdAt)==null?void 0:c.seconds)*1e3||Date.now()).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]}),e.jsxs("span",{className:"font-black text-white",children:["$",(l.price||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-[10px]",children:[e.jsxs("div",{className:"flex items-center gap-1 text-slate-400",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"location_on"}),e.jsx("span",{className:"truncate max-w-[150px]",children:(w=l.address)==null?void 0:w.split(",")[0]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l.clientRating&&e.jsxs("div",{className:"flex items-center gap-0.5 text-amber-500",children:[e.jsx("span",{className:"material-symbols-outlined text-[10px] filled",children:"star"}),e.jsx("span",{className:"font-bold",children:l.clientRating})]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full font-black uppercase tracking-widest ${l.status==="Completed"?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"}`,children:l.status})]})]})]},l.id)})})}),e.jsx(ye,{})]})}if(a===p.CLIENT_RATING){const t=ze==null?void 0:ze.id,l=(t?d.find($=>$.id===t):null)||ze||d.find($=>$.status==="Completed"&&!$.clientRating);if(!l)return e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white items-center justify-center p-4",children:[e.jsx("p",{children:"No order details found."}),e.jsx("button",{onClick:()=>n(p.CLIENT_HOME),className:"mt-4 text-primary",children:"Go Home"})]});const c=l.price||0,w=!!l.rating,_=l.tip||0,z=c+_e,X=$=>{if(w)return;const xe=c*$;gs(xe),nt(!1),it("")},F=async()=>{if(console.log("â­ Submit Rating Clicked"),w){console.log("Already rated, navigating home"),n(p.CLIENT_BOOKINGS);return}if(!be||be===0){console.log("No rating selected"),r("Please select a rating","warning");return}console.log("Submitting rating:",{orderId:l.id,rating:be,review:He,tip:_e}),be<5&&!He.trim()&&r("Consider leaving a comment to help us improve","info");try{if(!j){console.error("submitOrderRating function is missing!"),r("Internal error: Cannot submit rating","error");return}await j(l.id,{clientRating:be,clientReview:He.trim(),tip:_e,washerId:l.washerId||""}),console.log("âœ… Rating submitted successfully"),r("Thank you for your feedback!","success"),Zs($=>[...$,l.id]),bs(0),fs(""),gs(0),Qe(null),n(p.CLIENT_HOME)}catch($){console.error("Error submitting rating:",$),r("Error submitting review. Please try again.","error")}finally{rt(!1)}};return e.jsxs("div",{className:"fixed inset-0 flex flex-col bg-background-dark text-white z-50 overflow-hidden",children:[e.jsxs("div",{className:"absolute top-0 w-full p-4 flex justify-between items-center z-20 bg-gradient-to-b from-black/80 to-transparent",children:[e.jsx("button",{onClick:()=>n(p.CLIENT_HOME),children:e.jsx("span",{className:"material-symbols-outlined text-slate-300",children:"arrow_back"})}),e.jsx("img",{src:"/logo.png",alt:"Logo",className:"h-8 object-contain drop-shadow-md"}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/20 border border-primary/50 flex items-center justify-center text-xs text-primary font-bold",children:s.name?s.name.charAt(0).toUpperCase():"C"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 pt-20 pb-64",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-green-500/20 text-green-500 flex items-center justify-center mb-4 mx-auto",children:e.jsx("span",{className:"material-symbols-outlined text-4xl",children:"check"})}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Service Completed"}),e.jsx("p",{className:"text-slate-400 text-sm",children:w?"Thank you for your feedback!":"How was your experience?"})]}),e.jsx("div",{className:"flex justify-center gap-3 mb-8",children:[1,2,3,4,5].map($=>e.jsx("button",{onClick:()=>!w&&bs($),className:"transition-transform hover:scale-110 disabled:opacity-100 disabled:cursor-default",disabled:w,children:e.jsx("span",{className:`material-symbols-outlined text-5xl ${$<=(be||0)?"text-amber-400 filled":"text-slate-600"}`,children:"star"})},$))}),be>0&&be<5||w&&l.clientReview?e.jsxs("div",{className:"w-full mb-8 animate-in fade-in slide-in-from-top-4 duration-300",children:[e.jsx("p",{className:"text-sm text-slate-300 mb-2 font-bold text-left w-full",children:"Tell us what went wrong:"}),e.jsx("textarea",{className:"w-full bg-surface-dark border border-white/10 rounded-xl p-3 text-sm text-white focus:outline-none focus:border-red-500 transition-colors h-24 resize-none",placeholder:"The washer was...",value:He,onChange:$=>fs($.target.value),disabled:w})]}):null,e.jsxs("div",{className:"w-full bg-surface-dark rounded-2xl p-4 border border-white/10 mb-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-white/5 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/20 flex items-center justify-center text-primary",children:e.jsx("span",{className:"material-symbols-outlined",children:"local_car_wash"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-sm text-white",children:l.service}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Order #",((Vs=l.displayId)==null?void 0:Vs.replace(/^#/,""))||l.id.substring(0,6)," â€¢ ",l.vehicle," â€¢ ",l.vehicleColor||"Vehicle"]})]})]}),e.jsxs("span",{className:"font-bold text-lg text-white",children:["$",c.toFixed(2)]})]}),w&&l.washerName&&e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-slate-400 text-sm",children:"Washer"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-slate-700 flex items-center justify-center text-[10px] font-bold",children:l.washerName.charAt(0)}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-sm",children:l.washerName}),l.washerId&&e.jsxs("p",{className:"text-[10px] text-slate-500",children:["ID: ",l.washerId.slice(-6)]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-slate-400 text-sm",children:"Date"}),e.jsxs("span",{className:"font-medium text-sm",children:[l.date," at ",l.time]})]}),w&&e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-slate-400 text-sm",children:"Your Rating"}),e.jsxs("div",{className:"flex items-center gap-1 text-amber-400",children:[e.jsx("span",{className:"font-bold",children:l.rating}),e.jsx("span",{className:"material-symbols-outlined text-sm filled",children:"star"})]})]})]}),e.jsxs("div",{className:"w-full bg-surface-dark rounded-2xl p-6 border border-white/10 mb-24",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-bold text-sm",children:w?"Tip Included":"Add a Tip"}),e.jsxs("span",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-xs text-green-500",children:"volunteer_activism"}),"100% goes to washer"]})]}),w?e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white/5 rounded-lg",children:[e.jsx("span",{className:"text-slate-400",children:"Tip Amount"}),e.jsxs("span",{className:"font-bold text-green-400",children:["$",_.toFixed(2)]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[.1,.15,.2].map($=>e.jsxs("button",{onClick:()=>X($),className:`py-3 rounded-lg border transition-all font-bold text-sm ${Math.abs(_e-c*$)<.01&&_e>0?"bg-primary border-primary text-black":"bg-background-dark border-slate-600 text-white hover:bg-white/5"}`,children:[$*100,"%"]},$))}),e.jsx("p",{className:"text-xs text-center text-slate-400 mt-2",children:"Select a tip percentage to show your appreciation"})]})]})]}),e.jsxs("div",{className:"absolute bottom-0 w-full bg-surface-dark border-t border-white/10 p-6 pb-[calc(1.5rem+env(safe-area-inset-bottom))] z-20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-slate-400",children:"Total"}),e.jsxs("span",{className:"text-xl font-bold",id:"total-price",children:["$",z.toFixed(2)]})]}),!w&&e.jsx("button",{onClick:F,className:"w-full py-4 bg-primary hover:bg-primary/90 rounded-xl font-bold text-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Finish"}),w&&e.jsx("button",{onClick:()=>n(p.CLIENT_HOME),className:"w-full py-4 bg-white/10 text-white font-bold rounded-xl",children:"Back to Home"})]})]})}if(a===p.CLIENT_PAYMENT)return e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white",children:[e.jsxs("header",{className:"flex items-center px-4 py-4 border-b border-white/5",children:[e.jsx("button",{onClick:()=>n(p.CLIENT_SERVICE_SELECT),children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back_ios_new"})}),e.jsx("h1",{className:"flex-1 text-center font-bold text-lg mr-6",children:"Payment Method"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-32",children:[e.jsx("h2",{className:"text-sm text-slate-400 uppercase font-bold mb-4",children:"Select Payment Method"}),e.jsx("div",{className:"space-y-3 mb-6",children:ae.map(t=>e.jsx("button",{onClick:()=>De(t.id),className:`w-full p-4 rounded-xl border-2 transition-all ${me===t.id?"border-primary bg-primary/10":"border-white/10 bg-white/5"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${me===t.id?"border-primary":"border-slate-500"}`,children:me===t.id&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-primary"})}),e.jsx("div",{className:"w-10 h-6 bg-white/10 rounded flex items-center justify-center text-xs font-bold",children:t.brand}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("p",{className:"font-bold",children:["â€¢â€¢â€¢â€¢ ",t.last4]}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Expires ",t.expiry]})]})]})},t.id))}),e.jsx("button",{onClick:()=>Me(!0),className:"w-full p-4 rounded-xl border-2 border-dashed border-white/20 text-slate-400 hover:border-primary hover:text-primary transition-colors",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined",children:"add"}),e.jsx("span",{className:"font-bold",children:"Add New Card"})]})})]}),e.jsx("div",{className:"absolute bottom-0 w-full bg-surface-dark border-t border-white/5 p-4 pb-[calc(1rem+env(safe-area-inset-bottom))]",children:e.jsx("button",{onClick:()=>n(p.CLIENT_CONFIRM),className:"w-full h-14 bg-primary rounded-xl font-bold text-lg hover:bg-primary-dark transition-colors",children:"Continue to Confirm"})})]});if(a===p.CLIENT_REPORT_ISSUE){const[t,l]=i.useState(""),[c,w]=i.useState(""),[_,z]=i.useState(""),X=()=>{if(!t.trim()||!c.trim()){r("Please fill in all fields","warning");return}const F={clientId:s.id,clientName:s.name,clientEmail:s.email,subject:t,description:c};_&&(F.orderId=_),S(F),r("Issue reported successfully. We will contact you shortly.","success"),n(p.CLIENT_PROFILE)};return e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white",children:[e.jsxs("header",{className:"flex items-center px-4 py-4 border-b border-white/5",children:[e.jsx("button",{onClick:()=>n(p.CLIENT_PROFILE),children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back_ios_new"})}),e.jsx("h1",{className:"flex-1 text-center font-bold text-lg mr-6",children:"Report an Issue"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-20",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-surface-dark p-4 rounded-xl border border-white/5",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-400 uppercase mb-2",children:"Subject"}),e.jsx("input",{type:"text",value:t,onChange:F=>l(F.target.value),placeholder:"e.g. Washer late, Quality issue...",className:"w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white placeholder:text-slate-500 focus:outline-none focus:border-red-500 transition-colors"})]}),e.jsxs("div",{className:"bg-surface-dark p-4 rounded-xl border border-white/5",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-400 uppercase mb-2",children:"Related Order (Optional)"}),e.jsxs("select",{value:_,onChange:F=>z(F.target.value),className:"w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white focus:outline-none focus:border-red-500 transition-colors",children:[e.jsx("option",{value:"",children:"Select an order..."}),d.map(F=>{var $;return e.jsxs("option",{value:F.id,children:[new Date((($=F.createdAt)==null?void 0:$.seconds)*1e3||Date.now()).toLocaleDateString()," - ",F.vehicleName||"Vehicle"," (",F.status,")"]},F.id)})]})]}),e.jsxs("div",{className:"bg-surface-dark p-4 rounded-xl border border-white/5",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-400 uppercase mb-2",children:"Description"}),e.jsx("textarea",{value:c,onChange:F=>w(F.target.value),placeholder:"Please describe the issue in detail...",className:"w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white placeholder:text-slate-500 min-h-[150px] focus:outline-none focus:border-red-500 transition-colors"})]})]})}),e.jsx("div",{className:"p-4 border-t border-white/5 bg-surface-dark",children:e.jsxs("button",{onClick:X,className:"w-full bg-red-500 hover:bg-red-600 text-white font-bold py-4 rounded-xl transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined",children:"send"}),"Submit Report"]})})]})}if(a===p.CLIENT_VEHICLE)return e.jsxs(e.Fragment,{children:[ge(),e.jsx(ia,{vehicles:ie,tempSelectedVehicles:A,setTempSelectedVehicles:v,setVehicleConfigs:Ue,setSelectedVehicleIds:_s,setCurrentVehicleIndex:As,navigate:n,setShowAddVehicleModal:t=>{console.log("ðŸš— VehicleSelectionScreen: setShowAddVehicleModal called with:",t),t&&(console.log("ðŸ”„ Resetting editingVehicle to null for new vehicle"),Ae(null)),he(t)},showToast:r,onEdit:t=>{console.log("âœï¸ VehicleSelectionScreen: onEdit called with vehicle:",t),Ns(t)}})]});if(a===p.CLIENT_GARAGE)return e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white",children:[ge(),e.jsxs("header",{className:"flex items-center px-4 py-4 border-b border-white/5 bg-surface-dark/50 backdrop-blur-md sticky top-0 z-30",children:[e.jsx("button",{onClick:()=>n(p.CLIENT_HOME),children:e.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"arrow_back_ios_new"})}),e.jsx("h1",{className:"flex-1 text-center font-bold text-lg mr-6",children:"My Garage"}),e.jsx("button",{onClick:()=>{Ae(null),he(!0)},children:e.jsx("span",{className:"material-symbols-outlined text-primary",children:"add"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-24",children:ie.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh] text-center p-8 opacity-60",children:[e.jsx("span",{className:"material-symbols-outlined text-6xl text-slate-600 mb-4",children:"no_crash"}),e.jsx("p",{className:"text-slate-400 font-medium",children:"Your garage is empty."}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Add your first vehicle to get started."})]}):e.jsx("div",{className:"grid gap-4",children:ie.map(t=>e.jsxs("div",{className:"relative group overflow-hidden rounded-2xl bg-surface-dark border border-white/5 shadow-2xl transition-all hover:scale-[1.02] hover:shadow-primary/10 hover:border-primary/30",children:[e.jsxs("div",{className:"aspect-video w-full bg-black/60 relative flex items-center justify-center overflow-hidden",children:[t.image?e.jsx("img",{src:t.image,alt:t.model,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}):e.jsx("div",{className:"flex flex-col items-center justify-center opacity-20 w-full h-full p-8",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-full h-full text-white",children:[e.jsx("path",{d:"M18.92 6.01C18.72 5.42 18.16 5 17.5 5H6.5C5.84 5 5.29 5.42 5.08 6.01L3 12V20C3 20.55 3.45 21 4 21H5C5.55 21 6 20.55 6 20V19H18V20C18 20.55 18.45 21 19 21H20C20.55 21 21 20.55 21 20V12L18.92 6.01ZM6.5 6.5H17.5L18.5 9.5H5.5L6.5 6.5ZM19 17H5V12L5.5 11H18.5L19 12V17Z",fill:"currentColor"}),e.jsx("path",{d:"M7.5 16C8.32843 16 9 15.3284 9 14.5C9 13.6716 8.32843 13 7.5 13C6.67157 13 6 13.6716 6 14.5C6 15.3284 6.67157 16 7.5 16Z",fill:"currentColor"}),e.jsx("path",{d:"M16.5 16C17.3284 16 18 15.3284 18 14.5C18 13.6716 17.3284 13 16.5 13C15.6716 13 15 13.6716 15 14.5C15 15.3284 15.6716 16 16.5 16Z",fill:"currentColor"})]})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-surface-dark via-transparent to-transparent"})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-5",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-0.5",children:t.model}),e.jsxs("p",{className:"text-xs font-bold text-primary uppercase tracking-widest mb-0",children:[t.make||"Vehicle"," â€¢ ",t.color||"Custom"]}),e.jsxs("div",{className:"flex justify-between items-end mt-4",children:[e.jsx("div",{className:"px-3 py-1 rounded bg-white/5 backdrop-blur-sm border border-white/10 text-[10px] font-bold text-slate-400 uppercase",children:t.type.replace("_"," ")}),e.jsx("span",{className:"material-symbols-outlined text-slate-600",children:"garage"})]})]}),e.jsx("button",{onClick:()=>{Ae(t),he(!0)},className:"absolute inset-0 z-10"})]},t.id))})}),e.jsx(ye,{})]});if(a===p.CLIENT_SERVICE_SELECT)return console.log("ðŸŽ¨ Rendering CLIENT_SERVICE_SELECT screen"),e.jsx(oa,{packages:x,packagesError:m,addons:b,vehicles:ie,selectedVehicleIds:jt,currentVehicleIndex:yt,vehicleConfigs:ne,setVehicleConfigs:Ue,setCurrentVehicleIndex:As,navigate:n,showToast:r});if(a===p.CLIENT_DATE_TIME){console.log("ðŸ• Rendering CLIENT_DATE_TIME screen"),console.log("ðŸ“… States:",{selectedOption:B,selectedDate:V,selectedTime:O});try{return e.jsx(da,{selectedOption:B,setSelectedOption:T,selectedDate:V,setSelectedDate:L,selectedTime:O,setSelectedTime:je,navigate:n,showToast:r,orders:d,team:k})}catch(t){return console.error("âŒ Error rendering DateTimeSelectionScreen:",t),e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white items-center justify-center p-4",children:[e.jsx("span",{className:"material-symbols-outlined text-6xl text-red-500 mb-4",children:"error"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Error Loading Screen"}),e.jsx("p",{className:"text-slate-400 text-center mb-4",children:t instanceof Error?t.message:"Unknown error"}),e.jsx("button",{onClick:()=>n(p.CLIENT_VEHICLE),className:"bg-primary px-6 py-3 rounded-xl font-bold",children:"Go Back"})]})}}if(a===p.CLIENT_ADDRESS)return console.log("ðŸ“ Rendering CLIENT_ADDRESS screen. Addresses:",ve,"User Address:",s.address),e.jsx(ca,{selectedAddress:ke,setSelectedAddress:Qs,selectedLocation:qe,setSelectedLocation:Ks,navigate:n,showToast:r,savedAddresses:ve,userAddress:s.address,onSaveAddress:At,onDeleteAddress:Tt,serviceArea:N});if(a===p.CLIENT_PAYMENT_METHODS)return console.log("ðŸ’³ Rendering PaymentMethodsScreen"),e.jsxs(e.Fragment,{children:[e.jsx(xa,{savedCards:ae,selectedCardId:me,onSelectCard:De,onAddCard:()=>{Le({price:0,id:"WALLET_SAVE"}),ce(!0)},navigate:n}),e.jsx(cs,{isOpen:Re,onClose:()=>ce(!1),amount:0,orderId:"WALLET_SAVE",clientEmail:s.email,clientName:s.name,onSuccess:t=>{console.log("âœ… Card saved from payment methods:",t),r("Card saved successfully!","success"),ce(!1)}})]});if(a===p.CLIENT_CONFIRM){const t=(l,c,w)=>{if(!qe){r("Location error: Could not retrieve coordinates. Please re-select the address.","error");return}const _=V||"Date Not Selected",z=O||"Time Not Selected";let X="";ne&&ne.length>0&&(ne.forEach(Z=>{const Q=x.find(ee=>ee.id===Z.packageId);Q&&Q.price&&(Q.price[Z.vehicleType],X||(X=Q.name)),Z.addonIds.forEach(ee=>{const te=b.find(pe=>pe.id===ee);te&&te.price&&te.price[Z.vehicleType]})}),ne.length>1&&(X=`${ne.length} Vehicles`));let F=0;ne&&ne.length>0&&ne.forEach(Z=>{const Q=x.find(ee=>ee.id===Z.packageId);if(Q&&Q.duration){const ee=Q.duration.match(/(\d+)h/),te=Q.duration.match(/(\d+)m/);ee&&(F+=parseInt(ee[1])*60),te&&(F+=parseInt(te[1])),!ee&&!te&&!isNaN(parseInt(Q.duration))&&(F+=parseInt(Q.duration))}Z.addonIds.forEach(ee=>{const te=b.find(pe=>pe.id===ee);if(te&&te.duration){const pe=te.duration.match(/(\d+)h/),We=te.duration.match(/(\d+)m/);pe&&(F+=parseInt(pe[1])*60),We&&(F+=parseInt(We[1]))}})});const $=Math.floor(F/60),xe=F%60,ls=$>0?`${$}h ${xe>0?xe+"m":""}`:`${xe} min`,q={vehicleConfigs:ne||[],date:_,time:z,price:l,packageName:X||"Custom Service",estimatedDuration:ls,status:"Pending",address:ke||"Address Not Provided",location:qe,clientName:(s==null?void 0:s.name)||"Unknown Client",clientId:(s==null?void 0:s.id)||"unknown_id",appliedDiscountId:c||void 0,cardId:w};Ze(!0),R(q).then(Z=>{var ee,te,pe;Ze(!1);const Q={id:Z,...q,createdAt:{seconds:Date.now()/1e3,nanoseconds:0},vehicleName:(ee=q.vehicleConfigs[0])==null?void 0:ee.vehicleType,vehicle:((te=q.vehicleConfigs[0])==null?void 0:te.vehicleModel)||"Unknown Vehicle",vehicleType:((pe=q.vehicleConfigs[0])==null?void 0:pe.vehicleType)||"sedan",service:q.packageName};es(We=>[Q,...We]),Ue([]),v([]),Le({...Q,id:Z}),ce(!0)}).catch(Z=>{console.error("Order creation failed:",Z),Ze(!1),r("Error creating order. Please try again.","error")})};return e.jsxs(e.Fragment,{children:[e.jsx(ma,{packages:x,addons:b,vehicles:ie,vehicleConfigs:ne,selectedDate:V,selectedTime:O,selectedAddress:ke,globalFees:y,discounts:W,onConfirmOrder:t,navigate:n,showFeesToClient:!1,selectedCard:(()=>{var w,_;const l=ae.length>0?ae:(s==null?void 0:s.savedCards)||[],c=me||((_=(w=s==null?void 0:s.savedCards)==null?void 0:w[0])==null?void 0:_.id);return l.find(z=>z.id===c)||l[0]||null})(),onAddCard:()=>{n(p.CLIENT_PAYMENT_METHODS)},userId:s.id}),Cs&&e.jsx("div",{className:"fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-surface-dark w-full max-w-md rounded-2xl border border-white/10 p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-bold text-xl text-white",children:"Payment Methods"}),e.jsx("button",{onClick:()=>Me(!1),children:e.jsx("span",{className:"material-symbols-outlined text-white",children:"close"})})]}),!Re&&e.jsxs("div",{className:"space-y-3 mb-6",children:[ae.map(l=>e.jsxs("div",{className:"bg-white/5 p-4 rounded-xl border border-white/10 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-6 bg-white/10 rounded flex items-center justify-center text-xs font-bold text-white",children:l.brand}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-white",children:["â€¢â€¢â€¢â€¢ ",l.last4]}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Expires ",l.expiry]})]})]}),e.jsx("button",{onClick:()=>Rs(l.id),className:"text-red-400 hover:text-red-300",children:e.jsx("span",{className:"material-symbols-outlined",children:"delete"})})]},l.id)),ae.length===0&&e.jsx("p",{className:"text-center text-slate-500 py-8 italic",children:"No saved cards found. Add one below!"})]}),e.jsxs("button",{onClick:()=>{Le({price:0,id:"WALLET_SAVE"}),ce(!0)},className:"w-full bg-primary h-12 rounded-xl font-bold flex items-center justify-center gap-2 text-black",children:[e.jsx("span",{className:"material-symbols-outlined",children:"add"})," Add New Card"]})]})})]})}return console.log("âš ï¸ No screen matched, returning null. Current screen:",a),null},Ga=ua;export{Ga as ClientScreens};
