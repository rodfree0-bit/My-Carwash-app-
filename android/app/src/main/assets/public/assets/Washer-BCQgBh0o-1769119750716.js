import{j as e,S as m,a as Re,s as Le,b as Ke,g as Ie,d as T,L as ie,c as qe}from"./index-CiRwLPeh-1769119750716.js";import{r as d,R as ke}from"./charts-C6jPuoY4-1769119750716.js";import{t as O,O as Ue}from"./native-B9ZlNmpp-1769119750716.js";import{i as l,a as We}from"./LoyaltyProgram-C9XIFcjK-1769119750716.js";import{Camera as es,CameraSource as ss,CameraResultType as ts}from"./index-1bqWgyMR-1769119750716.js";import{q as Se,l as ls,w as Ae,c as re,o as Ee,u as me,d as U,a as _e,g as Pe,s as ne}from"./firebase-Dp89RMPZ-1769119750716.js";import{p as as}from"./dateUtils-BfUzTcZq-1769119750716.js";import"./vendor-COd4auuD-1769119750716.js";const is=({isOpen:t,onClose:x,messages:b,currentUserId:g,chatTitle:n,chatSubtitle:a,onSendMessage:w})=>{const L=d.useRef(null),[k,v]=d.useState("");d.useEffect(()=>{var h;t&&((h=L.current)==null||h.scrollIntoView({behavior:"smooth"}))},[b,t]);const A=h=>{h.preventDefault(),k.trim()&&(w(k),v(""))};return t?e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 flex items-end sm:items-center justify-center p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-surface-dark w-full max-w-md h-[80vh] rounded-2xl border border-white/10 shadow-2xl overflow-hidden flex flex-col animate-in slide-in-from-bottom-10 fade-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-white/10 bg-black/20 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center border border-white/10",children:e.jsx("span",{className:"material-symbols-outlined text-primary",children:"chat"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-sm text-white",children:n}),a&&e.jsxs("p",{className:"text-xs text-green-500 flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500"})," ",a]})]})]}),e.jsx("button",{onClick:x,className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"close"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-background-dark/50",children:[b.length===0?e.jsxs("div",{className:"text-center text-slate-500 mt-10",children:[e.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 opacity-50",children:"chat"}),e.jsx("p",{className:"text-sm",children:"Start the conversation"})]}):b.map(h=>e.jsx("div",{className:`flex ${h.senderId===g?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-2xl px-4 py-3 ${h.senderId===g?"bg-primary text-black rounded-tr-none":"bg-white/10 text-white rounded-tl-none"}`,children:[e.jsx("p",{className:"text-sm",children:h.content}),e.jsx("p",{className:`text-[10px] mt-1 text-right ${h.senderId===g?"text-black/50":"text-slate-400"}`,children:new Date(h.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},h.id)),e.jsx("div",{ref:L})]}),e.jsxs("form",{onSubmit:A,className:"p-4 border-t border-white/10 bg-black/20 flex gap-2",children:[e.jsx("button",{type:"button",className:"p-3 rounded-full bg-white/5 hover:bg-white/10 text-slate-400 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined",children:"add_photo_alternate"})}),e.jsx("input",{type:"text",value:k,onChange:h=>v(h.target.value),placeholder:"Type a message...",className:"flex-1 bg-white/5 border border-white/10 rounded-full px-4 text-sm text-white focus:outline-none focus:border-primary/50 transition-colors"}),e.jsx("button",{type:"submit",disabled:!k.trim(),className:"p-3 rounded-full bg-primary text-black disabled:opacity-50 disabled:cursor-not-allowed hover:bg-primary-dark transition-colors shadow-lg shadow-primary/10",children:e.jsx("span",{className:"material-symbols-outlined",children:"send"})})]})]})}):null},rs=({type:t})=>{const x="#3b82f6";switch(t){case"front":return e.jsx("svg",{viewBox:"0 0 100 100",className:"w-12 h-12",children:e.jsxs("g",{stroke:x,strokeWidth:"1.5",fill:"none",children:[e.jsx("path",{d:"M20,60 L25,45 L30,35 L70,35 L75,45 L80,60 L80,75 L20,75 Z"}),e.jsx("path",{d:"M32,45 L35,35 L65,35 L68,45"}),e.jsx("circle",{cx:"30",cy:"75",r:"8"}),e.jsx("circle",{cx:"70",cy:"75",r:"8"}),e.jsx("rect",{x:"25",y:"58",width:"8",height:"4",rx:"1"}),e.jsx("rect",{x:"67",y:"58",width:"8",height:"4",rx:"1"})]})});case"back":return e.jsx("svg",{viewBox:"0 0 100 100",className:"w-12 h-12",children:e.jsxs("g",{stroke:x,strokeWidth:"1.5",fill:"none",children:[e.jsx("path",{d:"M20,60 L25,45 L30,35 L70,35 L75,45 L80,60 L80,75 L20,75 Z"}),e.jsx("path",{d:"M32,45 L35,35 L65,35 L68,45"}),e.jsx("circle",{cx:"30",cy:"75",r:"8"}),e.jsx("circle",{cx:"70",cy:"75",r:"8"}),e.jsx("rect",{x:"25",y:"58",width:"8",height:"6",rx:"1"}),e.jsx("rect",{x:"67",y:"58",width:"8",height:"6",rx:"1"}),e.jsx("rect",{x:"42",y:"60",width:"16",height:"6",rx:"1"})]})});case"leftSide":return e.jsx("svg",{viewBox:"0 0 100 100",className:"w-12 h-12",children:e.jsxs("g",{stroke:x,strokeWidth:"1.5",fill:"none",children:[e.jsx("path",{d:"M15,65 L20,50 L25,40 L35,35 L55,35 L65,40 L75,45 L85,65 L85,75 L15,75 Z"}),e.jsx("path",{d:"M28,45 L35,38 L50,38 L55,42"}),e.jsx("path",{d:"M58,42 L63,38 L72,42"}),e.jsx("circle",{cx:"30",cy:"75",r:"8"}),e.jsx("circle",{cx:"70",cy:"75",r:"8"}),e.jsx("line",{x1:"52",y1:"42",x2:"52",y2:"75"})]})});case"rightSide":return e.jsx("svg",{viewBox:"0 0 100 100",className:"w-12 h-12",children:e.jsxs("g",{stroke:x,strokeWidth:"1.5",fill:"none",children:[e.jsx("path",{d:"M85,65 L80,50 L75,40 L65,35 L45,35 L35,40 L25,45 L15,65 L15,75 L85,75 Z"}),e.jsx("path",{d:"M72,45 L65,38 L50,38 L45,42"}),e.jsx("path",{d:"M42,42 L37,38 L28,42"}),e.jsx("circle",{cx:"70",cy:"75",r:"8"}),e.jsx("circle",{cx:"30",cy:"75",r:"8"}),e.jsx("line",{x1:"48",y1:"42",x2:"48",y2:"75"})]})});case"interiorFront":return e.jsx("svg",{viewBox:"0 0 100 100",className:"w-12 h-12",children:e.jsxs("g",{stroke:x,strokeWidth:"1.5",fill:"none",children:[e.jsx("rect",{x:"20",y:"45",width:"20",height:"30",rx:"2"}),e.jsx("rect",{x:"20",y:"35",width:"20",height:"12",rx:"2"}),e.jsx("rect",{x:"60",y:"45",width:"20",height:"30",rx:"2"}),e.jsx("rect",{x:"60",y:"35",width:"20",height:"12",rx:"2"}),e.jsx("path",{d:"M15,80 L85,80"}),e.jsx("circle",{cx:"50",cy:"85",r:"3"})]})});case"interiorBack":return e.jsx("svg",{viewBox:"0 0 100 100",className:"w-12 h-12",children:e.jsxs("g",{stroke:x,strokeWidth:"1.5",fill:"none",children:[e.jsx("rect",{x:"15",y:"45",width:"70",height:"30",rx:"2"}),e.jsx("rect",{x:"15",y:"35",width:"70",height:"12",rx:"2"}),e.jsx("line",{x1:"38",y1:"45",x2:"38",y2:"75"}),e.jsx("line",{x1:"62",y1:"45",x2:"62",y2:"75"}),e.jsx("circle",{cx:"27",cy:"30",r:"3"}),e.jsx("circle",{cx:"50",cy:"30",r:"3"}),e.jsx("circle",{cx:"73",cy:"30",r:"3"})]})});default:return null}},ns=[{key:"front",label:"Front View"},{key:"back",label:"Back View"},{key:"leftSide",label:"Left Side"},{key:"rightSide",label:"Right Side"},{key:"interiorFront",label:"Interior Front"},{key:"interiorBack",label:"Interior Back"}],Ce=({onPhotosComplete:t,onCancel:x,mode:b})=>{const[g,n]=d.useState({}),[a,w]=d.useState(null),[L,k]=d.useState("");d.useEffect(()=>{console.log("ðŸ“¸ PhotoCapture: Component mounted, mode:",b)},[b]);const v=async u=>{k(u),console.log("ðŸ“¸ PhotoCapture: Capacitor capture requested for",u);try{const j=await es.getPhoto({quality:60,allowEditing:!1,resultType:ts.DataUrl,source:ss.Camera});j.dataUrl&&(console.log("âœ… PhotoCapture: Image captured successfully"),n(_=>({..._,[u]:j.dataUrl})),w(j.dataUrl),setTimeout(()=>w(null),2e3))}catch(j){console.error("âŒ PhotoCapture: Error capturing image:",j),j.message!=="User cancelled photos app"&&alert("Error capturing image. Please try again.")}},A=()=>{Object.keys(g).length===6&&t(g)},h=Object.keys(g).length,N=h===6;return e.jsxs("div",{className:"fixed inset-0 z-[9999] bg-slate-950 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-white/10 safe-area-top",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:x,className:"text-slate-400 hover:text-white",children:e.jsx("span",{className:"material-symbols-outlined",children:"close"})}),e.jsx("h2",{className:"text-lg font-bold",children:b==="before"?"Before Photos":"After Photos"}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm text-slate-400",children:[h," of 6 photos"]}),e.jsxs("span",{className:"text-sm font-bold text-primary",children:[Math.round(h/6*100),"%"]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"bg-primary h-full transition-all duration-500 ease-out",style:{width:`${h/6*100}%`}})})]})]}),a&&e.jsxs("div",{className:"absolute inset-0 z-50 bg-black flex items-center justify-center animate-in fade-in zoom-in duration-200",children:[e.jsx("img",{src:a,alt:"Preview",className:"max-w-full max-h-full object-contain"}),e.jsxs("div",{className:"absolute top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-full font-bold flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined",children:"check_circle"}),"Photo Saved!"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-blue-400 text-2xl",children:"info"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-blue-400 mb-1",children:"Required Photos"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Take clear photos of all 6 angles. This protects both you and the client."})]})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:ns.map(u=>{const j=g[u.key];return e.jsx("button",{onClick:()=>v(u.key),className:`relative aspect-square rounded-xl border-2 overflow-hidden transition-all ${j?"border-green-500 bg-green-500/10":"border-white/20 bg-white/5 hover:border-primary hover:bg-primary/10"}`,children:j?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:g[u.key],alt:u.label,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"material-symbols-outlined text-white text-3xl",children:"edit"})}),e.jsx("div",{className:"absolute top-2 right-2 bg-green-500 rounded-full p-1",children:e.jsx("span",{className:"material-symbols-outlined text-white text-sm",children:"check"})})]}):e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"mb-2",children:e.jsx(rs,{type:u.key})}),e.jsx("span",{className:"material-symbols-outlined text-primary text-3xl mb-2",children:"photo_camera"}),e.jsx("p",{className:"text-xs font-bold text-center px-2",children:u.label})]})},u.key)})})]})}),e.jsx("div",{className:"p-4 border-t border-white/10 safe-area-bottom",children:e.jsx("button",{onClick:A,disabled:!N,className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${N?"bg-green-500 hover:bg-green-600 text-white":"bg-slate-700 text-slate-500 cursor-not-allowed"}`,children:N?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined",children:"check_circle"}),"Continue (",h,"/6)"]}):e.jsxs("span",{children:["Take All Photos (",h,"/6)"]})})})]})},os=({currentUser:t,navigate:x,updateUserProfile:b,logout:g,showToast:n,openSupport:a})=>{const[w,L]=d.useState("profile"),[k,v]=d.useState(!1),[A,h]=d.useState(!1),[N,u]=d.useState((t==null?void 0:t.name)||""),[j,_]=d.useState((t==null?void 0:t.phone)||""),[C,S]=d.useState((t==null?void 0:t.email)||""),[I,i]=d.useState((t==null?void 0:t.avatar)||""),[E,M]=d.useState(""),[R,F]=d.useState(""),[Y,J]=d.useState(""),[$,Q]=d.useState((t==null?void 0:t.notificationsEnabled)??!0),[G,W]=d.useState((t==null?void 0:t.isAvailable)??!0),[V,ee]=d.useState((t==null?void 0:t.schedule)||[]);d.useEffect(()=>{t&&(u(t.name||""),_(t.phone||""),S(t.email||""),i(t.avatar||""),Q(t.notificationsEnabled??!0),W(t.isAvailable??!0),ee(t.schedule||[]))},[t]);const Z=async f=>{if(!f.target.files||f.target.files.length===0)return;const H=f.target.files[0];h(!0);try{const X=Re(Le,`avatars/${t.id}_${Date.now()}`),de=await Ke(X,H),K=await Ie(de.ref);i(K),await b(t.id,{avatar:K}),n(l.t("photo_updated"),"success")}catch(X){console.error("Error uploading photo:",X),n(X.message||l.t("photo_upload_failed"),"error")}finally{h(!1)}},se=async()=>{v(!0);try{const f={name:N,phone:j};I!==(t==null?void 0:t.avatar)&&(f.avatar=I),await b(t.id,f),n(l.t("profile_updated"),"success")}catch(f){n(f.message||l.t("profile_update_failed"),"error")}finally{v(!1)}},te=async()=>{if(R!==Y){n(l.t("passwords_dont_match"),"error");return}if(R.length<6){n(l.t("password_min_length"),"error");return}v(!0);try{n(l.t("password_changed"),"success"),M(""),F(""),J("")}catch(f){n(f.message||"Failed to change password","error")}finally{v(!1)}},oe=async()=>{const f=!$;Q(f);try{await b(t.id,{notificationsEnabled:f}),n(f?l.t("notifications_enabled"):l.t("notifications_disabled"),"success")}catch{Q(!f),n("Failed to update preferences","error")}},he=async()=>{const f=!G;W(f);try{await b(t.id,{isAvailable:f}),n(f?l.t("availability_on"):l.t("availability_off"),"success")}catch{W(!f),n("Failed to update availability","error")}},be=[l.t("sunday"),l.t("monday"),l.t("tuesday"),l.t("wednesday"),l.t("thursday"),l.t("friday"),l.t("saturday")];return V&&V.length>0||be.map((f,H)=>({day:H,enabled:H!==0&&H!==6,slots:[{start:"08:00",end:"17:00"}]})),e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white",children:[e.jsxs("div",{className:"p-4 border-b border-white/10 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>x(m.WASHER_DASHBOARD),children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"})}),e.jsx("h1",{className:"text-2xl font-bold",children:l.t("settings")})]}),e.jsxs("div",{className:"flex border-b border-white/10",children:[e.jsx("button",{onClick:()=>L("profile"),className:`flex-1 py-4 font-bold transition-colors ${w==="profile"?"text-primary border-b-2 border-primary":"text-slate-400"}`,children:l.t("profile")}),e.jsx("button",{onClick:()=>L("password"),className:`flex-1 py-4 font-bold transition-colors ${w==="password"?"text-primary border-b-2 border-primary":"text-slate-400"}`,children:l.t("password")}),e.jsx("button",{onClick:()=>L("preferences"),className:`flex-1 py-4 font-bold transition-colors ${w==="preferences"?"text-primary border-b-2 border-primary":"text-slate-400"}`,children:l.t("preferences")})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[w==="profile"&&e.jsxs("div",{className:"space-y-6 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4 p-6 bg-surface-dark rounded-xl border border-white/10",children:[e.jsxs("div",{className:"relative w-24 h-24 rounded-full overflow-hidden border-2 border-primary/50 bg-surface-dark",children:[I?e.jsx("img",{src:I,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-primary/20 text-4xl font-bold text-primary",children:N.charAt(0).toUpperCase()}),A&&e.jsx("div",{className:"absolute inset-0 bg-black/70 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-white animate-spin",children:"refresh"})})]}),e.jsxs("label",{className:"px-4 py-2 bg-primary/10 hover:bg-primary/20 border border-primary/30 rounded-lg text-primary font-bold transition-colors cursor-pointer",children:[A?l.t("uploading"):l.t("change_photo"),e.jsx("input",{type:"file",accept:"image/*",onChange:Z,className:"hidden",disabled:A})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase text-slate-400 font-bold mb-2",children:l.t("full_name")}),e.jsx("input",{type:"text",value:N,onChange:f=>u(f.target.value),className:"w-full bg-surface-dark border border-white/10 rounded-xl p-4 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase text-slate-400 font-bold mb-2",children:l.t("email_address")}),e.jsx("input",{type:"email",value:C,disabled:!0,className:"w-full bg-surface-dark/50 border border-white/10 rounded-xl p-4 text-slate-500 cursor-not-allowed"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:l.t("email_warn")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase text-slate-400 font-bold mb-2",children:l.t("phone_number")}),e.jsx("input",{type:"tel",value:j,onChange:f=>_(f.target.value),className:"w-full bg-surface-dark border border-white/10 rounded-xl p-4 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all"})]}),e.jsx("button",{onClick:se,disabled:k,className:"w-full py-4 bg-primary hover:bg-primary-dark text-black font-bold rounded-xl transition-colors disabled:opacity-50",children:k?l.t("loading"):l.t("save_changes")})]}),w==="password"&&e.jsxs("div",{className:"space-y-6 max-w-2xl mx-auto",children:[e.jsx("div",{className:"p-4 bg-blue-500/10 border border-blue-500/30 rounded-xl",children:e.jsxs("p",{className:"text-sm text-blue-400",children:[e.jsx("span",{className:"material-symbols-outlined text-sm mr-2",children:"info"}),"Your password must be at least 6 characters long"]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase text-slate-400 font-bold mb-2",children:l.t("current_password")}),e.jsx("input",{type:"password",value:E,onChange:f=>M(f.target.value),className:"w-full bg-surface-dark border border-white/10 rounded-xl p-4 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase text-slate-400 font-bold mb-2",children:l.t("new_password")}),e.jsx("input",{type:"password",value:R,onChange:f=>F(f.target.value),className:"w-full bg-surface-dark border border-white/10 rounded-xl p-4 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase text-slate-400 font-bold mb-2",children:"Confirm New Password"}),e.jsx("input",{type:"password",value:Y,onChange:f=>J(f.target.value),className:"w-full bg-surface-dark border border-white/10 rounded-xl p-4 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all"})]}),e.jsx("button",{onClick:te,disabled:k||!E||!R||!Y,className:"w-full py-4 bg-primary hover:bg-primary-dark text-black font-bold rounded-xl transition-colors disabled:opacity-50",children:k?l.t("loading"):l.t("change_password")})]}),w==="preferences"&&e.jsxs("div",{className:"space-y-6 max-w-2xl mx-auto",children:[e.jsx("div",{className:"p-6 bg-surface-dark rounded-xl border border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg mb-1",children:l.t("availability_status")}),e.jsx("p",{className:"text-sm text-slate-400",children:G?l.t("avail_on_desc"):l.t("avail_off_desc")})]}),e.jsx("button",{onClick:he,className:`relative w-16 h-8 rounded-full transition-colors ${G?"bg-green-500":"bg-slate-600"}`,children:e.jsx("div",{className:`absolute top-1 left-1 w-6 h-6 bg-white rounded-full transition-transform ${G?"translate-x-8":"translate-x-0"}`})})]})}),e.jsx("div",{className:"p-6 bg-surface-dark rounded-xl border border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg mb-1",children:l.t("push_notifications")}),e.jsx("p",{className:"text-sm text-slate-400",children:l.t("push_desc")})]}),e.jsx("button",{onClick:oe,className:`relative w-16 h-8 rounded-full transition-colors ${$?"bg-primary":"bg-slate-600"}`,children:e.jsx("div",{className:`absolute top-1 left-1 w-6 h-6 bg-white rounded-full transition-transform ${$?"translate-x-8":"translate-x-0"}`})})]})}),e.jsxs("div",{className:"p-6 bg-surface-dark rounded-xl border border-white/10",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:l.t("your_stats")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-white/5 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:"0"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:l.t("jobs_completed")})]}),e.jsxs("div",{className:"text-center p-4 bg-white/5 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-green-400",children:"$0"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:l.t("total_earned")})]}),e.jsxs("div",{className:"text-center p-4 bg-white/5 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-400",children:"5.0"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:l.t("avg_rating")})]}),e.jsxs("div",{className:"text-center p-4 bg-white/5 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-400",children:"0"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:l.t("active_jobs")})]})]})]}),a&&e.jsxs("button",{onClick:a,className:"w-full py-4 bg-blue-500/10 hover:bg-blue-500/20 border border-blue-500/30 text-blue-400 font-bold rounded-xl transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined",children:"support_agent"}),l.t("contact_support")]}),e.jsxs("button",{onClick:()=>{window.confirm(l.t("logout_confirm"))&&g()},className:"w-full py-4 bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 text-red-400 font-bold rounded-xl transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"logout"}),l.t("logout")]})]})]})]})},ds=({orders:t,navigate:x,onGrabOrder:b})=>{const g=t.filter(n=>n.status==="Pending");return e.jsxs("div",{className:"flex flex-col h-full bg-background-dark text-white",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 border-b border-white/10 bg-surface-dark",children:[e.jsx("button",{onClick:()=>x(m.WASHER_DASHBOARD),className:"w-10 h-10 rounded-full bg-white/5 flex items-center justify-center hover:bg-white/10 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back_ios_new"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("h1",{className:"font-bold text-xl",children:"Available Orders"}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:[g.length," orders waiting"]})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-[#3b82f6]/20 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-[#3b82f6]",children:"notifications_active"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:g.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-white/5 flex items-center justify-center mb-4",children:e.jsx("span",{className:"material-symbols-outlined text-6xl text-slate-600",children:"inbox"})}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:"No orders available"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"New orders will appear here"})]}):g.map(n=>e.jsxs("div",{className:"bg-surface-dark rounded-xl p-4 border border-white/10 hover:border-[#3b82f6]/50 transition-all cursor-pointer",onClick:()=>{x(m.WASHER_JOB_DETAILS,n.id)},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"material-symbols-outlined text-[#3b82f6] text-sm",children:"person"}),e.jsx("p",{className:"font-bold",children:typeof n.clientName=="string"?n.clientName:"Client"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"schedule"}),e.jsxs("span",{children:[typeof n.date=="string"?n.date:"Date TBD"," - ",typeof n.time=="string"?n.time:"Time TBD"]})]})]}),e.jsx("div",{className:"px-3 py-1 bg-[#3b82f6]/20 text-[#3b82f6] text-xs font-bold rounded-full border border-[#3b82f6]/30",children:"NEW"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-sm",children:[e.jsx("span",{className:"material-symbols-outlined text-blue-400 text-sm",children:"local_car_wash"}),e.jsx("span",{className:"text-slate-300",children:typeof n.service=="string"?n.service:"Service"}),e.jsx("span",{className:"text-slate-600",children:"â€¢"}),e.jsx("span",{className:"text-slate-300",children:typeof n.vehicle=="string"?n.vehicle:"Vehicle"})]}),e.jsxs("div",{className:"flex items-start gap-2 mb-4 p-3 bg-black/20 rounded-lg",children:[e.jsx("span",{className:"material-symbols-outlined text-blue-400 text-sm mt-0.5",children:"location_on"}),e.jsx("p",{className:"text-sm text-slate-300 flex-1",children:typeof n.address=="string"?n.address:"Address not available"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Total Payout"}),e.jsxs("p",{className:"text-2xl font-bold text-[#3b82f6]",children:["$",n.price]})]}),e.jsxs("button",{onClick:a=>{a.stopPropagation(),b(n.id)},className:"px-6 py-3 bg-[#3b82f6] text-white font-bold rounded-xl hover:brightness-90 transition-colors flex items-center gap-2 shadow-blue",children:[e.jsx("span",{className:"material-symbols-outlined",children:"check_circle"}),"Grab"]})]})]},n.id))})]})},cs=({onClick:t,unreadCount:x})=>{const[b,g]=d.useState({x:window.innerWidth-80,y:window.innerHeight-150}),[n,a]=d.useState(!1),[w,L]=d.useState({x:0,y:0}),k=ke.useRef(null),v=ke.useRef(!1);d.useEffect(()=>{const h=u=>{if(!n)return;v.current=!0;const j="touches"in u?u.touches[0].clientX:u.clientX,_="touches"in u?u.touches[0].clientY:u.clientY;let C=j-w.x,S=_-w.y;const I=window.innerWidth-60,i=window.innerHeight-60;C=Math.max(10,Math.min(C,I)),S=Math.max(10,Math.min(S,i)),g({x:C,y:S})},N=()=>{a(!1)};return n&&(window.addEventListener("mousemove",h),window.addEventListener("mouseup",N),window.addEventListener("touchmove",h),window.addEventListener("touchend",N)),()=>{window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",N),window.removeEventListener("touchmove",h),window.removeEventListener("touchend",N)}},[n,w]);const A=h=>{if("button"in h&&h.button!==0)return;v.current=!1;const N="touches"in h?h.touches[0].clientX:h.clientX,u="touches"in h?h.touches[0].clientY:h.clientY;L({x:N-b.x,y:u-b.y}),a(!0)};return e.jsxs("button",{ref:k,onMouseDown:A,onTouchStart:A,onClick:h=>{v.current||t()},style:{left:b.x,top:b.y,touchAction:"none"},className:`fixed z-[70] w-14 h-14 rounded-full bg-primary text-white shadow-blue flex items-center justify-center transition-transform hover:scale-105 active:scale-95 ${n?"cursor-grabbing":"cursor-grab"}`,children:[e.jsx("span",{className:"material-symbols-outlined text-2xl",children:"chat"}),x>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center border-2 border-slate-900",children:x})]})},xs=({screen:t,navigate:x,orders:b,updateOrder:g,currentWasherId:n,currentWasher:a,updateWasherProfile:w,supportPhone:L,notifications:k,addNotification:v,logout:A,messages:h,sendMessage:N,packages:u,addons:j,openSupport:_,grabOrder:C,showToast:S,initialOrderId:I})=>{var fe,pe,ge,je;const[i,E]=d.useState(null),[M,R]=d.useState(!1),F=async(s,o,c)=>{const r={};for(const[y,D]of Object.entries(o)){if(D.startsWith("http")){r[y]=D;continue}const p=Re(Le,`orders/${s}/${c}_${y}_${Date.now()}.jpg`);await qe(p,D,"data_url"),r[y]=await Ie(p)}return r};d.useEffect(()=>{if(I){const s=b.find(o=>o.id===I);s&&(console.log("ðŸ”— Deep Link: Selecting order",I),E(s))}},[I,b]),d.useEffect(()=>{if(i&&t===m.WASHER_JOB_DETAILS){const s=b.find(o=>o.id===i.id);if(!s){S("This order has been removed.","error"),x(m.WASHER_ORDER_QUEUE);return}if(s.status==="Cancelled"&&i.status!=="Cancelled"){S("Sorry, the client cancelled this order.","info"),x(m.WASHER_ORDER_QUEUE);return}if(s.washerId&&s.washerId!==n&&!i.washerId){S("Sorry, another washer already took this order.","warning"),x(m.WASHER_ORDER_QUEUE);return}JSON.stringify(s)!==JSON.stringify(i)&&E(s)}},[b,i,n,t]);const[Y,J]=d.useState(!1),[$,Q]=d.useState("15"),[G,W]=d.useState(!1),[V,ee]=d.useState(!1),[Z,se]=d.useState(!1),[te,oe]=d.useState([]),[he,be]=d.useState([]);d.useEffect(()=>{(async()=>{try{const o=U(T,"settings","financials"),c=await Pe(o);c.exists()&&c.data().globalFees&&oe(c.data().globalFees)}catch(o){console.error("Error loading global fees:",o)}})()},[]);const[f,H]=d.useState(0);d.useEffect(()=>{const s=setInterval(()=>H(o=>o+1),1e3);return()=>clearInterval(s)},[]);const[X,de]=d.useState(0),[K,Oe]=d.useState(new Set);d.useEffect(()=>{const s=b.filter(c=>c.washerId===n),o=s.filter(c=>c.status==="Assigned"&&!K.has(c.id));o.length>0&&(o.forEach(c=>{console.log("ðŸ”” NEW ORDER ASSIGNED:",c.id,c.service);try{const r=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGWi77eafTRALUKfj8LZjHAU4ktjyzHksBSR3x/DdkEAKFF606+uoVRQKRp/g8r5sIQYsgc7y2Yk2CBlou+3mn00QC1Cn4/C2YxwFOJLY8sx5LAUkd8fw3ZBBChRetevrqFUUCkaf4PK+bCEGLIHO8tmJNggZaLvt5p9NEAtQp+PwtmMcBTiS2PLMeSwFJHfH8N2QQQoUXrXr66hVFApGn+DyvmwhBiyBzvLZiTYIGWi77eafTRALUKfj8LZjHAU4ktjyzHksBSR3x/DdkEEKFF616+uoVRQKRp/g8r5sIQYsgc7y2Yk2CBlou+3mn00QC1Cn4/C2YxwFOJLY8sx5LAUkd8fw3ZBBChRetevrqFUUCkaf4PK+bCEGLIHO8tmJNggZaLvt5p9NEAtQp+PwtmMcBTiS2PLMeSwFJHfH8N2QQQoUXrXr66hVFApGn+DyvmwhBiyBzvLZiTYIGWi77eafTRALUKfj8LZjHAU4ktjyzHksBSR3x/DdkEEKFF616+uoVRQKRp/g8r5sIQYsgc7y2Yk2CBlou+3mn00QC1Cn4/C2Yx");r.volume=.5,r.play().catch(y=>console.log("Audio play failed:",y))}catch(r){console.log("Audio creation failed:",r)}typeof window<"u"&&window.showToast&&window.showToast(`ðŸš— New Order: ${c.service} - ${c.vehicle}`,"success")}),Oe(c=>{const r=new Set(c);return o.forEach(y=>r.add(y.id)),r})),de(s.length)},[b,n,K]);const[He,le]=d.useState(!1),[Be,De]=d.useState("before"),[ms,hs]=d.useState(""),[bs,Te]=d.useState({}),[us,Fe]=d.useState({}),[fs,$e]=d.useState(null),[Me,ae]=d.useState(!1),P=b.find(s=>s.washerId===n&&["Assigned","En Route","Arrived","In Progress"].includes(s.status)),Je=(P?h.filter(s=>s.orderId===P.id).sort((s,o)=>s.timestamp-o.timestamp):[]).filter(s=>s.receiverId===n&&!s.read).length;k.filter(s=>!s.read&&s.userId===n).length;const[gs,js]=d.useState(null);d.useEffect(()=>{P&&P.status==="En Route"&&console.log("ðŸ”„ WASHER: Job is En Route. Tracking should be active via global LocationTracker.")},[P==null?void 0:P.id]);const Qe=async()=>{var o,c;if(!i)return;O();let s="15";if((o=i==null?void 0:i.location)!=null&&o.lat&&((c=i==null?void 0:i.location)!=null&&c.lng))try{const r=await ie.getCurrentLocation(),{duration:y}=await ie.getRouteETA(r.lat,r.lng,i.location.lat,i.location.lng);s=y.toString(),console.log("ðŸ“ Calculated ETA from Google Maps:",s,"minutes")}catch(r){console.warn("âš ï¸ Failed to calculate ETA, using default:",r)}console.log("ðŸš— Setting order to En Route:",i.id,"ETA:",s),g(i.id,{status:"En Route",estimatedArrival:s}),console.log("ðŸ“¡ [WASHER] Status changed to En Route. Global tracker will take over."),console.log("âœ… Order status updated to En Route"),O()},ze=async()=>{i&&$?(console.log("ðŸš— Setting order to En Route:",i.id,"ETA:",$),g(i.id,{status:"En Route",estimatedArrival:`${$} min`}),console.log("âœ… Order status updated to En Route"),J(!1),Q("15"),O(),x(m.WASHER_JOBS)):console.error("âŒ Cannot submit ETA - missing selectedJob or etaMinutes")},Ye=async s=>{try{s.read||await me(U(T,"notifications",s.id),{read:!0})}catch(o){console.error("Error marking notification as read:",o)}if(s.relatedId&&s.linkTo)if(s.linkTo===m.WASHER_JOB_DETAILS){const o=s.relatedId,c=b.find(r=>r.id===o);c?c.washerId&&c.washerId!==n?(alert("Sorry, this order has already been assigned to another washer."),x(m.WASHER_ORDER_QUEUE)):(E(c),x(m.WASHER_JOB_DETAILS)):(alert("Sorry, this order is no longer available."),x(m.WASHER_ORDER_QUEUE))}else x(s.linkTo);ee(!1)},Ge=()=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/80 flex items-start justify-end p-4",children:e.jsxs("div",{className:"bg-surface-dark w-full max-w-sm rounded-2xl border border-white/10 shadow-2xl overflow-hidden mt-16",children:[e.jsxs("div",{className:"p-4 border-b border-white/5 flex justify-between items-center bg-black/20",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Notifications"}),e.jsx("button",{onClick:()=>ee(!1),className:"p-1 hover:bg-white/10 rounded-full transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"close"})})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:k.filter(s=>s.userId===n||s.userId==="washer-broadcast").length===0?e.jsxs("div",{className:"p-8 text-center text-slate-500",children:[e.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 opacity-50",children:"notifications_off"}),e.jsx("p",{children:"No notifications yet"})]}):k.filter(s=>s.userId===n||s.userId==="washer-broadcast").sort((s,o)=>o.timestamp-s.timestamp).map(s=>e.jsx("div",{onClick:()=>Ye(s),className:`p-4 border-b border-white/5 hover:bg-white/5 transition-colors cursor-pointer ${s.read?"":"bg-primary/5"}`,children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${s.type==="success"?"bg-green-500/20 text-green-500":s.type==="warning"?"bg-amber-500/20 text-amber-500":s.type==="error"?"bg-red-500/20 text-red-500":"bg-blue-500/20 text-blue-500"}`,children:e.jsx("span",{className:"material-symbols-outlined text-xl",children:s.type==="success"?"check_circle":s.type==="warning"?"warning":s.type==="error"?"error":"info"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-bold text-sm mb-1 ${s.read?"text-slate-300":"text-white"}`,children:s.title}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed mb-2",children:s.message}),e.jsx("p",{className:"text-[10px] text-slate-500",children:new Date(s.timestamp).toLocaleString()})]}),!s.read&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary mt-2"})]})},s.id))})]})}),ce=b.find(s=>s.washerId===n&&s.status==="Completed"&&s.completedAt&&Date.now()-s.completedAt<600*1e3&&!s.clientRating),ue=s=>{const o=te.reduce((c,r)=>c+(r.percentage||0),0);return s.reduce((c,r)=>{let y=0;r.vehicleConfigs&&r.vehicleConfigs.length>0?r.vehicleConfigs.forEach(z=>{var we;const Ne=u.find(xe=>xe.id===z.packageId);Ne&&z.vehicleType&&(y+=((we=Ne.price)==null?void 0:we[z.vehicleType])||0),z.addonIds&&z.addonIds.forEach(xe=>{var ye;const ve=j.find(Xe=>Xe.id===xe);ve&&(y+=((ye=ve.price)==null?void 0:ye[z.vehicleType])||0)})}):y+=r.price||0;const D=y*o/100,p=y-D,Ze=r.tip||0;return c+p+Ze},0)};let B=null;if(ce){const s=Math.max(0,6e5-(Date.now()-(ce.completedAt||0))),o=Math.floor(s/6e4),c=Math.floor(s%6e4/1e3);B=e.jsxs("div",{className:"flex flex-col h-full bg-background-dark p-6 overflow-hidden relative",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-green-500/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 h-64 bg-blue-500/5 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center relative z-10",children:[e.jsxs("div",{className:"relative mb-8",children:[e.jsx("div",{className:"absolute inset-0 bg-green-500/10 rounded-full blur-xl"}),e.jsx("div",{className:"relative w-32 h-32 rounded-full bg-surface-dark border-2 border-green-500/50 flex items-center justify-center shadow-lg shadow-green-500/20",children:e.jsx("span",{className:"material-symbols-outlined text-7xl text-green-500",children:"check_circle"})})]}),e.jsx("h1",{className:"text-3xl font-bold mb-2 text-white text-center",children:l.t("excellent_work")}),e.jsx("p",{className:"text-slate-300 text-lg mb-8 text-center max-w-xs",children:l.t("service_completed_success")}),e.jsxs("div",{className:"bg-surface-dark border border-white/10 rounded-2xl p-6 w-full max-w-sm mb-8 backdrop-blur-sm",children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase font-bold text-center mb-2",children:l.t("time_left_rating")}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsxs("div",{className:"bg-black/30 rounded-lg p-3 min-w-[60px] text-center border border-white/5",children:[e.jsx("span",{className:"text-3xl font-mono font-bold text-white",children:o}),e.jsx("p",{className:"text-[10px] text-slate-500",children:l.t("min")})]}),e.jsx("span",{className:"text-2xl font-bold text-slate-600",children:":"}),e.jsxs("div",{className:"bg-black/30 rounded-lg p-3 min-w-[60px] text-center border border-white/5",children:[e.jsx("span",{className:"text-3xl font-mono font-bold text-white",children:c.toString().padStart(2,"0")}),e.jsx("p",{className:"text-[10px] text-slate-500",children:l.t("sec")})]})]}),e.jsx("div",{className:"w-full bg-black/50 h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-emerald-500 transition-all duration-1000",style:{width:`${Math.max(0,s/(600*1e3)*100)}%`}})}),e.jsxs("p",{className:"text-xs text-slate-500 text-center mt-3",children:[l.t("wait_client_confirm"),e.jsx("br",{}),l.t("time_expires_continue")]})]}),e.jsxs("div",{className:"w-full max-w-sm",children:[e.jsx("button",{onClick:()=>{O(),s<=0&&x(m.WASHER_JOBS)},disabled:s>0,className:`w-full py-4 rounded-xl font-bold flex items-center justify-center gap-2 transition-all ${s<=0?"bg-white text-black hover:bg-slate-200 shadow-lg shadow-white/10":"bg-surface-dark text-slate-500 border border-white/5 cursor-not-allowed"}`,children:s<=0?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Continue"}),e.jsx("span",{className:"material-symbols-outlined",children:"arrow_forward"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-symbols-outlined animate-spin",children:"sync"}),e.jsx("span",{children:"Waiting for Confirmation..."})]})}),e.jsxs("button",{onClick:()=>x(m.WASHER_JOBS),className:"w-full mt-3 py-3 rounded-xl border border-white/10 text-slate-400 font-bold hover:bg-white/5 transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"}),"Back"]}),e.jsxs("p",{className:"text-center text-xs text-slate-600 mt-4",children:["Order #",ce.id]})]})]})]})}const q=()=>e.jsxs("nav",{className:"absolute bottom-0 w-full bg-slate-900/80 backdrop-blur-xl border-t border-white/10 px-6 py-4 flex justify-around shadow-2xl z-20",children:[e.jsxs("button",{onClick:()=>{O(5),x(m.WASHER_DASHBOARD)},className:`flex flex-col items-center gap-1.5 transition-all active:scale-95 ${t===m.WASHER_DASHBOARD?"text-primary":"text-slate-400"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center transition-colors ${t===m.WASHER_DASHBOARD?"bg-primary/20 border border-primary/30":"bg-white/5 hover:bg-white/10"}`,children:e.jsx("span",{className:"material-symbols-outlined",children:"dashboard"})}),e.jsx("span",{className:`text-xs ${t===m.WASHER_DASHBOARD?"font-bold":""}`,children:"Dashboard"})]}),e.jsxs("button",{onClick:()=>{O(5),x(m.WASHER_JOBS)},className:`flex flex-col items-center gap-1.5 transition-all active:scale-95 ${t===m.WASHER_JOBS?"text-primary":"text-slate-400"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center transition-colors ${t===m.WASHER_JOBS?"bg-primary/20 border border-primary/30":"bg-white/5 hover:bg-white/10"}`,children:e.jsx("span",{className:"material-symbols-outlined",children:"work"})}),e.jsx("span",{className:`text-xs ${t===m.WASHER_JOBS?"font-bold":""}`,children:l.t("my_jobs")})]}),e.jsxs("button",{onClick:()=>{O(5),x(m.WASHER_EARNINGS)},className:`flex flex-col items-center gap-1.5 transition-all active:scale-95 ${t===m.WASHER_EARNINGS?"text-primary":"text-slate-400"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center transition-colors ${t===m.WASHER_EARNINGS?"bg-primary/20 border border-primary/30":"bg-white/5 hover:bg-white/10"}`,children:e.jsx("span",{className:"material-symbols-outlined",children:"payments"})}),e.jsx("span",{className:`text-xs ${t===m.WASHER_EARNINGS?"font-bold":""}`,children:l.t("earnings")})]}),e.jsxs("button",{onClick:()=>{O(5),x(m.WASHER_PROFILE)},className:`flex flex-col items-center gap-1.5 transition-all active:scale-95 ${t===m.WASHER_PROFILE?"text-primary":"text-slate-400"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center transition-colors ${t===m.WASHER_PROFILE?"bg-primary/20 border border-primary/30":"bg-white/5 hover:bg-white/10"}`,children:e.jsx("span",{className:"material-symbols-outlined",children:"person"})}),e.jsx("span",{className:`text-xs ${t===m.WASHER_PROFILE?"font-bold":""}`,children:l.t("profile")})]})]}),Ve=async s=>{try{await C(s,n,(a==null?void 0:a.name)||"Washer",a==null?void 0:a.avatar);const o=b.find(c=>c.id===s);o&&E({...o,status:"Assigned",washerId:n,washerName:a==null?void 0:a.name}),x(m.WASHER_JOB_DETAILS),S("Order Assigned! You have successfully grabbed the order","success")}catch(o){console.error("Error grabbing order:",o),o.message==="Order already taken"?(S("Sorry, another washer already took this order.","error"),t===m.WASHER_JOB_DETAILS&&x(m.WASHER_ORDER_QUEUE)):S("Could not grab order. Please try again.","error")}};if(t===m.WASHER_DASHBOARD){const s=b.filter(p=>p.washerId===n&&p.status!=="Completed"&&p.status!=="Cancelled"),o=b.filter(p=>p.status==="Pending"&&!p.washerId),c=b.filter(p=>p.washerId===n&&p.status==="Completed"),r=new Date,y=new Date(r);y.setDate(r.getDate()-r.getDay());const D=ue(c.filter(p=>as(p.date)>=y));B=e.jsxs("div",{className:"flex flex-col h-full bg-slate-950 text-white relative overflow-hidden",children:[V&&e.jsx(Ge,{}),e.jsxs("div",{className:"flex-1 overflow-y-auto pb-24 relative z-10",children:[e.jsx("div",{className:"bg-slate-900 border-b border-white/10 p-6 mb-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-primary/30 rounded-full blur-lg"}),e.jsx("div",{className:"relative w-16 h-16 rounded-full overflow-hidden bg-surface-dark border-2 border-white/10 shadow-xl",children:a!=null&&a.avatar?e.jsx("img",{src:a.avatar,alt:a.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-white/5",children:e.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-400",children:"person"})})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"Hello,"}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:((fe=a==null?void 0:a.name)==null?void 0:fe.split(" ")[0])||"Washer"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-amber-500/20 px-3 py-1 rounded-full border border-amber-500/30",children:[e.jsx("span",{className:"material-symbols-outlined text-amber-400 text-sm",children:"star"}),e.jsx("span",{className:"text-sm font-bold text-amber-400",children:typeof(a==null?void 0:a.rating)=="number"?a.rating.toFixed(1):"5.0"})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:["(",(a==null?void 0:a.completedJobs)||0," jobs)"]})]})]})]}),e.jsx("div",{className:"flex flex-col items-end gap-3",children:e.jsx("div",{className:`px-4 py-1.5 rounded-full text-xs font-bold border backdrop-blur-sm ${(a==null?void 0:a.status)==="Active"?"bg-green-500/10 text-green-400 border-green-500/20":"bg-slate-500/10 text-slate-400 border-slate-500/20"}`,children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${(a==null?void 0:a.status)==="Active"?"bg-green-400":"bg-slate-400"}`}),(a==null?void 0:a.status)==="Active"?"Online":"Offline"]})})})]})}),e.jsx("div",{className:"px-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{onClick:()=>x(m.WASHER_JOBS),className:"group relative overflow-hidden rounded-2xl bg-blue-900 border border-blue-700/30 p-5 hover:bg-blue-800 transition-all cursor-pointer shadow-xl",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center mb-3",children:e.jsx("span",{className:"material-symbols-outlined text-white text-2xl font-bold",children:"pending_actions"})}),e.jsx("p",{className:"text-3xl font-bold mb-1 text-white",children:s.length}),e.jsx("p",{className:"text-[10px] text-white/80 font-bold uppercase tracking-widest",children:"ACTIVE JOBS"})]})}),e.jsx("div",{onClick:()=>x(m.WASHER_EARNINGS),className:"group relative overflow-hidden rounded-2xl bg-emerald-900 border border-emerald-700/30 p-5 hover:bg-emerald-800 transition-all cursor-pointer shadow-xl",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center mb-3",children:e.jsx("span",{className:"material-symbols-outlined text-white text-2xl font-bold",children:"payments"})}),e.jsxs("p",{className:"text-3xl font-bold mb-1 text-white",children:["$",D.toFixed(0)]}),e.jsx("p",{className:"text-[10px] text-white/80 font-bold uppercase tracking-widest",children:l.t("this_week")})]})})]})}),s.length>0&&e.jsx("div",{className:"px-6 mb-6",children:e.jsx("div",{className:"space-y-3",children:s.slice(0,2).map(p=>e.jsx("button",{onClick:()=>{E(p),x(m.WASHER_JOB_DETAILS)},className:"w-full bg-gradient-to-br from-white/5 to-white/0 backdrop-blur-sm rounded-2xl p-4 border border-white/10 hover:border-primary/50 transition-all text-left group",children:e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-lg text-white group-hover:text-primary transition-colors",children:p.clientName}),e.jsx("p",{className:"text-sm text-slate-400",children:p.vehicle})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${p.status==="In Progress"?"bg-primary/20 text-primary border border-primary/30":"bg-amber-500/20 text-amber-400 border border-amber-500/30"}`,children:p.status==="Assigned"?l.t("assigned"):p.status==="En Route"?l.t("en_route"):p.status==="Arrived"?l.t("arrived"):p.status==="In Progress"?l.t("in_progress"):p.status})]})},p.id))})}),e.jsx("div",{className:"px-6 mb-6",children:e.jsx("button",{onClick:()=>x(m.WASHER_ORDER_QUEUE),className:"w-full bg-gradient-to-r from-primary/80 to-emerald-800 rounded-2xl p-5 hover:opacity-90 transition-all shadow-xl border border-white/10 group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-white/20 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-white text-3xl",children:"inbox"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-white font-bold text-lg mb-1",children:"Available Orders"}),e.jsxs("p",{className:"text-white/80 text-sm",children:[o.length," orders waiting"]})]})]}),e.jsx("span",{className:"material-symbols-outlined text-white text-2xl group-hover:translate-x-1 transition-transform",children:"arrow_forward"})]})})}),s.length===0&&e.jsx("div",{className:"px-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-white/5 to-white/0 backdrop-blur-sm rounded-2xl border border-white/10 p-8 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-blue-500/20 flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"material-symbols-outlined text-5xl text-primary/50",children:"work_outline"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:l.t("no_active_jobs")}),e.jsx("p",{className:"text-slate-400 text-sm",children:l.t("no_assigned_jobs")})]})})]}),e.jsx(q,{})]})}else if(t===m.WASHER_ORDER_QUEUE)B=e.jsx(ds,{orders:b,navigate:(s,o)=>{o&&E(b.find(c=>c.id===o)||null),x(s)},onGrabOrder:Ve});else if(t===m.WASHER_JOBS){const s=b.filter(r=>r.washerId===n),o=s.filter(r=>["Assigned","En Route","Arrived","In Progress"].includes(r.status)),c=s.filter(r=>r.status==="Completed");B=e.jsxs("div",{className:"flex flex-col h-full bg-slate-950 text-white relative",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-primary/10 rounded-full blur-3xl opacity-50"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl opacity-50"})]}),e.jsxs("header",{className:"px-6 py-6 border-b border-white/10 bg-white/5 backdrop-blur-md relative z-10",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-white to-primary/80 bg-clip-text text-transparent",children:l.t("my_jobs")}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:l.t("my_jobs_desc")})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto relative z-10 pb-24",children:[e.jsxs("div",{className:"px-4 py-4 grid grid-cols-2 gap-3",children:[e.jsx("div",{className:"bg-surface-dark rounded-xl p-4 border border-white/5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-primary",children:"pending_actions"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:o.length}),e.jsx("p",{className:"text-xs text-slate-400",children:l.t("active_jobs")})]})]})}),e.jsx("div",{className:"bg-surface-dark rounded-xl p-4 border border-white/5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-green-400",children:"task_alt"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:c.length}),e.jsx("p",{className:"text-xs text-slate-400",children:l.t("completed")})]})]})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-24",children:[o.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-sm font-bold text-slate-400 uppercase mb-3",children:l.t("active_jobs")}),e.jsx("div",{className:"space-y-3",children:o.map(r=>e.jsxs("button",{onClick:()=>{E(r),x(m.WASHER_JOB_DETAILS)},className:"w-full bg-surface-dark rounded-xl p-4 border border-white/5 hover:border-primary/50 transition-all text-left",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-lg",children:r.clientName}),e.jsx("p",{className:"text-sm text-slate-400",children:r.vehicle})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${r.status==="In Progress"?"bg-primary/20 text-primary":"bg-amber-500/20 text-amber-400"}`,children:r.status==="Assigned"?l.t("assigned"):r.status==="En Route"?l.t("en_route"):r.status==="Arrived"?l.t("arrived"):r.status==="In Progress"?l.t("in_progress"):r.status})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"local_car_wash"}),e.jsx("span",{children:r.service})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"schedule"}),e.jsx("span",{children:r.time})]})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-slate-400",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"location_on"}),e.jsx("span",{className:"truncate",children:r.address})]})]},r.id))})]}),c.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold text-slate-400 uppercase mb-3",children:l.t("completed_jobs")}),e.jsx("div",{className:"space-y-3",children:c.map(r=>e.jsxs("button",{onClick:()=>{E(r),x(m.WASHER_JOB_DETAILS)},className:"w-full bg-surface-dark rounded-xl p-4 border border-white/5 hover:border-white/10 transition-all text-left opacity-75",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:r.clientName}),e.jsx("p",{className:"text-sm text-slate-400",children:r.vehicle})]}),e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-400",children:l.t("completed")})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"payments"}),e.jsxs("span",{children:["$",r.price.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"event"}),e.jsx("span",{children:r.date})]})]})]},r.id))})]}),s.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center px-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-white/5 flex items-center justify-center mb-4",children:e.jsx("span",{className:"material-symbols-outlined text-4xl text-slate-600",children:"work_outline"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"No Jobs Yet"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"You have no assigned jobs at the moment. Check back later!"})]})]})]}),e.jsx(q,{})]})}else if(t===m.WASHER_JOB_DETAILS&&i)B=e.jsxs("div",{className:"flex flex-col h-full bg-slate-950 text-white relative z-0",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden z-0",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-primary/10 rounded-full blur-3xl opacity-50"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl opacity-50"})]}),e.jsxs("header",{className:"px-6 py-4 border-b border-white/10 bg-slate-900/50 backdrop-blur-md relative z-10 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>x(m.WASHER_JOBS),className:"w-10 h-10 rounded-full flex items-center justify-center hover:bg-white/10 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-white",children:"Job Details"}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Order #",((pe=i.displayId)==null?void 0:pe.replace(/^#/,""))||i.id]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto relative z-10 pb-24 p-6",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:`px-4 py-1.5 rounded-full border flex items-center gap-2 ${i.status==="In Progress"?"bg-primary/20 border-primary/50 text-primary":i.status==="Arrived"?"bg-green-500/20 border-green-500/50 text-green-400":"bg-slate-700/50 border-slate-600 text-slate-300"}`,children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-current animate-pulse"}),e.jsx("span",{className:"text-sm font-bold uppercase tracking-wide",children:i.status==="Assigned"?l.t("assigned"):i.status==="En Route"?l.t("en_route"):i.status==="Arrived"?l.t("arrived"):i.status==="In Progress"?l.t("in_progress"):i.status})]})}),e.jsx("div",{className:"bg-surface-dark rounded-2xl p-5 border border-white/10 mb-4 shadow-lg relative overflow-hidden",children:e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 font-bold uppercase tracking-widest mb-1",children:"Client"}),e.jsx("h2",{className:"text-xl font-bold text-white",children:i.clientName})]})}),e.jsx("div",{className:"bg-black/20 p-3 rounded-xl border border-white/5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-primary mt-0.5",children:"location_on"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-slate-300 leading-relaxed mb-2",children:i.address}),e.jsxs("button",{onClick:()=>{var s,o;return window.open(`https://www.google.com/maps/dir/?api=1&destination=${(s=i.location)==null?void 0:s.lat},${(o=i.location)==null?void 0:o.lng}`,"_blank")},className:"text-xs text-primary font-bold flex items-center gap-1 hover:underline",children:[e.jsx("span",{className:"material-symbols-outlined text-[14px]",children:"map"}),"OPEN NAVIGATION"]})]})]})})]})}),e.jsxs("div",{className:"bg-surface-dark rounded-2xl p-5 border border-white/10 mb-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 border-b border-white/5 pb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:i.vehicle}),e.jsx("span",{className:"px-2 py-0.5 rounded bg-white/10 text-xs font-mono text-slate-300",children:i.vehicleType})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-slate-400 uppercase",children:"Price"}),e.jsxs("p",{className:"text-xl font-black text-green-400",children:["$",i.price]})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Package"}),e.jsx("span",{className:"font-bold text-white",children:i.service})]})]}),e.jsxs("div",{className:"space-y-4",children:[i.status==="Assigned"&&e.jsxs("button",{onClick:Qe,className:"w-full py-4 rounded-xl font-bold bg-primary text-white hover:bg-primary-dark transition-all shadow-blue flex items-center justify-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined",children:"directions_car"}),"I'M EN ROUTE"]}),i.status==="En Route"&&e.jsxs("button",{onClick:()=>{O(),g(i.id,{status:"Arrived",arrivedAt:Date.now()}),$e(Date.now()),ie.stopTracking()},className:"w-full py-4 rounded-xl font-bold bg-[#3b82f6] text-white hover:brightness-90 transition-all shadow-blue-lg flex items-center justify-center gap-2 animate-pulse",children:[e.jsx("span",{className:"material-symbols-outlined",children:"location_on"}),"I HAVE ARRIVED"]}),i.status==="Arrived"&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500 space-y-3",children:[i.clientAuthorized?e.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-4 flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-green-400 text-2xl",children:"verified_user"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-green-400",children:"Authorized!"}),e.jsx("p",{className:"text-xs text-slate-300",children:"You can start the wash."})]})]}):e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-500/20 rounded-full flex items-center justify-center mx-auto mb-2 animate-pulse",children:e.jsx("span",{className:"material-symbols-outlined text-amber-500",children:"lock_clock"})}),e.jsx("p",{className:"font-bold text-amber-500 mb-1",children:"Waiting for Authorization"}),e.jsx("p",{className:"text-xs text-slate-400",children:'Client must tap "Authorize Start".'})]}),e.jsxs("button",{onClick:()=>{O(),Fe({}),ae(!0)},disabled:!i.clientAuthorized,className:`w-full py-4 rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-lg ${i.clientAuthorized?"bg-[#3b82f6] text-white hover:scale-[1.02] shadow-blue":"bg-slate-800 text-slate-500 cursor-not-allowed border border-white/5"}`,children:[e.jsx("span",{className:"material-symbols-outlined",children:"camera_alt"}),"Start Wash (Take Photos)"]}),e.jsx("button",{onClick:()=>{window.confirm('Client not present? This will mark the order as "No Show".')&&(g(i.id,{status:"Cancelled",cancelReason:"Client No Show"}),x(m.WASHER_JOBS))},className:"w-full py-3 rounded-xl font-bold text-red-400 border border-red-500/30 hover:bg-red-500/10 transition-colors flex items-center justify-center gap-2",children:"Client No Show"})]}),i.status==="In Progress"&&e.jsxs("div",{className:"animate-in fade-in zoom-in duration-300",children:[e.jsxs("div",{className:"bg-[#3b82f6]/10 border border-[#3b82f6]/30 rounded-xl p-6 mb-4 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-[#3b82f6]/20 rounded-full flex items-center justify-center mx-auto mb-3 animate-pulse",children:e.jsx("span",{className:"material-symbols-outlined text-[#3b82f6] text-3xl",children:"local_car_wash"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:"Washing in Progress"}),e.jsx("p",{className:"text-sm text-slate-400",children:'Client sees the "Washing" animation.'})]}),e.jsxs("button",{onClick:()=>{O(),De("after"),Te({}),le(!0)},className:"w-full py-5 rounded-2xl font-black bg-primary text-white hover:bg-primary-dark transition-all shadow-blue-lg flex items-center justify-center gap-3 hover:scale-[1.02]",children:[e.jsx("span",{className:"material-symbols-outlined text-2xl",children:"check_circle"}),"FINISH WASH"]})]}),i.status==="Completed"&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500 space-y-4",children:[e.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"material-symbols-outlined text-green-400 text-3xl",children:"check_circle"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:"Order Completed!"}),e.jsx("p",{className:"text-sm text-slate-400",children:i.tip?"Client has tipped & rated!":"Waiting for client to rate & tip..."})]}),e.jsxs("div",{className:"bg-surface-dark border border-white/10 rounded-xl p-4",children:[e.jsx("h4",{className:"font-bold text-slate-300 mb-3 border-b border-white/5 pb-2",children:"Earnings Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-slate-400",children:[e.jsx("span",{children:"Service Price"}),e.jsxs("span",{children:["$",i.price.toFixed(2)]})]}),i.tip!==void 0&&i.tip>0&&e.jsxs("div",{className:"flex justify-between text-amber-400 font-bold",children:[e.jsx("span",{children:"Tip received!"}),e.jsxs("span",{children:["+$",(ge=i.tip)==null?void 0:ge.toFixed(2)]})]}),(()=>{const s=i.price+(i.tip||0),o=te.reduce((y,D)=>y+(D.percentage||0),0),c=i.price*o/100,r=s-c;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-red-400",children:[e.jsx("span",{children:"App Fees"}),e.jsxs("span",{children:["-$",c.toFixed(2)]})]}),e.jsxs("div",{className:"border-t border-white/10 pt-2 mt-2 flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-white",children:"Net Payout"}),e.jsxs("span",{className:"font-black text-2xl text-green-400",children:["$",r.toFixed(2)]})]})]})})()]})]})]})]})]}),e.jsx(q,{})]});else if(t===m.WASHER_EARNINGS){const s=b.filter(c=>c.washerId===n&&c.status==="Completed"),o=ue(s);B=e.jsxs("div",{className:"flex flex-col h-full bg-slate-950 text-white relative",children:[e.jsxs("header",{className:"px-6 py-8 border-b border-white/10 bg-white/5 backdrop-blur-md",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-white to-emerald-400 bg-clip-text text-transparent",children:l.t("earnings")}),e.jsxs("div",{className:"mt-4 bg-emerald-500/10 border border-emerald-500/20 rounded-2xl p-6",children:[e.jsx("p",{className:"text-xs text-emerald-400 font-bold uppercase tracking-widest mb-1",children:"Total Payout"}),e.jsxs("p",{className:"text-4xl font-black text-white",children:["$",o.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6 pb-24",children:[e.jsx("h2",{className:"text-sm font-bold text-slate-400 uppercase mb-4",children:"Payment History"}),e.jsx("div",{className:"space-y-3",children:s.length===0?e.jsxs("div",{className:"py-12 text-center text-slate-500",children:[e.jsx("span",{className:"material-symbols-outlined text-4xl mb-2",children:"account_balance_wallet"}),e.jsx("p",{children:"No earnings history yet."})]}):s.sort((c,r)=>(r.completedAt||0)-(c.completedAt||0)).map(c=>{var r;return e.jsxs("div",{className:"bg-surface-dark border border-white/5 rounded-xl p-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white",children:c.clientName}),e.jsx("p",{className:"text-xs text-slate-500",children:c.date})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-black text-emerald-400",children:["+$",(r=c.price)==null?void 0:r.toFixed(2)]}),e.jsx("p",{className:"text-[10px] text-slate-500 uppercase",children:"Paid"})]})]},c.id)})})]}),e.jsx(q,{})]})}else t===m.WASHER_PROFILE?B=e.jsxs("div",{className:"flex flex-col h-full bg-slate-950 text-white relative",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto pb-24",children:[e.jsxs("div",{className:"p-8 text-center bg-gradient-to-b from-primary/20 to-transparent",children:[e.jsxs("div",{className:"relative w-32 h-32 mx-auto mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-primary rounded-full blur-2xl opacity-20"}),e.jsx("img",{src:(a==null?void 0:a.avatar)||"https://via.placeholder.com/150",className:"relative w-full h-full rounded-full border-4 border-white/10 object-cover shadow-2xl"})]}),e.jsx("h1",{className:"text-2xl font-bold",children:a==null?void 0:a.name}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Professional Washer"}),(a==null?void 0:a.phone)&&e.jsx("p",{className:"text-primary text-sm font-medium mt-1",children:a.phone}),e.jsxs("div",{className:"mt-4 flex justify-center gap-2",children:[e.jsxs("span",{className:"bg-amber-500/20 text-amber-400 px-3 py-1 rounded-full text-xs font-bold border border-amber-500/30 flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"star"}),((je=a==null?void 0:a.rating)==null?void 0:je.toFixed(1))||"5.0"]}),e.jsxs("span",{className:"bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full text-xs font-bold border border-blue-500/30",children:[(a==null?void 0:a.completedJobs)||0," Jobs"]})]})]}),e.jsxs("div",{className:"px-6 space-y-4",children:[e.jsxs("button",{onClick:()=>x(m.WASHER_SETTINGS),className:"w-full bg-surface-dark border border-white/5 p-5 rounded-2xl flex items-center gap-4 hover:bg-white/5 transition-colors",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-slate-800 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"settings"})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("p",{className:"font-bold",children:"Settings"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Profile, working hours, services"})]}),e.jsx("span",{className:"material-symbols-outlined text-slate-600",children:"chevron_right"})]}),e.jsxs("button",{onClick:A,className:"w-full bg-red-500/10 border border-red-500/20 p-5 rounded-2xl flex items-center gap-4 hover:bg-red-500/20 transition-colors",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-500/20 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-red-400",children:"logout"})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("p",{className:"font-bold text-red-400",children:l.t("logout")}),e.jsx("p",{className:"text-xs text-red-400/60",children:"Securely sign out"})]})]})]})]}),e.jsx(q,{})]}):t===m.WASHER_SETTINGS&&(B=e.jsxs("div",{className:"flex flex-col h-full bg-slate-950 text-white animate-in slide-in-from-right duration-300",children:[e.jsxs("header",{className:"px-6 py-6 border-b border-white/10 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>x(m.WASHER_PROFILE),className:"w-10 h-10 rounded-full bg-white/5 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"})}),e.jsx("h1",{className:"text-xl font-bold",children:"Settings"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto pb-24",children:e.jsx(os,{currentUser:a,navigate:x,updateUserProfile:async(s,o)=>w(o),logout:A,showToast:S,openSupport:_})})]}));return e.jsxs("div",{className:"relative h-full overflow-hidden bg-background-dark",children:[B,!Z&&P&&e.jsx(cs,{onClick:()=>{O(),se(!0)},unreadCount:Je}),M&&e.jsxs("div",{className:"fixed inset-0 z-[10000] bg-black/80 flex flex-col items-center justify-center p-4 backdrop-blur-sm",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Uploading Photos..."}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Please wait while we secure your images."})]}),Me&&e.jsx(Ce,{mode:"before",onPhotosComplete:async s=>{if(i){R(!0);try{const o=await F(i.id,s,"before");g(i.id,{status:"In Progress",photos:{...i.photos,before:o}}),ae(!1)}catch(o){console.error("Error uploading photos:",o),S("Failed to upload photos. Please try again.","error")}finally{R(!1)}}else ae(!1)},onCancel:()=>ae(!1)}),He&&Be==="after"&&e.jsx(Ce,{mode:"after",onPhotosComplete:async s=>{if(i){R(!0);try{const o=await F(i.id,s,"after");g(i.id,{status:"Completed",completedAt:Date.now(),photos:{...i.photos,after:o},waitingForClient:!0}),i.clientId&&We(i.clientId),ie.stopTracking(),le(!1)}catch(o){console.error("Error uploading photos:",o),S("Failed to upload photos. Please try again.","error")}finally{R(!1)}}else le(!1)},onCancel:()=>le(!1)}),Y&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-surface-dark w-full max-w-xs rounded-2xl p-6 border border-white/10 shadow-2xl",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Arrival Estimate"}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-4",children:["5","10","15","20"].map(s=>e.jsx("button",{onClick:()=>Q(s),className:`py-2 rounded-lg border transition-colors ${$===s?"bg-primary border-primary text-white":"border-white/10 text-slate-400"}`,children:s},s))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>J(!1),className:"flex-1 py-3 text-slate-400 font-bold",children:"Cancel"}),e.jsx("button",{onClick:()=>{ze(),J(!1)},className:"flex-1 py-3 bg-primary rounded-xl font-bold text-white shadow-blue",children:"Confirm"})]})]})}),Z&&P&&e.jsx(Ue,{orderId:P.id,currentUserId:n,currentUserName:(a==null?void 0:a.name)||"Washer",otherUserId:P.clientId||"",otherUserName:P.clientName||"Client",messages:h,sendMessage:N,isOpen:Z,onClose:()=>se(!1)})]})},_s=t=>{const[x,b]=d.useState(!1),[g,n]=d.useState([]),[a,w]=d.useState(null),[L,k]=d.useState(!1),{currentWasherId:v,currentWasher:A}=t;d.useEffect(()=>{if(!v)return;const N=Se(re(T,"supportTickets"),Ae("userId","==",v),Ae("status","==","open"),ls(1)),u=Ee(N,j=>{if(j.empty)w(null);else{const _=j.docs[0];w(_.id),k(_.data().unreadByClient>0)}});return()=>u()},[v]),d.useEffect(()=>{if(!a){n([]);return}const N=Se(re(T,"supportTickets",a,"messages")),u=Ee(N,j=>{const _=j.docs.map(C=>({id:C.id,...C.data()}));n(_.sort((C,S)=>{var E,M,R,F;const I=((M=(E=C.timestamp)==null?void 0:E.toMillis)==null?void 0:M.call(E))||C.timestamp||0,i=((F=(R=S.timestamp)==null?void 0:R.toMillis)==null?void 0:F.call(R))||S.timestamp||0;return I-i}))});return()=>u()},[a]),d.useEffect(()=>{x&&a&&L&&me(U(T,"supportTickets",a),{unreadByClient:0})},[x,a,L]);const h=async N=>{var j;if(!N.trim())return;let u=a;if(!u)u=(await _e(re(T,"supportTickets"),{userId:v,userName:A.name||"Washer",userEmail:A.email||"",userRole:"washer",source:"App - Washer",status:"open",createdAt:ne(),lastMessageAt:ne(),unreadByClient:0,unreadByAdmin:1})).id,w(u);else{const C=((j=(await Pe(U(T,"supportTickets",u))).data())==null?void 0:j.unreadByAdmin)||0;me(U(T,"supportTickets",u),{lastMessageAt:ne(),status:"open",unreadByAdmin:C+1})}await _e(re(T,"supportTickets",u,"messages"),{senderId:v,senderName:A.name,senderRole:"washer",message:N,timestamp:ne(),read:!1})};return e.jsxs("div",{className:"relative h-full",children:[e.jsx(xs,{screen:t.screen,navigate:t.navigate,orders:t.orders,updateOrder:t.updateOrder,currentWasherId:t.currentWasherId,currentWasher:t.currentWasher,updateWasherProfile:t.updateWasherProfile,supportPhone:t.supportPhone,notifications:t.notifications,addNotification:t.addNotification,logout:t.logout,messages:t.messages,sendMessage:t.sendMessage,packages:t.packages,addons:t.addons,openSupport:()=>b(!0),grabOrder:t.grabOrder,showToast:t.showToast,initialOrderId:t.initialOrderId}),e.jsx(is,{isOpen:x,onClose:()=>b(!1),messages:g,currentUserId:v,chatTitle:"Washer Support",chatSubtitle:"Chat with Admin",onSendMessage:h})]})};export{_s as WasherScreens};
